var ClbhObject=function(win,doc,na){function sendYaMetrikaEvent(a){if(!yaMetrikaName)for(var b in win)if(win.hasOwnProperty(b)&&"string"==typeof b&&b.match(/yaCounter\d+/)&&void 0!==win[b]&&win[b].reachGoal){yaMetrikaName=b;break}if(yaMetrikaName&&void 0!==win[yaMetrikaName])try{win[yaMetrikaName].reachGoal(a)}catch(a){}}function sendGaEvent(a,b,c,d){if(win.ga_cbh&&ga_cbh(a,b,c,d),win.ga)try{for(var e=ga.getAll(),f=0;f<e.length;++f){e[f].send(b,c,d)}}catch(a){}else if(win._gaq)try{_gaq.push(["_trackEvent",c,d])}catch(a){}}function initGA(){if(void 0!==cbh_glob.h_params.ga_disable&&1==cbh_glob.h_params.ga_disable)return!1;ga_cbh=null,function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new cbh_glob.StrongDate,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(f,g)}(win,doc,"script",0,"ga_cbh"),ga_cbh=ga_cbh||win.ga_cbh,ga_cbh("create",CBHCore.opt.cbh_ga_id,"callbackhunter.com"),ga_cbh("send","pageview")}function jsonpRequest(a,b,c){function d(){e||(delete win[f],c(a))}var e=!1,f="cb"+String(Math.random()).slice(-6);a+=~a.indexOf("?")?"&":"?",a+="callback="+f,win[f]=function(a){e=!0,delete win[f],CBHCore.helpers.isFunction(b)&&b(a)};var g=doc.createElement("script");g.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,setTimeout(d,0))},g.onload=g.onerror=d,g.src=a,doc.body.appendChild(g)}function jsonpFail(a){console.log("Fail to request URL "+a)}function Position(a,b){this.X=a,this.Y=b,this.Add=function(a){var b=new Position(this.X,this.Y);return null!==a&&(isNaN(a.X)||(b.X+=a.X),isNaN(a.Y)||(b.Y+=a.Y)),b},this.Subtract=function(a){var b=new Position(this.X,this.Y);return null!=a&&(isNaN(a.X)||(b.X-=a.X),isNaN(a.Y)||(b.Y-=a.Y)),b},this.Min=function(a){var b=new Position(this.X,this.Y);return null==a?b:(!isNaN(a.X)&&this.X>a.X&&(b.X=a.X),!isNaN(a.Y)&&this.Y>a.Y&&(b.Y=a.Y),b)},this.Max=function(a){var b=new Position(this.X,this.Y);return null==a?b:(!isNaN(a.X)&&this.X<a.X&&(b.X=a.X),!isNaN(a.Y)&&this.Y<a.Y&&(b.Y=a.Y),b)},this.Bound=function(a,b){return this.Max(a).Min(b)},this.Check=function(){var a=new Position(this.X,this.Y);return isNaN(a.X)&&(a.X=0),isNaN(a.Y)&&(a.Y=0),a},this.Apply=function(a){"string"==typeof a&&(a=doc.getElementById(a)),null!=a&&(isNaN(this.X)||(a.style.left=this.X+"px"),isNaN(this.Y)||(a.style.top=this.Y+"px"))}}function absoluteCursorPostion(a){return a=a||window.event,isNaN(window.scrollX)?new Position(a.clientX+doc.documentElement.scrollLeft+doc.body.scrollLeft,a.clientY+doc.documentElement.scrollTop+doc.body.scrollTop):new Position(a.clientX+window.scrollX,a.clientY+window.scrollY)}function DragObject(a,b,c,d,e,f,g,h){function i(b){if(!p&&q&&!r)return p=!0,null!=e&&e(b,a),n=absoluteCursorPostion(b),o=new Position(parseInt(a.style.left),parseInt(a.style.top)),o=o.Check(),addEvent(doc,"mousemove",j),addEvent(doc,"mouseup",k),cancelEvent(b)}function j(b){if(p&&!r){var e=absoluteCursorPostion(b);return e=e.Add(o).Subtract(n),e=e.Bound(c,d),e.Apply(a),null!=f&&f(e,a),cancelEvent(b)}}function k(a){return l(a),cancelEvent(a)}function l(b){var c=absoluteCursorPostion(b),d=Math.abs(n.X-c.X),e=Math.abs(n.Y-c.Y);p&&!r&&(removeEvent(doc,"mousemove",j),removeEvent(doc,"mouseup",k),n=null,o=null,null!=g&&g(a),p=!1,d<30&&e<30&&(sendGaEvent("send","event","Callbackhunter_PHONEICON","clicked"),sendYaMetrikaEvent("Callbackhunter_PHONEICON"),showSimpleDialog(!0)))}if("string"==typeof a&&(a=doc.getElementById(a)),null!=a){if(null!=c&&null!=d){var m=c.Min(d);d=c.Max(d),c=m}var n=null,o=null,p=!1,q=!1,r=!1;this.Dispose=function(){r||(this.StopListening(!0),a=null,b=null,c=null,d=null,e=null,f=null,g=null,r=!0)},this.StartListening=function(){q||r||(q=!0,addEvent(b,"mousedown",i))},this.StopListening=function(a){q&&!r&&(removeEvent(b,"mousedown",i),q=!1,a&&p&&l())},this.isDragging=function(){return p},this.isListening=function(){return q},this.isDisposed=function(){return r},"string"==typeof b&&(b=doc.getElementById(b)),null==b&&(b=a),h||this.StartListening()}}function checkActivity(){var a,b,c,d,e=(new cbh_glob.StrongDate).getTime(),f=97,g=CBHCore.helpers.getRandomInt(1,2),h=doc.getElementById("clbh_banner_pr_line_left"),i=doc.getElementById("clbh_banner_pr_line_right");h&&i&&(e-cbh_glob.activity_last_ts<=8e3&&(1==g&&(parseInt(h.style.width)<96?(b=parseInt(h.style.width)+1,b>f&&(b=f),h.style.width=b+"%",cbh_glob.accelerometr_etalon-=cbh_glob.accelerometr_step,CBHCore.cookies.get("hunter_prline_left")&&(a=new cbh_glob.StrongDate,a.setDate(a.getDate()+30),CBHCore.cookies.set("hunter_prline_left",b+"%",{expires:a}))):(h.style.width="97%",CBHCore.cookies.get("hunter_prline_left")&&(a=new cbh_glob.StrongDate,a.setDate(a.getDate()+30),CBHCore.cookies.set("hunter_prline_left","97%",{expires:a})))),2==g&&(parseInt(i.style.width)<96?(b=parseInt(i.style.width)+1,b>f&&(b=f),i.style.width=b+"%",cbh_glob.accelerometr_etalon-=cbh_glob.accelerometr_step,CBHCore.cookies.get("hunter_prline_right")&&(a=new cbh_glob.StrongDate,a.setDate(a.getDate()+30),CBHCore.cookies.set("hunter_prline_right",b+"%",{expires:a}))):(i.style.width="97%",CBHCore.cookies.get("hunter_prline_right")&&(a=new cbh_glob.StrongDate,a.setDate(a.getDate()+30),CBHCore.cookies.set("hunter_prline_right","97%",{expires:a}))))),c=parseInt(h.style.width),d=parseInt(i.style.width),c+d>24&&(cbh_glob.activity_exit_event=!0),(c>=95||d>=95)&&(cbh_glob.accelerometr_etalon=20))}function measureDistance(a){cbh_glob.makeMeasureDistance&&(cbh_glob.lastSeenAt.x&&(cbh_glob.totalDistance+=Math.sqrt(Math.pow(cbh_glob.lastSeenAt.y-a.clientY,2)+Math.pow(cbh_glob.lastSeenAt.x-a.clientX,2))),cbh_glob.lastSeenAt.x=a.clientX,cbh_glob.lastSeenAt.y=a.clientY)}function clearDistance(){cbh_glob.makeMeasureDistance&&("undefined"!=typeof deactivatePhoneIcon&&CBHCore.helpers.isFunction(deactivatePhoneIcon)&&deactivatePhoneIcon(),"undefined"!=typeof activatePhoneIcon&&CBHCore.helpers.isFunction(activatePhoneIcon)&&(Math.round(cbh_glob.totalDistance)>1e3||Math.round(cbh_glob.totalScrollDistance)>200)&&activatePhoneIcon(),cbh_glob.totalDistance=0,cbh_glob.totalScrollDistance=0)}function measureScroll(){if(cbh_glob.makeMeasureDistance){var a;a="pageXOffset"in win?window.pageYOffset:doc.documentElement.scrollTop,a=a>0?a:0,a>=cbh_glob.phoneiconScrollOffset?showPhoneIcon():hidePhoneIcon(),cbh_glob.lastSeenScrollAt&&(cbh_glob.totalScrollDistance+=Math.abs(cbh_glob.lastSeenScrollAt-a)),cbh_glob.lastSeenScrollAt=a}}function catchMovement(a){if(lastX=a.clientX,lastY=a.clientY,cbh_glob.activity_last_ts=(new cbh_glob.StrongDate).getTime(),cbh_glob.show_exit&&cbh_glob.activity_exit_event&&!cbh_glob.block_show_banner&&!(cbh_glob.block_auto_popup||cbh_glob.min_popup_delay>0)){if(null===W)return W=+new cbh_glob.StrongDate,X=0,void(Y=a.screenY);var b=+new cbh_glob.StrongDate,c=b-W;if(!(c<5)){var d=a.screenY-Y,e=Math.round(d/c*100),f=e-X,g=Math.round(f/c*100);g<0&&Math.round(-1e3*g/Z)>cbh_glob.accelerometr_etalon&&ClbhObject.showWidgetExit(),W=b,X=e,Y=a.screenY}}}function catchHash(){if(win.location.hash){var a=win.location.hash.substring(1);if("callbackhunter"===a&&(showSimpleDialog(!0),win.location.hash="#callbackhunter-ok"),"callbackhunter-dialog"===a&&(showDemoDialog(),win.location.hash="#callbackhunter-dialog-ok"),"autocallback"===a&&!CBHCore.cookies.get("hunter_autocallback")||-1!==a.indexOf("wildcallback")){var b=CBHCore.helpers.isset;cbh_glob.wildcallback=-1!==a.indexOf("wildcallback"),a=CBHCore.helpers.parseQueryString(a),cbh_glob.wild_id=!!b(a.wild_id)&&a.wild_id,cbh_glob.wild_stat_raw_id=!!b(a.wild_stat_raw_id)&&a.wild_stat_raw_id,cbh_glob.wild_type=!!b(a.wild_type)&&a.wild_type,cbh_glob.wild_from_domain=!!b(a.wild_from_domain)&&a.wild_from_domain,cbh_glob.parent_call_id=!!b(a.parent_call_id)&&a.parent_call_id,cbh_glob.autocallback=!0,cbh_glob.wildcallback?"chrome"===cbh_glob.wild_type?cbh_glob.widget_show_reason=8:cbh_glob.widget_show_reason=7:cbh_glob.widget_show_reason=4,(!cbh_glob.wildcallback||void 0!==CBHCore.db_params.wild_active&&CBHCore.db_params.wild_active)&&(win.location.hash="#autocallback-ok",ClbhObject.showWidgetEnter(!0))}}}function addClass(a,b){var c=b.className;-1==c.indexOf(a)&&(""!=c&&(a=" "+a),b.className=c+a)}function removeClass(a,b){var c=b.className,d=new RegExp("\\s?\\b"+a+"\\b","g");c=c.replace(d,""),b.className=c}function hasClass(a,b){return-1!==b.className.indexOf(a)}function cancelEvent(a){return a=a||window.event,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,!1}function declOfNum(a,b){var c=[2,0,1,1,1,2];return b[a%100>4&&a%100<20?2:c[a%10<5?a%10:5]]}function setShowCookie(){var a=new cbh_glob.StrongDate;a.setDate(a.getDate()+1);var b={expires:a};cbh_glob.allow_subdomain&&(b.domain="."+win.location.hostname.replace(/^(http(s)?:\/\/)?(www\.)?/,"")),CBHCore.cookies.set("hunter_showed","1",b),a.setDate(a.getDate()+29),CBHCore.cookies.set("hunter_session","1",{expires:a})}function blurWindow(){var a=doc.body.childNodes;for(var b in a)a.hasOwnProperty(b)&&"clbh_div"!=a[b].id&&(a[b].className=a[b].className+" clbh_blur")}function unblurWindow(){var a=doc.body.childNodes;for(var b in a)a.hasOwnProperty(b)&&"string"==typeof a[b].className&&(a[b].className=a[b].className.replace(/\bclbh_blur\b/g,""))}function init_base(){cbh_glob.StrongDate=CBHCore.lib.StrongDate;var a,b,c;CBHCore.loadFile("css","//fonts.googleapis.com/css?family=Open+Sans:300&subset=latin,cyrillic-ext"),CBHCore.cookies.get("hunter_params")?(c=new cbh_glob.StrongDate,c.setDate(c.getDate()+30),b=CBHCore.cookies.get("hunter_params"),b.p++,CBHCore.cookies.set("hunter_params",b,{expires:c})):(c=new cbh_glob.StrongDate,a=new cbh_glob.StrongDate,a.setDate(c.getDate()+30),CBHCore.cookies.set("hunter_params",{p:1},{expires:a})),CBHCore.helpers.setStartCookie(),postloadfunction()}function microMenuClosed(){return 1===CBHCore.cookies.get("hunter_micromenu_closed")&&void 0!==cbh_glob.h_params.show_micromenu_close&&1===cbh_glob.h_params.show_micromenu_close}function doScale(a,b,c,d,e,f){if(!cbh_glob.noScaling){var g={};g.elem=a,g.innerWidth=win.innerWidth,g.innerHeight=win.innerHeight,g.clientWidth=a.clientWidth,g.clientHeight=a.clientHeight;var h;win.innerWidth<win.innerHeight?(a.style.cssText="width: "+b+"px !important",h=c):(a.style.cssText="width: "+d+"px !important",h=e),g.scale=win.innerWidth/h,g.resultWidth=g.scale*a.clientWidth,g.resultHeight=g.scale*a.clientHeight,g.positionCorrectionX=(g.resultWidth-a.clientWidth)/2,g.positionCorrectionY=(g.resultHeight-a.clientHeight)/2,a.style.cssText+="-moz-transform: scale("+g.scale+","+g.scale+");",a.style.cssText+="-ms-transform: scale("+g.scale+","+g.scale+");",a.style.cssText+="-webkit-transform: scale("+g.scale+","+g.scale+");",a.style.cssText+="-o-transform: scale("+g.scale+","+g.scale+");",a.style.cssText+="transform: scale("+g.scale+","+g.scale+");",void 0!=f.right&&(a.style.cssText+="right:"+(f.right*g.scale+g.positionCorrectionX)+"px !important;"),void 0!=f.bottom&&(a.style.cssText+="bottom: "+(f.bottom*g.scale+g.positionCorrectionY)+"px !important;"),void 0!=f.left&&(a.style.cssText+="left:"+(f.left*g.scale+g.positionCorrectionX)+"px !important;"),void 0!=f.top&&(a.style.cssText+="top: "+(f.top*g.scale+g.positionCorrectionY)+"px !important;")}}function rescaleWidget(){doScale(doc.getElementById("clbh_mob_div"),486,480,706,700,{bottom:-3,right:-3}),doScale(doc.getElementById("clbh_mob_banner-startphone"),128,480,128,700,{bottom:-3,right:-3})}function hideWidget(){unblurWindow(),sendGaEvent("send","event","Callbackhunter_CLOSE","clicked"),sendYaMetrikaEvent("Callbackhunter_CLOSE"),clearInterval(cbh_glob.counter),clearTimeout(cbh_glob.msTimer),doc.getElementById("clbh_div_ban").className="clbh_banner clbh_closed",doc.getElementById("clbh_banner_bg").style.display="none",doc.getElementById("clbh_banner_pr_line_wrapper").style.display=cbh_glob.statusbar_display,void 0!==doc.getElementById("clbh_phone_div")&&null!=doc.getElementById("clbh_phone_div")&&(doc.getElementById("clbh_phone_div").style.display="block"),CBHCore.server.send({close:1})}function sendShowWidget(){CBHCore.server.send({open:1})}function checkWidgetMode(){if(0==--cbh_glob.minutes_rest){cbh_glob.widget_mode="night",clearInterval(cbh_glob.mode_timer);var a=doc.getElementById("clbh_stat");a&&(a.style.display="none"),cbh_glob.countdown=cbh_glob.countdown_hidden,cbh_glob.text_time=cbh_glob.text_time_hidden,cbh_glob.countdown_hours=cbh_glob.text_time_hidden}}function countNightModeMinutes(){++cbh_glob.text_time_hidden>=60&&(cbh_glob.text_time_hidden=0,checkWidgetNightMode())}function checkWidgetNightMode(){cbh_glob.countdown=cbh_glob.countdown-3600,cbh_glob.text_time=cbh_glob.countdown,cbh_glob.countdown_hours=parseInt(cbh_glob.countdown/3600),"worktime"==cbh_glob.widget_mode&&cbh_glob.countdown<=0&&(clearInterval(cbh_glob.text_time_hidden),doc.getElementById("clbh_div").style.display="none",void 0!==doc.getElementById("clbh_phone_div")&&null!=doc.getElementById("clbh_phone_div")&&(doc.getElementById("clbh_phone_div").style.display="none"))}function sendCallback(){var a=document.getElementById("cbh_data_process");if(null!==a&&(sessionStorage.data_processed=a.checked),(!sessionStorage.data_processed||"false"==sessionStorage.data_processed)&&void 0!==cbh_glob.h_params.data_process&&1==cbh_glob.h_params.data_process)return void alert(cbh_glob.h_params.data_process_popup_text);if(doc.getElementById("clbh_send").innerHTML==__("clbh_send_called")){clearInterval(cbh_glob.counter),clearTimeout(cbh_glob.msTimer);var b=doc.getElementById("ms_timer");return void(b&&b.setAttribute("id","ms_timer_stop"))}if(doc.getElementById("clbh_stat").innerHTML="",void 0!==doc.getElementById("clbh_banner_office_current")&&null!=doc.getElementById("clbh_banner_office_current")&&doc.getElementById("clbh_banner_office_current").setAttribute("style","color: black !important; border-bottom: 1px dashed black !important;"),cbh_glob.strict_office_choice&&0==cbh_glob.office_id){CBHCore.params.hasCustomOffices?doc.getElementById("clbh_banner_choose_office_city_container").setAttribute("style","border: 1px dashed red !important;"):doc.getElementById("clbh_banner_office_current").setAttribute("style","color: red !important; border-bottom: 1px dashed red !important;");var c=doc.getElementById("clbh_stat");return c.innerHTML=__("clbh_stat_choose_office"),void c.setAttribute("style","color: red !important;")}CBHCore.user.setPhone(doc.getElementById("clbh_phone").value);var d=!0;if(("string"!=typeof CBHCore.user.client_phone||""===CBHCore.user.client_phone||-1!==CBHCore.user.client_phone.indexOf("_")||/(.)\1{6,}/i.test(CBHCore.user.client_phone.replace(/\D+/g,"")))&&(d=!1),""!=CBHCore.user.client_phone&&d){doc.getElementById("clbh_send").innerHTML=__("clbh_send_called");var e="Callbackhunter_CALL"+("worktime"!=cbh_glob.widget_mode?"_DEFERRED":"");sendGaEvent("send","event",e,"clicked"),sendYaMetrikaEvent(e),cbh_glob.call_rand_id=CBHCore.helpers.rand(16);var f="//"+CBHCore.opt.endpoint+"/hunter/?hcode="+CBHCore.hunter_code+"&sid="+CBHCore.user.session_id;f+="&url="+encodeURIComponent(CBHCore.user.url),f+="&phone="+CBHCore.user.client_phone+"&wp_code="+(void 0!==cbh_glob.h_params.wp_code?cbh_glob.h_params.wp_code:""),f+="&lang="+lang+"&referer="+encodeURIComponent(CBHCore.user.referrer),f+=CBHCore.user.name?"&client_name="+encodeURIComponent(CBHCore.user.name):"",f+="&call_rand_id="+cbh_glob.call_rand_id+"&entrance_page="+encodeURIComponent(CBHCore.user.entrance_page),f+="&office_id="+cbh_glob.office_id,f+=cbh_glob.widget_show_reason?"&widget_show_reason="+cbh_glob.widget_show_reason:"",f+=CBHCore.lang.filter_id>0?"&filter_id="+CBHCore.lang.filter_id:"",f+=CBHCore.user.custom_cookie?"&custom_cookie="+encodeURIComponent(CBHCore.user.custom_cookie):"",f+=cbh_glob.wild_id?"&wild_id="+encodeURIComponent(cbh_glob.wild_id):"",f+=cbh_glob.wild_stat_raw_id?"&wild_stat_raw_id="+encodeURIComponent(cbh_glob.wild_stat_raw_id):"",f+=cbh_glob.wild_from_domain?"&wild_from_domain="+encodeURIComponent(cbh_glob.wild_from_domain):"",f+=cbh_glob.parent_call_id?"&parent_call_id="+encodeURIComponent(cbh_glob.parent_call_id):"",f+="&timezone_offset="+(new Date).getTimezoneOffset(),cbh_glob.wildcallback&&(f+="&widget_show_reason=7"),f+="&answer_type=jsonp","worktime"==cbh_glob.widget_mode||(f+="&night_time="+cbh_glob.chosenNightTime);var g=CBHCore.callTracking.catchManagerPhone();g.length&&(f+="&phone_manager_tracked="+g);var h=getCustomEventReplace("aftercall"),i=showAftercallWindow;if(h)try{objectCustomAliases[h](),i=null}catch(a){}jsonpRequest(f,i,jsonpFail),cbh_glob.counter=setInterval(timerCountdown,1e3),hideOfficeChoice(),afterCallCustomActions(),""!=cbh_glob.after_action_url&&((new Image).src=cbh_glob.after_action_url)}else doc.getElementById("clbh_phone").focus(),doc.getElementById("clbh_phone").setAttribute("style","border-color:red!important"),d&&(doc.getElementById("clbh_stat").innerHTML=__("clbh_stat_wrong_number"))}function autoCallback(){cbh_glob.autocallback&&(cbh_glob.autocallback=!1,CBHCore.cookies.set("hunter_autocallback","1",{expires:1}),"worktime"===cbh_glob.widget_mode&&cbh_glob.has_minutes&&CBHCore.user.client_phone&&1!=cbh_glob.h_params.show_office_choice&&!CBHCore.params.hasCustomOffices&&(cbh_glob.widget_show_reason=4,sendCallback()))}function afterCallCustomActions(){if(void 0!==cbh_glob.custom_layout&&null!==cbh_glob.custom_layout&&void 0!==cbh_glob.custom_layout.actions&&"object"==typeof cbh_glob.custom_layout.actions.aftercall){var a=cbh_glob.custom_layout.actions.aftercall;if(a.length)for(var b in a)if(a.hasOwnProperty(b)){var c=a[b][0],d=a[b][1],e=null;if(c.match(/^hide_by_/)){if("hide_by_id"===c)e=doc.getElementById(d.replace(/^#/,""));else if("hide_by_classname"===c){var f=doc.getElementsByClassName(d.replace(/^\./,""));e=f?f[0]:null}e&&(e.style.display="none")}}}}function loadCustomLayoutCSS(){if(null!==cbh_glob.h_params&&void 0!==cbh_glob.h_params.custom_layout&&!CBHCore.helpers.isEmpty(cbh_glob.h_params.custom_layout)){var a=cbh_glob.h_params.custom_layout;for(var b in a)if(a.hasOwnProperty(b)&&1==a[b].status){cbh_glob.custom_layout=a[b];break}null!==cbh_glob.custom_layout&&void 0!==cbh_glob.custom_layout.css_file&&cbh_glob.custom_layout.css_file.length&&(cbh_glob.custom_layout.css_file.split("/").length>1?CBHCore.loadFile("css",cbh_glob.custom_layout.css_file,!0):CBHCore.loadFile("css",CBHCore.opt.static_domain+"/widgets/v2/css/custom/"+cbh_glob.custom_layout.css_file,!0))}}function parseCustomLang(){if(null!==cbh_glob.custom_layout&&void 0!==cbh_glob.custom_layout.translate)for(var a in cbh_glob.custom_layout.translate)if(cbh_glob.custom_layout.translate.hasOwnProperty(a)){var b=cbh_glob.custom_layout.translate[a];if(void 0!==CBHCore.lang.languages[a])for(var c in b)b.hasOwnProperty(c)&&CBHCore.lang.addLangRow(c,b[c],a)}}function getCustomEventReplace(a){return null!==cbh_glob.custom_layout&&(void 0!==cbh_glob.custom_layout.events_replace&&("string"==typeof cbh_glob.custom_layout.events_replace[a]&&cbh_glob.custom_layout.events_replace[a]))}function parseCustomLayout(){if(null!==cbh_glob.custom_layout&&void 0!==cbh_glob.custom_layout.domnodes&&cbh_glob.custom_layout.domnodes.length)for(var a in cbh_glob.custom_layout.domnodes)if(cbh_glob.custom_layout.domnodes.hasOwnProperty(a)){var b=cbh_glob.custom_layout.domnodes[a];if(void 0!==b.node){var c=void 0!==b.rel&&b.rel,d=void 0!==b.rel_position&&b.rel_position;if("before"===d){var e=null;if(c.match(/^#/))e=doc.getElementById(c.replace(/^#/,""));else if(c.match(/^\./)){var f=doc.getElementsByClassName(c.replace(/^\./,""));e=f?f[0]:null}if(!e)return;var g=e.parentNode;if(g){var h=doc.createElement("div");h.innerHTML=b.node,g.insertBefore(h,e)}}}}}function postloadfunction(){if((!CBHCore.helpers.isEmpty(CBHCore.db_params)||null!==cbh_glob.h_params&&0!==cbh_glob.h_params.length)&&(cbh_glob.schedule=CBHCore.params.mainSchedule,null===cbh_glob.h_params&&(cbh_glob.h_params=CBHCore.db_params),!CBHCore.helpers.dontShowWidget())){if(initGA(),loadCustomLayoutCSS(),CBHCore.cookies.get("hunter_showed")&&1==CBHCore.cookies.get("hunter_showed")&&cbh_glob.h_params.show_once&&"1"==cbh_glob.h_params.show_once&&(cbh_glob.block_auto_popup=!0),CBHCore.cookies.get("hunter_session")&&1==CBHCore.cookies.get("hunter_session")&&cbh_glob.h_params.show_once_session&&"1"==cbh_glob.h_params.show_once_session&&(cbh_glob.block_auto_popup=!0),cbh_glob.h_params.hide_statusbar&&"1"==cbh_glob.h_params.hide_statusbar&&(cbh_glob.statusbar_display="none"),cbh_glob.schedule.isWorkTime()&&(cbh_glob.widget_mode="worktime",cbh_glob.minutes_rest=cbh_glob.schedule.getMinutesBeforeEnd(),CBHCore.params.hasCustomOffices||(cbh_glob.countdown_hidden=60*cbh_glob.schedule.getMinutesBeforeStart(),cbh_glob.text_time_hidden=Math.ceil(cbh_glob.schedule.getMinutesBeforeStart()))),void 0!==cbh_glob.h_params.sensitivity&&parseInt(cbh_glob.h_params.sensitivity)>=1&&parseInt(cbh_glob.h_params.sensitivity)<=10&&(cbh_glob.accelerometr_koeff=1+.06*(5-cbh_glob.h_params.sensitivity)),cbh_glob.accelerometr_start=cbh_glob.accelerometr_start*cbh_glob.accelerometr_koeff,cbh_glob.accelerometr_step=cbh_glob.accelerometr_step*cbh_glob.accelerometr_koeff,cbh_glob.mode_timer=setInterval(checkWidgetMode,6e4),void 0!==cbh_glob.h_params.show_enter&&(cbh_glob.show_enter=1==parseInt(cbh_glob.h_params.show_enter)),void 0!==cbh_glob.h_params.show_powered_by&&(cbh_glob.show_powered_by=1===parseInt(cbh_glob.h_params.show_powered_by)),drawWidget(),parseCustomLayout(),addEvent(doc.getElementById("clbh_banner_pr_line_wrapper"),"click",showSimpleDialog),addEvent(doc.getElementById("clbh_exit"),"click",hideWidget),addEvent(doc.getElementById("clbh_banner_bg"),"click",hideWidget),addEvent(win,"hashchange",catchHash),addEvent(win,"mousemove",catchMovement),cbh_glob.activity_last_ts=(new cbh_glob.StrongDate).getTime(),cbh_glob.activity_t=setInterval(checkActivity,500),cbh_glob.show_enter&&(cbh_glob.dialog_timer=setTimeout(showDialog,4e4)),!cbh_glob.show_powered_by){var a=doc.getElementById("clbh_banner_work_to");a&&a.parentNode.removeChild(a)}if(cbh_glob.show_powered_by&&cbh_glob.h_params.language&&"auto"!=cbh_glob.h_params.language){var b=doc.getElementById("clbh_banner_work_to");b&&(b.innerHTML=__("clbh_banner_work_to"))}if(void 0!==cbh_glob.h_params.min_popup_delay&&parseInt(cbh_glob.h_params.min_popup_delay)>0&&(cbh_glob.min_popup_delay=parseInt(cbh_glob.h_params.min_popup_delay),cbh_glob.minPopupTimer=setInterval(countPopupDelayTimer,1e3)),void 0!==cbh_glob.h_params.popup_after&&parseInt(cbh_glob.h_params.popup_after)>0&&(cbh_glob.popup_after=parseInt(cbh_glob.h_params.popup_after),setTimeout(ClbhObject.showWidgetExit,1e3*cbh_glob.popup_after)),cbh_glob.avgTimer=setInterval(showByAvg,1e3),void 0!==cbh_glob.h_params.show_exit&&(cbh_glob.show_exit=1==parseInt(cbh_glob.h_params.show_exit)),void 0!==cbh_glob.h_params.phone_code&&(cbh_glob.phone_code=cbh_glob.h_params.phone_code),void 0!==cbh_glob.h_params.after_action&&(cbh_glob.after_action_url=cbh_glob.h_params.after_action),void 0!==cbh_glob.h_params.has_minutes&&(cbh_glob.has_minutes=0!=parseInt(cbh_glob.h_params.has_minutes)),void 0!==cbh_glob.h_params.has_payments&&(cbh_glob.has_payments=0!=parseInt(cbh_glob.h_params.has_payments)),void 0!==cbh_glob.h_params.allow_subdomain&&(cbh_glob.allow_subdomain=0!=parseInt(cbh_glob.h_params.allow_subdomain,10)),void 0!==cbh_glob.h_params.time_connection&&(cbh_glob.text_time=cbh_glob.h_params.time_connection,cbh_glob.countdown=cbh_glob.h_params.time_connection),void 0!==cbh_glob.h_params.strict_office_choice&&(1==cbh_glob.h_params.show_office_choice&&cbh_glob.h_params.show_office_list&&cbh_glob.h_params.show_office_list.length||CBHCore.params.hasCustomOffices)&&(cbh_glob.strict_office_choice=0!=parseInt(cbh_glob.h_params.strict_office_choice,10)),cbh_glob.h_params.phone_icon&&"1"==cbh_glob.h_params.phone_icon){2==CBHCore.version&&CBHCore.loadFile("css",CBHCore.opt.static_domain+"/widgets/v2/tracker_phoneicon.min.css",!0);!cbh_glob.h_params.phone_icon_color||"green"!=cbh_glob.h_params.phone_icon_color&&"gray"!=cbh_glob.h_params.phone_icon_color||cbh_glob.h_params.phone_icon_color,void 0!==cbh_glob.h_params.phoneicon_x&&(cbh_glob.phoneicon_x=cbh_glob.h_params.phoneicon_x),void 0!==cbh_glob.h_params.phoneicon_y&&(cbh_glob.phoneicon_y=cbh_glob.h_params.phoneicon_y),void 0!==cbh_glob.h_params.phone_icon_always&&1==cbh_glob.h_params.phone_icon_always&&(cbh_glob.phoneiconScrollOffset=0),drawPhone(),2==CBHCore.version&&("undefined"!=typeof highlightPhoneIcon&&CBHCore.helpers.isFunction(highlightPhoneIcon)&&addEvent(doc.getElementById("clbh_phone_div"),"mouseover",highlightPhoneIcon),"undefined"!=typeof unhighlightPhoneIcon&&CBHCore.helpers.isFunction(unhighlightPhoneIcon)&&addEvent(doc.getElementById("clbh_phone_div"),"mouseout",unhighlightPhoneIcon),void 0!==cbh_glob.h_params.show_micromenu_close&&1==cbh_glob.h_params.show_micromenu_close&&(addEvent(doc.getElementById("cbh_widget_micromenu"),"mousedown",function(a){a.stopPropagation(),onMicroMenuClose()}),addEvent(doc.getElementById("cbh_widget_micromenu"),"mouseup",function(a){a.stopPropagation()}))),addEvent(doc,"mousemove",measureDistance),addEvent(win,"scroll",measureScroll),addEvent(win,"resize",redrawPhone),2==CBHCore.version&&(cbh_glob.clbh_phone_draggable=new DragObject("clbh_phone_div",null,new Position(0,0),new Position(cbh_glob.view_w,cbh_glob.view_h),null,null,null,!1)),cbh_glob.distance_timer=setInterval(clearDistance,1500)}"night"==cbh_glob.widget_mode&&(cbh_glob.countdown=60*cbh_glob.schedule.getMinutesBeforeStart(),cbh_glob.text_time=cbh_glob.countdown,cbh_glob.countdown_hours=Math.ceil(cbh_glob.countdown/3600),cbh_glob.text_time_hidden=setInterval(countNightModeMinutes,6e4)),catchHash()}}function onMicroMenuClose(){var a=new cbh_glob.StrongDate(+new cbh_glob.StrongDate+2592e6);CBHCore.cookies.set("hunter_micromenu_closed",1,{expires:a}),removeClass("cbh-show",doc.getElementById("clbh_phone_div"))}function showStat(){void 0!==cbh_glob.h_params.stat&&(doc.getElementById("clbh_stat").innerHTML=__("clbh_stat_show_stat").clbh_format(cbh_glob.h_params.stat.lines,cbh_glob.h_params.stat.online,cbh_glob.h_params.stat.total))}function countPopupDelayTimer(){--cbh_glob.min_popup_delay<=0&&clearInterval(cbh_glob.minPopupTimer)}function formatTime(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;return d<10&&(d="0"+d),c<10&&(c="0"+c),0!=b?(b<10&&(b="0"+b),b+":"+c+":"+d):c+":"+d}function timerCountdown(){--cbh_glob.countdown;if(cbh_glob.countdown<=0)return clearInterval(cbh_glob.counter),clearTimeout(cbh_glob.msTimer),void("worktime"==cbh_glob.widget_mode?doc.getElementById("clbh_timer_result").innerHTML="00:00,00":doc.getElementById("clbh_timer_result").innerHTML="00:00");"worktime"==cbh_glob.widget_mode?(doc.getElementById("clbh_timer_result").innerHTML=formatTime(cbh_glob.countdown)+',<span id="ms_timer"></span>',millisecondsEmulator()):doc.getElementById("clbh_timer_result").innerHTML=formatTime(cbh_glob.countdown)}function millisecondsEmulator(){cbh_glob.msEmu-=29,cbh_glob.msEmu<=0&&(cbh_glob.msEmu=999);var a=doc.getElementById("ms_timer");if(a){var b=cbh_glob.msEmu;cbh_glob.msEmu<10&&(b="0"+b),a.innerHTML=b.toString().substr(0,2),cbh_glob.msTimer=setTimeout(millisecondsEmulator,33)}}function showByAvg(){if(cbh_glob.avgTimerSec++,cbh_glob.h_params.avg&&!(cbh_glob.min_popup_delay>0)&&cbh_glob.avgTimerSec>=parseInt(cbh_glob.h_params.avg)-2){if(clearInterval(cbh_glob.avgTimer),!cbh_glob.show_exit)return;if(!cbh_glob.activity_exit_event)return;if(cbh_glob.block_show_banner)return;if(cbh_glob.block_auto_popup)return;ClbhObject.showWidgetExit()}}function addEventsNightSelects(){var a=function(a){Array.prototype.forEach.call(doc.getElementsByClassName("clbh_night_hour"),function(a){a.setAttribute("style","display: none !important")}),doc.getElementById("clbh_night_hour_"+a).setAttribute("style","display: inline !important"),b(doc.getElementById("clbh_night_hour_"+a).value)},b=function(a){Array.prototype.forEach.call(doc.getElementsByClassName("clbh_night_minute"),function(a){a.setAttribute("style","display: none !important")}),doc.getElementById("clbh_night_minute_"+a).setAttribute("style","display: inline !important"),c(doc.getElementById("clbh_night_minute_"+a).value)},c=function(a){cbh_glob.chosenNightTime=+a,set_night_counter()};addEvent(doc.getElementById("clbh_night_day"),"change",function(b){a(b.target.value)}),Array.prototype.forEach.call(doc.getElementsByClassName("clbh_night_hour"),function(a){addEvent(a,"change",function(a){b(a.target.value)})}),Array.prototype.forEach.call(doc.getElementsByClassName("clbh_night_minute"),function(a){addEvent(a,"change",function(a){c(a.target.value)})})}function generateNightSelects(a){var b=(a||cbh_glob.schedule).getValues({maxItemsPerKey:10,includeDisabled:!0}),c='<select id="clbh_night_day" class="clbh_night_select">',d=[],e=[],f=!0,g=!0,h=!0;return Object.keys(b).forEach(function(a){var i=f?' selected="selected"':"",j=f?"":' style="display: none !important;"';c+='<option value="'+a+'"'+i+">"+renderDay(new cbh_glob.StrongDate(+a))+"</option>";var k='<select id="clbh_night_hour_'+a+'"'+j+' class="clbh_night_select clbh_night_hour">';Object.keys(b[a]).forEach(function(c){var d=0===b[a][c].filter(function(a){return!a._cbh_disabled}).length,f=g&&!d?' selected="selected"':"",i=g&&!d?"":' style="display: none !important;"';k+='<option value="'+c+'"'+f+(d?' disabled="disabled"':"")+">"+renderHours(new cbh_glob.StrongDate(+c))+"</option>";var j='<select id="clbh_night_minute_'+c+'"'+i+' class="clbh_night_select clbh_night_minute">';b[a][c].forEach(function(a){var b=h&&!a._cbh_disabled?' selected="selected"':"",c=a._cbh_disabled?' disabled="disabled"':"";h&&!a._cbh_disabled&&(cbh_glob.chosenNightTime=+a),j+='<option value="'+ +a+'"'+b+c+">"+renderMinutes(a)+"</option>",a._cbh_disabled||(h=!1)}),j+="</select>",e.push(j),d||(g=!1)}),k+="</select>",d.push(k),f=!1}),c+="</select>",{days:"<label>"+c+"</label>",hours:"<label>"+d.join("")+"</label>",minutes:"<label>"+e.join("")+"</label>"}}function renderDay(a){var b={days:["today","tomorrow"],daysOfWeek:["sun","mon","tue","wed","thu","fri","sat"],monthes:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]},c=new cbh_glob.StrongDate;c.setHours(0),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0);var d=new cbh_glob.StrongDate(+a);d.setHours(0),d.setMinutes(0),d.setSeconds(0),d.setMilliseconds(0);var e=(+d-+c)/864e5;if(void 0!==b.days[e])return __("when.days."+b.days[e]);if(e<4){var f=a.getDay();return __("when.daysOfWeek."+b.daysOfWeek[f])}var g=b.monthes[a.getMonth()];return a.getDate()+" "+__("when.monthes."+g)}function renderHours(a){return a.getHours()}function renderMinutes(a){var b=a.getMinutes();return b<10&&(b="0"+b),b}function set_night_counter(){cbh_glob.countdown=Math.floor((cbh_glob.chosenNightTime-+new cbh_glob.StrongDate)/1e3);doc.getElementById("clbh_timer_result").innerHTML=formatTime(cbh_glob.countdown-1)}function showNightSelects(a,b){b=void 0!==b&&b.hasOwnProperty("schedule")?b:null;var c=document.getElementsByClassName("clbh_banner-body")[0];hasClass("not-worktime-now",c)||addClass("not-worktime-now",c);var d=generateNightSelects(b);doc.getElementById("clbh_banner_h1").innerHTML=__(a).clbh_format(d.days,d.hours,d.minutes),addEventsNightSelects()}function showOfficeChoice(a){var b;if(void 0!==a&&a?(b=doc.getElementById("clbh_banner_choose_office_container"),b.style.top="0px"):b=doc.getElementById("clbh_banner_choose_office"),!b)return!1;if(!(CBHCore.params.hasCustomOffices||1==cbh_glob.h_params.show_office_choice&&cbh_glob.h_params.show_office_list&&cbh_glob.h_params.show_office_list.length))return!1;if(!b||"ru"!=lang&&"en"!=lang)return!1;if(!CBHCore.params.hasCustomOffices&&b.innerHTML.length)return b.style.display="block",!1
;var c='<div class="clbh_banner_office_wrapper" id=""><a href="javascript:void(0);" id="clbh_banner_office_current" class="clbh_banner-office-current">{}</a>';c+='<div id="clbh_banner_office_list" class="clbh_banner_office-list" style="display:none;">';var d,e=[];if(CBHCore.params.hasCustomOffices){var f=CBHCore.offices.getAll();for(var g in f)(d=f[g])&&(void 0===a&&CBHCore.helpers.isNull(d.parent_id)||void 0!==a&&d.parent_id==a)&&e.push({id:d.id,name:d.name+(null!==d.params&&d.params.hasOwnProperty("address")?'<br><span class="clbh_custom-office-address">'+d.params.address+"</span>":"")})}else e=cbh_glob.h_params.show_office_list;if(e.length<2&&!cbh_glob.strict_office_choice)return b.innerHTML="",void(e[0]&&e[0].name&&(cbh_glob.office_id=e[0].id,setCustomOfficeWorktime(cbh_glob.office_id)));!CBHCore.params.hasCustomOffices&&cbh_glob.strict_office_choice?c=c.replace(/{}/,__("clbh_banner_strict_office")):(e[0]&&e[0].name&&(c=c.replace(/{}/,e[0].name.split("<br>")[0]),cbh_glob.office_id=e[0].id),setCustomOfficeWorktime(cbh_glob.office_id));for(var h in e)e.hasOwnProperty(h)&&(c+='<div class="clbh_banner_office-list-item"><a href="javascript:void(0);" id="clbh_banner_office_'+e[h].id+'" class="clbh_banner-office-item">'+e[h].name+"</a></div>");if(c+="</div>",void 0!==a&&a){b.innerHTML=c;var i=doc.createElement("div");i.className="clbh_dropdown_button",i.onclick=function(){showOfficeList()},b.appendChild(i)}else CBHCore.params.hasCustomOffices||(b.innerHTML=__("clbh_banner_choose_office")+c,b.style.display="block");for(h in e)e.hasOwnProperty(h)&&addEvent(doc.getElementById("clbh_banner_office_"+e[h].id),"click",officeItemClicked);addEvent(doc.getElementById("clbh_banner_office_current"),"click",showOfficeList)}function showOfficeList(a){a=a||win.event,a.stopPropagation();var b=doc.getElementById("clbh_banner_office_list"),c=doc.getElementById("clbh_banner_office_current");if(!b||!c)return!1;b.style.cssText="display:;";b.offsetWidth,c.offsetWidth;b.style.cssText="display:;";var d=doc.getElementById("clbh_banner_choose_office_city");if(d){var e=d.children[0].children[1].style.maxHeight;b.style.setProperty("max-height",2+parseInt(e)+"px","important")}return!1}function officeItemClicked(){var a=doc.getElementsByClassName("clbh_banner-office-item");if(!a)return!1;for(var b=0;b<a.length;b++)removeClass("clbh_banner-office-item__selected",a[b]);var c=this;if(c){cbh_glob.office_id=parseInt(c.id.replace(/clbh_banner_office_/,""));var d=doc.getElementById("clbh_banner_office_current");d&&(d.innerHTML=c.innerHTML.split("<br>")[0])}return a=doc.getElementById("clbh_banner_office_list"),a&&(a.style.display="none"),setCustomOfficeWorktime(cbh_glob.office_id),!1}function setCustomOfficeWorktime(a){if(CBHCore.params.hasCustomOffices){var b=CBHCore.offices.getById(a);if(b){var c=document.getElementsByClassName("clbh_banner-body")[0];!b.schedule||b.schedule.isWorkTime()?(cbh_glob.widget_mode="worktime",cbh_glob.countdown=cbh_glob.countdown_hidden,cbh_glob.text_time=cbh_glob.countdown,cbh_glob.countdown_hours=Math.floor(cbh_glob.text_time_hidden/3600),hasClass("not-worktime-now",c)&&removeClass("not-worktime-now",c),doc.getElementById("clbh_banner_h1").innerHTML="ru"==lang?__("clbh_banner_h1_simple").clbh_format(cbh_glob.text_time+" "+declOfNum(cbh_glob.text_time,["секунду","секунды","секунд"])):__("clbh_banner_h1_simple").clbh_format(cbh_glob.text_time),clearInterval(cbh_glob.text_time)):(cbh_glob.widget_mode="night",cbh_glob.countdown=60*b.schedule.getMinutesBeforeStart(),cbh_glob.text_time=b.schedule.getMinutesBeforeStart(),cbh_glob.countdown_hours=Math.floor(b.schedule.getMinutesBeforeStart()/60),hasClass("not-worktime-now",c)||addClass("not-worktime-now",c),showNightSelects("clbh_banner_h1_simple_night",b.schedule),cbh_glob.text_time=setInterval(countNightModeMinutes,6e4));var d=doc.getElementById("clbh_timer_result");if(d){var e="night"===cbh_glob.widget_mode?cbh_glob.countdown:cbh_glob.text_time;d.innerHTML=formatTime(e-1)+(0==cbh_glob.countdown_hours?",99":"")}}}}function hideOfficeChoice(){var a=doc.getElementById("clbh_banner_choose_office");a&&(a.style.cssText="display:none !important;")}function checkPhone(){var a=doc.getElementById("clbh_phone");if(a){var b=getCaretPosition(a);""===a.value&&(a.value=CBHCore.getDefaultPhoneCode()),"+"!==a.value.charAt(0)&&(a.value="+"+a.value.replace("+","")),a.value=a.value.replace(/[^\d\+.]/g,""),"+"!=a.value.charAt(0)&&(a.value="+"+a.value.replace("+","")),a.value=a.value.replace(/[^\d\+.]/g,""),b&&setCaretPosition(a,b)}}function getCaretPosition(a){if(null!=a){if(void 0!==a.selectionStart)return a.selectionStart;var b=win.getSelection();if(b.createRange){var c=b.createRange(),d=doc.body.createTextRange();return d.moveToElementText(a),d.setEndPoint("EndToEnd",c),d.text.length}return!1}}function setCaretPosition(a,b){if(null!=a)if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.selectionStart?(a.focus(),a.setSelectionRange(b,b)):a.focus()}function dataProcessPermission(){if(void 0===cbh_glob.h_params.data_process||0==cbh_glob.h_params.data_process)return!1;var a='<input type="checkbox" id="cbh_data_process"><span>'+cbh_glob.h_params.data_process_text+"</span>",b=doc.createElement("div");b.className="clbh_data_process",b.innerHTML=a,document.getElementById("clbh_stat").appendChild(b)}function Countdown(a){CBHCore.helpers.isArray(a.elemId)||(a.elemId=[a.elemId]),this.elemId=a.elemId,this.elems=[];var b,c;for(var d in this.elemId)this.elemId.hasOwnProperty(d)&&("string"==typeof a.elemId[d]?(b=doc.getElementById(a.elemId[d]),c=a.elemId[d]):a.elemId[d]instanceof Element&&(b=a.elemId[d],c="cbh_cntdwn_"+Math.floor(1e3*Math.random())),b&&(this.elems[c]=b));this.time=a.time,this.template=a.template,this.msNumbers=a.msNumbers||2,this.delta=a.delta||33,this.reset()}function sliderCallback(a){if(!a.countdownObj||!a.countdownObj.running){userCaught=!0;var b=!(void 0===a||!a.office)&&a.office;if(!b&&!CBHCore.helpers.freeMode()&&show_office_choice&&CBHCore.helpers.isValidPhone(a.phone)&&(void 0!==cbh_glob.h_params.custom_office_list||cbh_glob.h_params.show_office_list&&cbh_glob.h_params.show_office_list.length>1))return void(a.fromPopup?popupDialogs.showOfficeChoice(a):sliderDialogs.showOfficeChoice(a));var c=void 0!==a&&a.deferred,d=void 0!==a&&a.night_time?a.night_time:+$("#cbh_time_deferred").val();!sendActualCallback({phone:a.phone,office_id:b,deferred:c,night_time:d})&&CBHCore.helpers.isFunction(a.errorCallback)?a.errorCallback(a):CBHCore.helpers.isFunction(a.successCallback)&&a.successCallback(a),CBHCore.is_mobile||Cobrowsing.getCode(function(a){$("#cbh-wdiget-cobrowsing-code").html($("#cbh-wdiget-cobrowsing-code").html()+" (#"+a+")")})}}function wrongNumberErrorSlider(a){sliderDialogs.main(a),callStatus.render(__("callStatus.failed")),$("#cbh_slider_phone_input").focus().css("border-color","red!important")}function wrongNumberErrorPopup(a){popupDialogs.showSimpleDialog(a,!0),$("#cbh_popup_phone_input").focus().css("border-color","red!important")}function afterCallAction(a){var b=CBHCore.helpers.extend({phone:null,countdownObj:CBHCore.helpers.freeMode()?null:new Countdown({elemId:a.countdownContainer,time:1e3*cbh_glob.countdown,template:"%minutes%:%seconds%:%ms%"}),afterCall:null},a);""!==cbh_glob.after_action_url&&((new Image).src=cbh_glob.after_action_url),CBHCore.user.setPhone(b.phone.replace(/\D+/g,"")),CBHCore.helpers.isFunction(b.afterCall)&&(!CBHCore.helpers.freeMode()&&b.countdownObj?b.countdownObj.start(b.afterCall):CBHCore.helpers.freeMode()&&b.afterCall())}function sendActualCallback(a){a=a||{};var b,c=a.phone,d=a.office_id;if(!CBHCore.helpers.isValidPhone(c))return!1;var e=CBHCore.helpers.rand(16);b=CBHCore.callTracking.catchManagerPhone(),cbh_glob.wildcallback&&(cbh_glob.widget_show_reason=7),callStatus.autoRefreshStatus=!0,a.deferred?CBHCore.server.send({phone:c,client_name:CBHCore.user.name||"",wp_code:void 0!==cbh_glob.h_params.wp_code?cbh_glob.h_params.wp_code:"",lang:CBHCore.lang.langCode,night_time:a.night_time,office_id:d,call_rand_id:e,phone_manager_tracked:b,widget_show_reason:cbh_glob.widget_show_reason,url:window.location.href,user_date:JSON.stringify({utc:(new Date).toUTCString(),local:""+new Date,utc_strong:(new StrongDate).toUTCString(),local_strong:(new StrongDate).toString()})}):(callStatus.connect(),CBHCore.server.send({phone:c,client_name:CBHCore.user.name||"",wp_code:void 0!==cbh_glob.h_params.wp_code?cbh_glob.h_params.wp_code:"",lang:CBHCore.lang.langCode,office_id:d,call_rand_id:e,phone_manager_tracked:b,widget_show_reason:cbh_glob.widget_show_reason}));var f="Callbackhunter_CALL"+(a.deferred?"_DEFERRED":"")+(CBHCore.is_mobile?"_MOBILE":"");return sendGaEvent("send","event",f,"clicked"),sendYaMetrikaEvent(f),!0}function autoCallback(a){"worktime"!==cbh_glob.widget_mode||!cbh_glob.has_minutes||!CBHCore.user.client_phone||1==cbh_glob.h_params.show_office_choice&&cbh_glob.h_params.show_office_list.length>1||CBHCore.params.hasCustomOffices&&CBHCore.params.customOffices.length>1||(a.phone=CBHCore.user.client_phone,a.afterCall=function(){popupDialogs.callResult()},cbh_glob.autocallback&&a.phone&&($("#cbh_popup_call_button").elements[0].style.display="none",$("#cbh_popup_choose_time").hide(),$(Object.keys(a.countdownObj.elems).map(function(b){return a.countdownObj.elems[b]})).show(),cbh_glob.autocallback=!1,CBHCore.cookies.set("hunter_autocallback","1",{expires:1}),cbh_glob.widget_show_reason=4,sliderCallback(a)))}function initCobrowsing(){if(0!==CBHCore.db_params.cobrowsing){var a=!1,b=function(a){a.preventDefault();var b=$("#cbh-widget-cobrowsing__code").val().trim();""!==b&&Cobrowsing.startSession(b)},c=function(a){a.preventDefault(),Cobrowsing.stop()};Cobrowsing.on("start",function(){$("#cbh-widget-cobrowsing__connect-dialog").hide(),$("#cbh-widget-cobrowsing__disconnect-dialog").show(),a=!0,userCaught=!0,hideAllUnits()}),Cobrowsing.on("hold",function(){$("#cbh-widget-cobrowsing__connect-dialog").hide(),$("#cbh-widget-cobrowsing__disconnect-dialog").hide(),a=!1}),Cobrowsing.on("stop",function(){$("#cbh-widget-cobrowsing__disconnect-dialog").hide(),a=!1}),$("#cbh-widget-cobrowsing__connect").on("click",b),$("#cbh-widget-cobrowsing__code").on("keydown",function(a){13==a.which&&b(a)}),$("#cbh-widget-cobrowsing__disconnect").on("click",c),$(window).on("keydown",function(b){a||!0===b.ctrlKey&&191===b.which&&($("#cbh-widget-cobrowsing__connect-dialog").hasClass("cbh-hide")?($("#cbh-widget-cobrowsing__connect-dialog").show(),$("#cbh-widget-cobrowsing__code").focus()):$("#cbh-widget-cobrowsing__connect-dialog").hide())}),Cobrowsing.resumeSession()}}function CursorFollower(a,b){function c(){var a,b=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}function d(a,b){this.X=a,this.Y=b}function e(a,b,c,e){this.X=a,this.Y=b,this.W=c,this.H=e,this.C=new d(a+c/2,b+e/2),this.verts=[new d(this.X,this.Y),new d(this.X+this.W,this.Y),new d(this.X+this.W,this.Y+this.H),new d(this.X,this.Y+this.H)],this.edges=function(a){return[[a[0],a[1]],[a[1],a[2]],[a[2],a[3]],[a[3],a[0]]]}(this.verts)}var f,g,h,i,j=10,k=$(a),l=function(){f=b.getBoundingClientRect(),g=new e(f.left,f.top,f.right-f.left,f.bottom-f.top)},m=function(){addEvent(doc,"mousemove",p),p()},n=function(){i.clearRect(0,0,h.width,h.height),removeEvent(doc,"mousemove",p)},o=function(a){var c=new d(CBHCore.helpers.clamp(lastX+40,40,cbh_glob.view_w-g.W-40),CBHCore.helpers.clamp(lastY+40,40,cbh_glob.view_h-g.H-40));b.style.left=c.X+"px",b.style.top=c.Y+"px",i&&i.clearRect(0,0,h.width,h.height),a&&setTimeout(function(){l(),p()},100)},p=function(b){l();var c,e,f,m,n,o=b instanceof MouseEvent?new d(b.clientX,b.clientY):new d(lastX,lastY);if(i&&i.clearRect(0,0,h.width,h.height),a.style.display="none",$("#clbh_div").hasClass("cbh-show-popup")){for(var p=0;p<4;p++)(c=q(g.edges[p][0],g.edges[p][1],o))&&(!e||r(c,o)<r(e,o))&&(e=c);if(!e||g.X<o.X&&o.X<g.X+g.W&&g.Y<o.Y&&o.Y<g.Y+g.H){if(!e&&i){var s=t(o,g.verts),u=-(o.X-s.X)/r(o,s),v=(o.Y-s.Y)/r(o,s),w=o.X-g.C.X,x=o.Y-g.C.Y,y=[];w>0&&x>0?y=[new d(25+g.W-2,25+g.H-25),new d(25+g.W-j*u,25+g.H+j*v),new d(25+g.W-25,25+g.H-2)]:w<0&&x>0?y=[new d(25,25+g.H-25),new d(25-j*u,25+g.H+j*v),new d(50,25+g.H-2)]:w<0&&x<0?y=[new d(25,50),new d(25-j*u,25+j*v),new d(50,25)]:w>0&&x<0&&(y=[new d(25+g.W-2,50),new d(25+g.W-j*u,25+j*v),new d(25+g.W-25,25)]),i.beginPath(),i.moveTo(y[0].X,y[0].Y),i.lineTo(y[1].X,y[1].Y),i.lineTo(y[2].X,y[2].Y),i.fill()}}else{if(f=new d(e.X-g.X,e.Y-g.Y),k.removeClass("top").removeClass("bottom").removeClass("right").removeClass("left"),f.Y>0&&f.Y<g.H&&(0==f.X||f.X==g.W))m=CBHCore.helpers.clamp(f.Y-28,10,g.H-28),0==f.X?(k.addClass("left"),n=f.X-28):(k.addClass("right"),n=f.X);else{if(!(f.X>0&&f.X<g.W)||0!=f.Y&&f.Y!=g.H)return;n=CBHCore.helpers.clamp(f.X-28,10,g.W-28),0==f.Y?(k.addClass("top"),m=f.Y-28):(k.addClass("bottom"),m=f.Y)}a.style.top=m+"px",a.style.left=n+"px",a.style.display="block"}}},q=function(a,b,c){var e=c.X-a.X,f=b.X-a.X,g=c.Y-a.Y,h=b.Y-a.Y,i=(e*f+g*h)/(f*f+h*h),j=new d(a.X+i*f,a.Y+i*h);return!!s(a,j,b)&&j},r=function(a,b){var c=a.X-b.X,d=a.Y-b.Y;return Math.sqrt(c*c+d*d)},s=function(a,b,c){return Math.abs(r(a,b)+r(b,c)-r(a,c))<1e-6},t=function(a,b){for(var c,d,e=0,f=0;f<b.length;f++)d=r(a,b[f]),(!c||d<e)&&(c=b[f],e=d);return c};return function(){l(),h=doc.getElementById("cbh_popup_canvas"),h||(h=doc.createElement("canvas"),h.id="cbh_popup_canvas",h.width=g.W+50,h.height=g.H+50,h.style.position="absolute",h.style.top="-25px",h.style.left="-25px",b.appendChild(h)),h.getContext&&(i=h.getContext("2d"),i.fillStyle="white"),addEvent(a,c(),function(){n(),m()})}(),{start:m,stop:n,jumpToMouse:o}}function showSimpleDialog(a){var b=(new cbh_glob.StrongDate).getTime();!a&&b-cbh_glob.activity_last_ts>1e4||popupDialogs.showSimpleDialog({},a)}function showDialog(){(new cbh_glob.StrongDate).getTime()-cbh_glob.activity_last_ts>1e4||ClbhObject.showWidgetEnter()}function Position(a,b){this.X=a,this.Y=b,this.Add=function(a){var b=new Position(this.X,this.Y);return null!==a&&(isNaN(a.X)||(b.X+=a.X),isNaN(a.Y)||(b.Y+=a.Y)),b},this.Subtract=function(a){var b=new Position(this.X,this.Y);return null!=a&&(isNaN(a.X)||(b.X-=a.X),isNaN(a.Y)||(b.Y-=a.Y)),b},this.Min=function(a){var b=new Position(this.X,this.Y);return null==a?b:(!isNaN(a.X)&&this.X>a.X&&(b.X=a.X),!isNaN(a.Y)&&this.Y>a.Y&&(b.Y=a.Y),b)},this.Max=function(a){var b=new Position(this.X,this.Y);return null==a?b:(!isNaN(a.X)&&this.X<a.X&&(b.X=a.X),!isNaN(a.Y)&&this.Y<a.Y&&(b.Y=a.Y),b)},this.Bound=function(a,b){return this.Max(a).Min(b)},this.Check=function(){var a=new Position(this.X,this.Y);return isNaN(a.X)&&(a.X=0),isNaN(a.Y)&&(a.Y=0),a},this.Apply=function(a){"string"==typeof a&&(a=doc.getElementById(a)),null!=a&&(isNaN(this.X)||(a.style.right=this.X+"px"),isNaN(this.Y)||(a.style.bottom=this.Y+"px"))}}function absoluteCursorPostion(a){return a=a||window.event,isNaN(window.scrollX)?new Position(cbh_glob.view_w-(a.clientX+doc.documentElement.scrollLeft+doc.body.scrollLeft),cbh_glob.view_h-(a.clientY+doc.documentElement.scrollTop+doc.body.scrollTop)):new Position(cbh_glob.view_w-(a.clientX+window.scrollX),cbh_glob.view_h-(a.clientY+window.scrollY))}function DragObject(a,b,c,d,e,f,g,h){function i(c){if(c=c||window.event,!s&&u&&!v&&"SELECT"!==c.target.tagName&&("INPUT"!==c.target.tagName||"tel"!==c.target.type&&"text"!==c.target.type)){k(c),s=!0,null!=e&&e(c,a),q=absoluteCursorPostion(c);var d,f;if(CBHCore.helpers.isFunction(win.getComputedStyle)){var g=win.getComputedStyle(a);d=g.bottom,f=g.right}else d=a.style.bottom,f=a.style.right;var h=helpers.getSliderDims(),i=h[a.className.indexOf("chat")>=0?"chat":"call"].width>=b;return y=i?b-65:0,r=new Position(parseInt(f),parseInt(d)),r=r.Check(),r.X<=(cbh_glob.view_w-65)/2?p=!1:r.X>(cbh_glob.view_w-65)/2&&(p=!0),addEvent(doc,"mousemove",l),addEvent(doc,"mouseup",m),!1}}function j(a){var b=absoluteCursorPostion(a).Add(r).Subtract(q);return b=b.Bound(c,d)}function k(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}function l(b){if(b=b||window.event,k(b),s&&!v){var c=j(b);if(p&&!x?c.X-=y:!p&&x&&(c.X+=y),!(0>c.X||c.X>cbh_glob.view_w-65))return x&&c.X<=(cbh_glob.view_w-65)/2?(w.removeClass("cbh-leftside"),x=!1):!x&&c.X>(cbh_glob.view_w-65)/2&&(w.addClass("cbh-leftside"),x=!0),c.Apply(a),null!=f&&f(c,a),!1}}function m(a){return n(a),!0}function n(b){if(s&&!v){movePopupToButton();var c=j(b);t=q.Subtract(absoluteCursorPostion(b)),t=Math.sqrt(t.X*t.X+t.Y*t.Y),t>10&&CBHCore.helpers.savePositionCookie(c.X,c.Y,a.className.replace("cbh-leftside","").trim()),removeEvent(doc,"mousemove",l),removeEvent(doc,"mouseup",m),q=null,r=null,null!=g&&g(a),s=!1}}if("string"==typeof a&&(a=doc.getElementById(a)),null!=a){if(null!=c&&null!=d){var o=c.Min(d);d=c.Max(d),c=o}var p,q=null,r=null,s=!1,t=0,u=!1,v=!1,w=$(a),x=!1,y=0;!function(){var b;if(CBHCore.helpers.isFunction(win.getComputedStyle)){var c=win.getComputedStyle(a);b=parseInt(c.right)}else b=parseInt(a.style.right);b<=(cbh_glob.view_w-65)/2?(w.removeClass("cbh-leftside"),x=!1):b>(cbh_glob.view_w-65)/2&&(w.addClass("cbh-leftside"),x=!0)}(),this.StartListening=function(){u||v||(u=!0,addEvent(a,"mousedown",i))},this.StopListening=function(b){u&&!v&&(removeEvent(a,"mousedown",i),u=!1,b&&s&&n())},this.isDragging=function(){return s},this.lastDragDist=function(){return t},h||this.StartListening()}}function init(){function a(){var a=new cbh_glob.StrongDate(+new cbh_glob.StrongDate+2592e6),b=doc.getElementById("cbh_widget_button_chat_close").closest(".cbh-chat-container");CBHCore.cookies.set("hunter_chat_closed",1,{expires:a}),b.style.setProperty("display","none","important"),addClass("cbh-hide",doc.getElementById("cbh_widget_button_chat_close"))}function b(){var a=new cbh_glob.StrongDate(+new cbh_glob.StrongDate+2592e6),b=doc.getElementById("cbh_widget_micromenu").closest(".cbh-widget-callopen");CBHCore.cookies.set("hunter_micromenu_closed",1,{expires:a}),b.style.setProperty("display","none","important")}if(init_base(),WebFontConfig={google:{families:["Roboto:100,400,700,300:latin,cyrillic"]}},function(){var a=doc.createElement("script");a.src=("https:"==doc.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=doc.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),void 0!==cbh_glob.h_params.show_micromenu_close&&1==cbh_glob.h_params.show_micromenu_close){if(addEvent(doc.getElementById("cbh_widget_micromenu"),"mousedown",function(){b()}),addEvent(doc.getElementById("cbh_widget_button_chat_close"),"mousedown",function(){a()}),function(){return 1===CBHCore.cookies.get("hunter_micromenu_closed")&&void 0!==cbh_glob.h_params.show_micromenu_close&&1===cbh_glob.h_params.show_micromenu_close}()){var c=doc.getElementById("cbh_widget_micromenu").closest(".cbh-widget-callopen");c.style.setProperty("display","none","important")}if(function(){return 1===CBHCore.cookies.get("hunter_chat_closed")&&void 0!==cbh_glob.h_params.show_micromenu_close&&1===cbh_glob.h_params.show_micromenu_close}()){var c=doc.getElementById("cbh_widget_button_chat_close").closest(".cbh-chat-container");c.style.setProperty("display","none","important")}}else{var d=doc.getElementById("cbh_widget_micromenu"),e=doc.getElementById("cbh_widget_button_chat_close");d&&d.parentNode.removeChild(d),e&&e.parentNode.removeChild(e)}if(navigator.appVersion,-1!=navigator.appVersion.indexOf("Win")&&$("body").addClass("windows-platform"),void 0!==cbh_glob.h_params.show_powered_by&&(cbh_glob.show_powered_by=1===parseInt(cbh_glob.h_params.show_powered_by)),void 0!==cbh_glob.h_params.free_mode&&(cbh_glob.free_mode=0!=parseInt(cbh_glob.h_params.free_mode)),void 0!==cbh_glob.h_params.time_connection&&(cbh_glob.countdown=parseInt(cbh_glob.h_params.time_connection)),void 0!==cbh_glob.h_params.sociallike_url&&cbh_glob.h_params.sociallike_url.length>0&&CBHCore.helpers.isValidURL(cbh_glob.h_params.sociallike_url)&&(sociallike_url=cbh_glob.h_params.sociallike_url,/^https?:\/\//.test(sociallike_url)||(sociallike_url="http://"+sociallike_url)),void 0!==cbh_glob.h_params.comments_url&&cbh_glob.h_params.comments_url.length>0&&CBHCore.helpers.isValidURL(cbh_glob.h_params.comments_url)&&(comments_url=cbh_glob.h_params.comments_url,/^https?:\/\//.test(comments_url)||(comments_url="http://"+comments_url)),void 0!==cbh_glob.h_params.has_payments&&(has_payments=0!=parseInt(cbh_glob.h_params.has_payments)),void 0!==cbh_glob.h_params.external_chat&&externalChat.init(cbh_glob.h_params.external_chat,function(a){a&&$(".cbh-widget-msg-wr").show()}),void 0!==cbh_glob.h_params.phoneicon_x&&(phoneicon_x=cbh_glob.h_params.phoneicon_x),void 0!==cbh_glob.h_params.phoneicon_y&&(phoneicon_y=cbh_glob.h_params.phoneicon_y),void 0!==cbh_glob.h_params.show_office_choice&&(show_office_choice=0!==parseInt(cbh_glob.h_params.show_office_choice)),void 0!==cbh_glob.h_params.min_popup_delay&&parseInt(cbh_glob.h_params.min_popup_delay)>0){var f=Math.ceil((+new StrongDate-CBHCore.storage.get("entrance_time","session"))/1e3);cbh_glob.min_popup_delay=parseInt(cbh_glob.h_params.min_popup_delay)-f}if($(win).on("resize",repositionWidget),repositionWidget(),init_slider(),CBHCore.is_mobile||(init_plank(),init_slide(),initCobrowsing()),!CBHCore.helpers.freeMode()||cbh_glob.h_params.sms_only){var g=CBHCore.brand_image||cbh_glob.h_params.brand_image,h=CBHCore.brand_logo||cbh_glob.h_params.brand_logo,i=CBHCore.brand_large_logo||cbh_glob.h_params.brand_large_logo,j=CBHCore.brand_v5_popup_bg||cbh_glob.h_params.brand_v5_popup_bg,k=CBHCore.brand_v5_popup_video||cbh_glob.h_params.brand_v5_popup_video,l=CBHCore.brand_v5_slider_bg||cbh_glob.h_params.brand_v5_slider_bg,m=CBHCore.brand_v5_slider_video||cbh_glob.h_params.brand_v5_slider_video,n=CBHCore.brand_v5_button_bg||cbh_glob.h_params.brand_v5_button_bg;g&&$(".clbh_banner-body").addClass("cbh-brand-image").css({"background-image":"url(//"+CBHCore.opt.static_domain+"/uploads/brand/"+g+")"}),h&&$(".cbh-widget-button-logo").addClass("cbh-branded").css({"background-image":"url(//"+CBHCore.opt.static_domain+"/uploads/brand_logo/"+h+")"});var o="";if(CBHCore.external_settings&&void 0!==CBHCore.external_settings.widget_banner_logo){var p=$(CBHCore.external_settings.widget_banner_logo).elements[0];p&&(o=p.getAttribute("src"))}else CBHCore.external_settings&&void 0!==CBHCore.external_settings.widget_banner_logo_url&&(o=CBHCore.external_settings.widget_banner_logo_url);!o&&i&&(o="//"+CBHCore.opt.static_domain+"/uploads/brand_large_logo/"+i),o&&CBHCore.helpers.addCSSRules({"#clbh_div #cbh_popup #brand .cbh-brand-main":"background-image: url("+o+")"});var q;k?(q=helpers.youtube_parser(k))&&($("#cbh_popup_video").attr("src",helpers.getEmbeddedYTForWidget(q)),$(".cbh-body-wrapper").addClass("cbh-branded")):j&&$(".cbh-body-wrapper").addClass("cbh-branded").css({background:"url(//"+CBHCore.opt.static_domain+"/uploads/brand_v5_popup_bg/"+j+")"}),m?(q=helpers.youtube_parser(m))&&($(".cbh-slider-video").attr("src",helpers.getEmbeddedYTForWidget(q)),$(".cbh-widget-call__container").addClass("cbh-branded-video cbh-branded")):l&&$(".cbh-widget-call__container").addClass("cbh-branded").css({background:"url(//"+CBHCore.opt.static_domain+"/uploads/brand_v5_slider_bg/"+l+") !important;"}),n&&$(".cbh-widget-button").addClass("cbh-branded").css({background:"url(//"+CBHCore.opt.static_domain+"/uploads/brand_v5_button_bg/"+n+") !important;"})}}function initUnits(){units={call:{visible:"main",phoneButton:$(".cbh-widget-button-phone"),blocks:{main:{width:515,elem:$(".cbh-widget-call")},button:{width:65,elem:$(".cbh-widget-callopen-wr")}},start:function(){var a;(a=!1===CBHCore.storage.get("is_cbh-call-unit-main-visible","session")?0==cbh_glob.h_params.slider_call_open_delay:0!==CBHCore.storage.get("is_cbh-call-unit-main-visible","session"))||(this.visible="button")},onmouseout:function(){this.phoneButton.addClass("cbh-active"),setTimeout(function(){this.phoneButton.removeClass("cbh-active")}.bind(this),5e3)},show:function(a){var b=$(".cbh-widget-callopen"),c=$(".cbh-widget-call");c.hasClass("cbh-widget-call_closed")&&(b.addClass("cbh-widget-open"),b.addClass("cbh-widget-transition"),setTimeout(function(){c.removeClass("cbh-widget-call_closed"),b.removeClass("cbh-widget-transition")},600)),sliderDialogs.main(),a&&CBHCore.storage.save("is_cbh-call-unit-main-visible",1,"session")},hide:function(a){var b=$(".cbh-widget-callopen"),c=$(".cbh-widget-call");b.removeClass("cbh-widget-open"),c.addClass("cbh-widget-call_closed"),b.addClass("cbh-widget-transition"),setTimeout(function(){b.removeClass("cbh-widget-transition")},600),a&&CBHCore.storage.save("is_cbh-call-unit-main-visible",0,"session")}},chat:{visible:!1,blocks:{main:{width:330,elem:$(".cbh-widget-chat")},button:{width:65,elem:$(".cbh-widget-msg-wr")}},badgeNum:0,show:function(){"tg"==cbh_glob.h_params.internal_chat||1==cbh_glob.h_params.tg_chat?tgChat.connect():"vk"==cbh_glob.h_params.internal_chat?vkChat.connect():"fb"==cbh_glob.h_params.internal_chat?fbChat.connect():"sl"==cbh_glob.h_params.internal_chat&&slChat.connect(),this.badge(0);var a=$(".cbh-widget-chat__container"),b=$(".cbh-widget-chat"),c=$(".cbh-widget-msg");if(b.hasClass("cbh-widget-chat_closed")){var d=a.outerWidth();$(".cbh-widget-msg__button").css("width",d+"px").css("height",a.outerHeight()+"px"),setTimeout(function(){c.css("opacity",0),b.css("opacity",1)},300),setTimeout(function(){c.addClass("cbh-widget-msg_closed"),b.removeClass("cbh-widget-chat_closed")},600)}},hide:function(){var a=$(".cbh-widget-chat__container"),b=$(".cbh-widget-chat"),c=$(".cbh-widget-msg"),d=$(".cbh-widget-msg__button");d.css("bottom",0).css("right",0).css("width",a.outerWidth()+"px").css("height",a.outerHeight()+"px"),c.removeClass("cbh-widget-msg_closed"),b.addClass("cbh-widget-chat_closed"),c.css("opacity",1),b.css("opacity",0),setTimeout(function(){d.css("width","65px").css("height","65px")},100)},badge:function(a){var b=$(".cbh-widget-msg-wr").findChild(".cbh-widget-alert");0===a||"worktime"!==cbh_glob.widget_mode?b.hide():(b.findChild(".cbh-button-balloon-num").html(a),b.show()),this.badgeNum=a}}},hideAllUnits=function(){Object.keys(units).forEach(function(a){units[a]._hide()})},Object.keys(units).forEach(function(a){var b=units[a];"call"===a&&b.blocks.button.elem.on("mouseout",function(a){for(var c=a.toElement||a.relatedTarget;c&&c.parentNode&&c.parentNode!=window;){if(c.parentNode==this||c==this)return c.preventDefault&&c.preventDefault(),!1;c=c.parentNode}b.onmouseout()}),b._show=function(c){if(!("call"===a&&cbh_glob.clbh_call_draggable.lastDragDist()>10||"chat"===a&&cbh_glob.clbh_chat_draggable.lastDragDist()>10)&&(c&&c.preventDefault(),"main"!==b.visible)){if(hideAllUnits(),b.action)return b.action();b.visible="main",repositionUnit(a),b.show(c),unitExpanded=!0}},b._hide=function(c){"call"===a&&cbh_glob.clbh_call_draggable.lastDragDist()>10||"chat"===a&&cbh_glob.clbh_chat_draggable.lastDragDist()>10||(c&&c.preventDefault(),b.action||"main"===b.visible&&(b.hide(c),b.visible="button",repositionUnit(a),unitExpanded=!1))},b.blocks.button.elem.on("click",function(a){$(a.target).hasClass("cbh-widget-button-close")||b._show(a)}),b.blocks.main.elem.findChild(".cbh-widget__close").on("click",function(a){$(a.target).hasClass("cbh-widget-button-close")||b._hide(a)}),b.start&&b.start()})}function repositionUnits(){repositionUnit("call"),repositionUnit("chat")}function repositionUnit(a){var b=units[a];b.visible&&b.blocks[b.visible].elem.css("right",0)}function init_slider(){function a(a,b){return a.reduce(function(a,c){return a[c]=b,a},{})}if(!CBHCore.is_mobile){var b;if(cbh_glob.h_params.phone_icon_color_code)b=cbh_glob.h_params.phone_icon_color_code;else if(cbh_glob.h_params.phone_icon_color)switch(cbh_glob.h_params.phone_icon_color){case"green":b="00aff2";break;case"gray":b="cccccc"}CBHCore.helpers.addCSSRules(a(["#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-button","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-call__close","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-chat__close","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-ph-circle-fill","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-call__btn","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-chat__btn","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-call-container .cbh-widget-call__phone__wr .CBH-masks .flags .lists::-webkit-scrollbar-thumb"],"background-color: #"+b+"!important;")),CBHCore.helpers.addCSSRules(a(["#clbh_div.cbh-wrapper #cbh_popup.cbh-popup-wrapper .cbh-body-wrapper"],"background-color: #"+b+";")),CBHCore.helpers.addCSSRules(a(["#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-button","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-call-container .cbh-widget-call__btn-area .cbh-widget-call__btn","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-call-container .cbh-widget-call__close","#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-chat-container .cbh-widget-chat__close"],"box-shadow: 0 0 2px 0 #"+b+"!important;-webkit-box-shadow: 0 0 2px 0 #"+b+"!important;")),CBHCore.helpers.addCSSRules(a(["#clbh_div #cbh_widget_wrapper .cbh-widget .cbh-widget-callopen-wr .cbh-ph-circle","#clbh_div.cbh-wrapper #cbh_popup .cbh-form-line .cbh-btn"],"border-color: #"+b+"!important;")),CBHCore.helpers.addCSSRules(a(["#clbh_div.cbh-wrapper #cbh_popup.cbh-popup-wrapper .cbh-body-wrapper .cbh-window-controls .cbh-controls.cbh-close-button svg polygon","#clbh_div.cbh-wrapper #cbh_popup.cbh-popup-wrapper .cbh-body-wrapper .cbh-window-controls .cbh-controls.cbh-minimize-button svg rect"],"fill: #"+b)),CBHCore.helpers.addCSSRules({"#clbh_div.cbh-wrapper #cbh_popup .cbh-form-line .cbh-btn":"background: #"+b+"!important;"})}$(".cbh-widget").css("z-index",maxzIndex),$("#clbh_div").addClass("cbh-"+CBHCore.lang.langCode),setTimeout(function(){maxzIndex=Math.max.apply(null,[].map.call(doc.querySelectorAll("*"),function(a){return void 0!==a.style?+a.style.zIndex:1}))+10,$(".cbh-widget").css("z-index",maxzIndex),$("#cbh_widget_wrapper").css("z-index",maxzIndex)},3e3),initUnits(),cbh_glob.h_params.slider_call_open_delay>0&&setTimeout(function(){0!==CBHCore.storage.get("is_cbh-call-unit-main-visible","session")&&units.call._show()},1e3*cbh_glob.h_params.slider_call_open_delay);var c=function(){units.chat.visible="button",$(".cbh-widget-msg-wr").show()};"tg"==cbh_glob.h_params.internal_chat||1==cbh_glob.h_params.tg_chat?(c(),chat.init()):"vk"==cbh_glob.h_params.internal_chat?(c(),vkchat.init()):"fb"==cbh_glob.h_params.internal_chat?(c(),fbchat.init()):"sl"==cbh_glob.h_params.internal_chat&&(c(),slchat.init()),externalChat.chosenService&&(c(),units.chat.action=externalChat.open.bind(externalChat)),repositionUnits(),callStatus.render=function(a){$("#cbh_slider_header").html(a)};var d=helpers.getSliderDims();cbh_glob.clbh_call_draggable=new DragObject($(".cbh-call-container").elements[0],515,new Position(cbh_glob.view_w-65-5,cbh_glob.view_h-d.call.height-15),new Position(-d.call.width-65,0),null,null,null,!1),cbh_glob.clbh_chat_draggable=new DragObject($(".cbh-chat-container").elements[0],343,new Position(cbh_glob.view_w-65-5,cbh_glob.view_h-d.chat.height-15),new Position(-d.chat.width-65,0),null,null,null,!1)}function init_plank(){plankDialogs=new PlankDialogs}function init_slide(){function a(a,b){var d="";return CBHCore.helpers.isset(CBHCore[a])?d=CBHCore[a]:CBHCore.helpers.isset(cbh_glob.h_params[a])?d=cbh_glob.h_params[a]:c=b,d}var b=a("enable_slide",!1);if(b&&"0"!=b){var c=CBHCore.storage.get("slide_countdown","session");c||(c=a("slide_timer",0)),slideDialogs=new SlideDialogs({text:a("slide_text",""),textSize:a("slide_text_size",""),image:a("slide_image",""),countdown:c})}}function drawPhone(){var a
;a=!1===CBHCore.storage.get("is_cbh-call-unit-main-visible","session")?0==cbh_glob.h_params.slider_call_open_delay:0!==CBHCore.storage.get("is_cbh-call-unit-main-visible","session");var b="";"tg"==cbh_glob.h_params.internal_chat||1==cbh_glob.h_params.tg_chat?b=CBHCore.helpers.compilePoweredBy("powered_by_chat"):"vk"==cbh_glob.h_params.internal_chat&&(b=CBHCore.helpers.compilePoweredBy("powered_by_chat_vk"));var c=tpl.slider_main({chat:tpl.slider_chat_container(),powered_by:CBHCore.helpers.compilePoweredBy("powered_by"),powered_by_chat:b,"class_cbh-widget-call":a?"":"cbh-widget-call_closed","class_cbh-widget-callopen":a?"cbh-widget-open":""});doc.getElementById("clbh_div").insertAdjacentHTML("beforeend",c),setButtonCSS(),sliderDialogs.main(),CBHCore.user.client_phone&&callStatus.connect(),0==cbh_glob.phoneiconScrollOffset&&showPhoneIcon(),widgetIconAnimation.init(),CBHCore.is_mobile||$(".cbh-widget-callopen-wrt").on("mouseover",function(){widgetIconAnimation.stop()}).on("mouseleave",function(){widgetIconAnimation.reset()})}function setButtonCSS(){["call","chat"].forEach(function(a){var b=doc.getElementsByClassName("cbh-widget-button-"+a);if(b.length>0){b=b[0];var c="";CBHCore.db_params.hasOwnProperty(a+"_button_text_enabled")&&1==CBHCore.db_params[a+"_button_text_enabled"]&&(CBHCore.db_params.hasOwnProperty(a+"_button_text")&&(b.innerHTML=CBHCore.db_params[a+"_button_text"]),CBHCore.db_params.hasOwnProperty(a+"_button_text_size")&&(c+="font-size:"+CBHCore.db_params[a+"_button_text_size"]+"px !important;"),CBHCore.db_params.hasOwnProperty(a+"_button_text_pos_x")&&(c+="left:"+CBHCore.db_params[a+"_button_text_pos_x"]+"px !important;",c+="top:"+CBHCore.db_params[a+"_button_text_pos_y"]+"px !important;")),b.style.cssText=c}})}function showPhoneIcon(){$("#cbh_widget_wrapper").addClass("cbh-show")}function hidePhoneIcon(){$("#cbh_widget_wrapper").removeClass("cbh-show")}function repositionWidget(){CBHCore.is_mobile||(cbh_glob.viewportSize=CBHCore.helpers.viewportSize(),cbh_glob.view_w=cbh_glob.viewportSize.width,cbh_glob.view_h=cbh_glob.viewportSize.height,["call","chat"].forEach(function(a){var b="cbh-"+a+"-container",c=CBHCore.helpers.getPositionCookie(b),d=$("."+b);if(!CBHCore.helpers.isNumeric(c.X)||!CBHCore.helpers.isNumeric(c.Y)){var e=helpers.getSliderDims();c.X=(cbh_glob.view_w-85)*(100-phoneicon_x)/100,c.Y=(cbh_glob.view_h-e.call.height)*(100-phoneicon_y)/100-10,"chat"===a&&(c.Y+=80)}c.X=CBHCore.helpers.clamp(c.X,10,cbh_glob.viewportSize.width-80),c.Y=CBHCore.helpers.clamp(c.Y,0,cbh_glob.viewportSize.height),c.X<=(cbh_glob.view_w-65)/2?d.removeClass("cbh-leftside"):c.X>(cbh_glob.view_w-65)/2&&d.addClass("cbh-leftside"),new Position(c.X,c.Y).Apply(d.elements[0])}))}function redrawPhone(){cbh_glob.view_w=!doc.compatMode&&!cbh_glob.isIE||cbh_glob.isOpera?(doc.parentwin||doc.defaultView).innerWidth:"CSS1Compat"==doc.compatMode?doc.documentElement.clientWidth:doc.body.clientWidth,cbh_glob.view_h=!doc.compatMode&&!cbh_glob.isIE||cbh_glob.isOpera?(doc.parentWindow||doc.defaultView).innerHeight:"CSS1Compat"==doc.compatMode?doc.documentElement.clientHeight:doc.body.clientHeight;var a=.5*cbh_glob.view_w-815+14.3*cbh_glob.phoneicon_x;a>cbh_glob.view_w-200&&(a=cbh_glob.view_w-200),a<0&&(a=0)}function drawWidget(){parseCustomLang();var a=doc.createElement("div");a.innerHTML=tpl.main({powered_by:CBHCore.helpers.compilePoweredBy("powered_by"),cobrowsing_dialogs:tpl.cobrowsing_dialogs()}),doc.body.appendChild(a.childNodes[0]),$(".cbh-window-controls").on("click",function(){hideDialog()}),$("#clbh_div").on("click",function(a){this===a.target&&hideDialog()})}function hideDialog(){$("#clbh_div").removeClass("cbh-show-popup"),helpers.getCursorFollower().stop(),cbh_glob.h_params.phone_icon&&showPhoneIcon(),movePopupToButton(),sendGaEvent("send","event","Callbackhunter_CLOSE","clicked"),sendYaMetrikaEvent("Callbackhunter_CLOSE")}function movePopupToButton(){var a,b=$(".cbh-widget-callopen-wr"),c=$("#cbh_popup");b.elements.length&&c.elements.length&&(a=b.elements[0].getBoundingClientRect(),c.elements[0].style.left=a.left-335+"px",c.elements[0].style.top=a.top-62.5+"px")}function showWidget(){if("worktime"===cbh_glob.widget_mode&&1!=cbh_glob.block_auto_popup){cbh_glob.widget_show_reason=3;var a=getCustomEventReplace("showWidget");if(a)try{ClbhObject[a]()}catch(a){}else{clearTimeout(cbh_glob.dialog_timer);$("#clbh_div").hasClass("cbh-show-popup")||(ClbhObject.showWidgetExit(),cbh_glob.block_auto_popup=!0,CBHCore.cookies.get("hunter_showed")||setShowCookie())}}}var define,module,cbh_glob={timer:null,dialog_timer:null,distance_timer:null,block_show_banner:!1,send_data:{},countdown:26,text_time:26,countdown_hours:0,counter:null,msEmu:999,msTimer:null,statusbar_display:"block",activity_t:null,activity_last_ts:null,activity_exit_event:!1,h_params:null,allow_subdomain:!1,accelerometr_etalon:1e3,accelerometr_start:1e3,accelerometr_step:8,accelerometr_koeff:1,block_auto_popup:!1,min_popup_delay:0,minPopupTimer:null,avgTimer:null,avgTimerSec:0,show_enter:!0,show_exit:!0,phone_code:"",office_id:0,strict_office_choice:!1,call_rand_id:"",custom_layout:null,widget_mode:"night",mode_timer:null,minutes_rest:0,countdown_hidden:26,text_time_hidden:26,countdown_hours_hidden:0,chosenNightTime:0,night_mode_timer:null,night_minutes_counter:0,makeMeasureDistance:!0,totalDistance:0,lastSeenAt:{x:null,y:null},totalScrollDistance:0,lastSeenScrollAt:null,phoneiconScrollOffset:100,ua:navigator.userAgent.toLowerCase(),phoneicon_x:90,phoneicon_y:100,after_action_url:"",has_minutes:!0,has_payments:!1,autocallback:!1,wildcallback:!1,wild_id:!1,wild_type:!1,wild_stat_raw_id:!1,wild_from_domain:!1,parent_call_id:!1,widget_show_reason:null,StrongDate:Date,schedule:null,clbh_phone_draggable:null,enable_masks:CBHCore.db_params.enable_masks,show_powered_by:!0,noScaling:!1};cbh_glob.isOpera=cbh_glob.ua.indexOf("opera")>-1,cbh_glob.isIE=!cbh_glob.isOpera&&cbh_glob.ua.indexOf("msie")>-1,cbh_glob.view_w=!document.compatMode&&!cbh_glob.isIE||cbh_glob.isOpera?(document.parentWindow||document.defaultView).innerWidth:"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth,cbh_glob.view_h=!document.compatMode&&!cbh_glob.isIE||cbh_glob.isOpera?(document.parentWindow||document.defaultView).innerHeight:"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight;var ga_cbh=function(){},yaMetrikaName=null,Masked=CBHCore.Masked,cbh_glob=cbh_glob||{};cbh_glob.free_mode=!1,cbh_glob.countdown=26,cbh_glob.autocallback=!1,cbh_glob.wildcallback=!1,cbh_glob.h_params=null,cbh_glob.custom_layout=null,cbh_glob.widget_show_reason=null,cbh_glob.viewportSize=CBHCore.helpers.viewportSize(),cbh_glob.view_w=cbh_glob.viewportSize.width,cbh_glob.view_h=cbh_glob.viewportSize.height,cbh_glob.phoneiconScrollOffset=0;var StrongDate=Date,comments_url="https://callbackhunter.com/blog/stena-lyubvigneva/",sociallike_url="http://callbackhunter.com",icon_logo_only=!1,phoneicon_x=90,phoneicon_y=100,maxzIndex=9e6,show_office_choice=!1,cursorFollower,plankDialogs,slideDialogs,userCaught=!1,has_payments=!1,Masked=CBHCore.Masked,avail_lang=CBHCore.lang.avail_lang,lang=CBHCore.lang.langCode,__=function(a,b){return CBHCore.lang.translate(a,b)},W=null,X=null,Y=null,Z=4e3,lastX=null,lastY=null;doc.getElementsByClassName||(doc.getElementsByClassName=function(a){var b,c=doc.body.getElementsByTagName("*"),d=c.length,e=[];for(b=0;b<d;b+=1)-1!==c[b].className.indexOf(a)&&e.push(c[b]);return e});var addEvent=null,removeEvent=null;doc.addEventListener?(addEvent=function(a,b,c){a&&a.addEventListener(b,c,!1)},removeEvent=function(a,b,c){a&&a.removeEventListener(b,c,!1)}):(addEvent=function(a,b,c){a&&a.attachEvent("on"+b,c)},removeEvent=function(a,b,c){a&&a.detachEvent("on"+b,c)}),String.prototype.clbh_format=function(){var a=this;for(var b in arguments)arguments.hasOwnProperty(b)&&(a=a.replace("{"+b+"}",arguments[b]));return a},CBHCore.telemetry.on("inputFocus",function(){cbh_glob.block_show_banner=!0}),CBHCore.telemetry.on("activity",function(){cbh_glob.activity_exit_event=!0});var CBHEvents=CBHCore.helpers.extend(CBHCore.CBHEvents,{}),linkify=function(){var a="(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))",b="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",c=new RegExp("(?:\\b[a-z\\d.-]+://[^<>\\s]+|\\b"+a+"(?:[;/][^#?<>\\s]*)?"+b+"(?!\\w)|(?:mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+a+b+"(?!\\w))","ig"),d=new RegExp("^[a-z\\d.-]+://","i"),e={"'":"`",">":"<",")":"(","]":"[","}":"{","»":"«","›":"‹"},f={callback:function(a,b){return b?'<a href="'+b+'" title="'+b+'">'+a+"</a>":a},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(a,b){b=b||{};var g,h,i,j,k,l,m,n,o,p,q,r,s="",t=[];for(h in f)void 0===b[h]&&(b[h]=f[h]);for(;g=c.exec(a);)if(i=g[0],l=c.lastIndex,m=l-i.length,!/[\/:]/.test(a.charAt(m-1))){do{n=i,r=i.substr(-1),q=e[r],q&&(o=i.match(new RegExp("\\"+q+"(?!$)","g")),p=i.match(new RegExp("\\"+r,"g")),(o?o.length:0)<(p?p.length:0)&&(i=i.substr(0,i.length-1),l--)),b.punct_regexp&&(i=i.replace(b.punct_regexp,function(a){return l-=a.length,""}))}while(i.length&&i!==n);j=i,d.test(j)||(j=(-1!==j.indexOf("@")?j.indexOf("mailto:")?"mailto:":"":j.indexOf("irc.")?j.indexOf("ftp.")?"http://":"ftp://":"irc://")+j),k!=m&&(t.push([a.slice(k,m)]),k=l),t.push([i,j])}for(t.push([a.substr(k)]),h=0;h<t.length;h++)s+=b.callback.apply(win,t[h]);return s||a}}(),fakeworker=function(global){function extend(a,b){for(var c in b)a[c]=b[c]}function httpSuccess(a){try{return!a.status&&"file:"==location.protocol||a.status>=200&&a.status<300||304==a.status||1223==a.status||browser.safari&&void 0==a.status}catch(a){}return!1}function __syncXhrGet(a,b){var c=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(c.open("GET",a,!1),c.send(""),!httpSuccess(c))throw new Error("Could not load resource("+a+") result="+c.status+":"+c.statusText);b(c)}function parseUri(a){for(var b=parseUri.options,c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d}function absolutePath(a){var b=document.createElement("span");return b.innerHTML='<a href="'+a+'" />',b.firstChild.href}function FakeMessageEvent(a){extend(this,Event),Event.constructor.call(this),this.currentTarget=a,this.srcElement=a,this.target=a,this.timestamp=(new Date).getTime()}function FakeErrorEvent(a){extend(this,Event),Event.constructor.call(this),this.currentTarget=a,this.srcElement=a,this.target=a,this.timestamp=(new Date).getTime()}function FakeWorkerLocation(a){var b=absolutePath(a),c=parseUri(b);this.href=b,this.protocol=c.protocol+":",this.host=c.port?c.host+":"+c.port:c.host,this.hostname=c.host,this.port=c.port,this.pathname=c.path,this.search=c.query?"?"+c.query:"",this.hash=c.anchor?"#"+c.anchor:"",this.filename=c.file}function FakeWorkerContext(url,source,worker){var postMessage=this.postMessage=function(a){var b=new FakeMessageEvent(worker);b.initMessageEvent("message",!1,!1,a,"","",null,null),setTimeout(function(){worker.dispatchEvent(b)},0)},setTimeout=this.setTimeout=global.setTimeout,clearTimeout=this.clearTimeout=global.clearTimeout,setInterval=this.setInterval=global.setInterval,clearInterval=this.clearInterval=global.clearInterval,XMLHttpRequest=this.XMLHttpRequest=global.XMLHttpRequest,openDatabase=this.openDatabase=global.openDatabase,openDatabaseSync=this.openDatabaseSync=global.openDatabaseSync,WebSocket=this.WebSocket=global.WebSocket,EventSource=this.EventSource=global.EventSource,MessageChannel=this.MessageChannel=global.MessageChannel,Worker=this.Worker=FakeWorker,location=this.location=new FakeWorkerLocation(url),close=this.close=function(){this.closing=!0},navigator=this.navigator=global.navigator,self=this.self=this,importScripts=this.importScripts=function(){throw new Error("importScripts is not supported.")};eval(source);try{"function"==typeof onmessage&&(this.onmessage=onmessage)}catch(a){}}var userAgent=navigator.userAgent.toLowerCase(),browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)};parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},FakeMessageEvent.prototype={initMessageEvent:function(a,b,c,d,e,f,g,h){this.initMessageEventNS("",a,b,c,d,e,f,g,h)},initMessageEventNS:function(a,b,c,d,e,f,g,h,i){this.namespaceURI=a,this.type=b,this.canBubble=c,this.cancelable=d,this.data=e,this.origin=f,this.lastEventId=g,this.source=h,this.ports=i}},FakeErrorEvent.prototype={initErrorEvent:function(a,b,c,d,e,f){this.initErrorEventNS("",a,b,c,d,e,f)},initErrorEventNS:function(a,b,c,d,e,f,g){this.namespaceURI=a,this.type=b,this.canBubble=c,this.cancelable=d,this.message=e,this.filename=f,this.lineno=g}};var nativeWorker=global.Worker,FakeWorker=function(a){var b=this;this._listenerNamespaces={},this._eventQueues={},__syncXhrGet(a,function(c){try{b._workerContext=new FakeWorkerContext(a,c.responseText,b)}catch(a){throw a}})};FakeWorker.prototype={isFake:!0,addEventListener:function(a,b,c){this.addEventListenerNS("",a,b,c)},addEventListenerNS:function(a,b,c,d){var e=this._listenerNamespaces[a];e||(this._listenerNamespaces[a]=e={});var f=e[b];f||(e[b]=f=[]),f.push(c)},removeEventListener:function(a,b,c){this.removeEventListener("",a,b,c)},removeEventListenerNS:function(a,b,c,d){var e=this._listenerNamespaces[a];if(e){var f=e[type];if(f)for(var g=0;g<f.length;g++)f[g]===listener&&delete f[g]}},dispatchEvent:function(a){"function"==typeof this["on"+a.type]&&this["on"+a.type].call(this,a);var b=this._listenerNamespaces[a.namespaceURI];if(b){var c=b[a.type];if(c)for(var d=0;d<c.length;d++)c[d].call(this,a)}return!0},postMessage:function(a){var b=this,c=this._workerContext;if("function"==typeof c.onmessage){var d=new FakeMessageEvent(b);d.initMessageEvent("message",!1,!1,a,"","",null,null),setTimeout(function(){try{c.onmessage.call(c,d)}catch(d){var a=new FakeErrorEvent(b),e=d.line||d.lineNumber;throw a.initErrorEvent("error",!1,!1,d.message,c.location.filename,e),b.dispatchEvent(a),d}},0)}},terminate:function(){this._workerContext.close()}},FakeWorkerLocation.prototype={toString:function(){return this.href}};var ret={nativeWorker:nativeWorker,install:function(){global.Worker=FakeWorker},uninstall:function(){global.Worker=nativeWorker}};return ret.install(),ret}(this);window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var Recorder=function(a){if(!Recorder.isRecordingSupported())throw"Recording is not supported in this browser";this.config=a=a||{},this.config.command="init",this.config.bufferLength=a.bufferLength||4096,this.config.monitorGain=a.monitorGain||0,this.config.numberOfChannels=a.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=a.encoderSampleRate||48e3,this.config.encoderPath=a.encoderPath||"oggopusEncoder.js",this.config.streamPages=a.streamPages||!1,this.config.leaveStreamOpen=a.leaveStreamOpen||!1,this.config.maxBuffersPerPage=a.maxBuffersPerPage||40,this.config.encoderApplication=a.encoderApplication||2049,this.config.encoderFrameSize=a.encoderFrameSize||20,this.config.streamOptions=a.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};Recorder.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},Recorder.prototype.addEventListener=function(a,b,c){this.eventTarget.addEventListener(a,b,c)},Recorder.isRecordingSupported()&&(Recorder.prototype.audioContext=new window.AudioContext),Recorder.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(a){a.stop()}),delete this.stream)},Recorder.prototype.createAudioNodes=function(){var a=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(b){a.encodeBuffers(b.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},Recorder.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var a=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=a-a/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},Recorder.prototype.encodeBuffers=function(a){if("recording"===this.state){for(var b=[],c=0;c<a.numberOfChannels;c++)b[c]=a.getChannelData(c);this.encoder.postMessage({command:"encode",buffers:b}),this.duration+=a.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},Recorder.prototype.initStream=function(){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));var a=this;navigator.getUserMedia({audio:this.config.streamOptions},function(b){a.stream=b,a.sourceNode=a.audioContext.createMediaStreamSource(b),a.sourceNode.connect(a.filterNode||a.scriptProcessorNode),a.sourceNode.connect(a.monitorNode),a.eventTarget.dispatchEvent(new Event("streamReady"))},function(b){a.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:b}))})},Recorder.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},Recorder.prototype.removeEventListener=function(a,b,c){this.eventTarget.removeEventListener(a,b,c)},Recorder.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},Recorder.prototype.setMonitorGain=function(a){this.monitorNode.gain.value=a},Recorder.prototype.start=function(){if("inactive"===this.state&&this.stream){var a=this;this.encoder=new Worker(this.config.encoderPath),this.config.streamPages?this.encoder.addEventListener("message",function(b){a.streamPage(b.data)}):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",function(b){a.storePage(b.data)})),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config)}},Recorder.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"done"}))},Recorder.prototype.storePage=function(a){if(this.recordedPages.push(a),this.totalLength+=a.length,4&a[5]){for(var b=new Uint8Array(this.totalLength),c=0,d=0;d<this.recordedPages.length;d++)b.set(this.recordedPages[d],c),c+=this.recordedPages[d].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([b],{type:"audio/ogg"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},Recorder.prototype.streamPage=function(a){this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([a],{type:"audio/ogg"})})),4&a[5]&&this.eventTarget.dispatchEvent(new Event("stop"))},function(a){if("object"==typeof exports&&void 0!==module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.io=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":2}],2:[function(a,b,c){function d(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d=e(a),f=d.source,j=d.id;return b.forceNew||b["force new connection"]||!1===b.multiplex?(h("ignoring socket cache for %s",f),c=g(f,b)):(i[j]||(h("new io instance for %s",f),i[j]=g(f,b)),c=i[j]),c.socket(d.path)}var e=a("./url"),f=a("socket.io-parser"),g=a("./manager"),h=a("debug")("socket.io-client");b.exports=c=d;var i=c.managers={};c.protocol=f.protocol,c.connect=d,c.Manager=a("./manager"),c.Socket=a("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(a,b,c){function d(a,b){if(!(this instanceof d))return new d(a,b);a&&"object"==typeof a&&(b=a,a=void 0),b=b||{},b.path=b.path||"/socket.io",this.nsps={},this.subs=[],this.opts=b,this.reconnection(!1!==b.reconnection),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor(b.randomizationFactor||.5),this.backoff=new m({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==b.timeout?2e4:b.timeout),this.readyState="closed",this.uri=a,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new h.Encoder,this.decoder=new h.Decoder,this.autoConnect=!1!==b.autoConnect,this.autoConnect&&this.open()}var e=(a("./url"),a("engine.io-client")),f=a("./socket"),g=a("component-emitter"),h=a("socket.io-parser"),i=a("./on"),j=a("component-bind"),k=(a("object-component"),a("debug")("socket.io-client:manager")),l=a("indexof"),m=a("backo2");b.exports=d,d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)this.nsps[a].emit.apply(this.nsps[a],arguments)},d.prototype.updateSocketIds=function(){for(var a in this.nsps)this.nsps[a].id=this.engine.id},g(d.prototype),d.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection},d.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax},d.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(a){if(k("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;k("opening %s",this.uri),this.engine=e(this.uri,this.opts);var b=this.engine,c=this;this.readyState="opening",this.skipReconnect=!1;var d=i(b,"open",function(){c.onopen(),a&&a()}),f=i(b,"error",function(b){if(k("connect_error"),c.cleanup(),c.readyState="closed",c.emitAll("connect_error",b),a){var d=new Error("Connection error");d.data=b,a(d)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var g=this._timeout;k("connect attempt will timeout after %d",g);var h=setTimeout(function(){k("connect attempt timed out after %d",g),d.destroy(),b.close(),b.emit("error","timeout"),c.emitAll("connect_timeout",g)},g);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(d),this.subs.push(f),this},d.prototype.onopen=function(){k("open"),this.cleanup(),this.readyState="open",this.emit("open");var a=this.engine;this.subs.push(i(a,"data",j(this,"ondata"))),this.subs.push(i(this.decoder,"decoded",j(this,"ondecoded"))),this.subs.push(i(a,"error",j(this,"onerror"))),this.subs.push(i(a,"close",j(this,"onclose")))},d.prototype.ondata=function(a){this.decoder.add(a)},d.prototype.ondecoded=function(a){this.emit("packet",a)},d.prototype.onerror=function(a){k("error",a),this.emitAll("error",a)},d.prototype.socket=function(a){var b=this.nsps[a];if(!b){b=new f(this,a),this.nsps[a]=b;var c=this;b.on("connect",function(){b.id=c.engine.id,~l(c.connected,b)||c.connected.push(b)})}return b},d.prototype.destroy=function(a){var b=l(this.connected,a);~b&&this.connected.splice(b,1),this.connected.length||this.close()},d.prototype.packet=function(a){k("writing packet %j",a);var b=this;b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(a){for(var c=0;c<a.length;c++)b.engine.write(a[c]);b.encoding=!1,b.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}},d.prototype.cleanup=function(){for(var a;a=this.subs.shift();)a.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(a){k("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",a),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)k("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();k("will wait %dms before reconnect attempt",b),this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(k("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(b){b?(k("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(k("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}},d.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",a)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(a,b,c){function d(a,b,c){return a.on(b,c),{destroy:function(){a.removeListener(b,c)}}}b.exports=d},{}],5:[function(a,b,c){function d(a,b){this.io=a,this.nsp=b,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var e=a("socket.io-parser"),f=a("component-emitter"),g=a("to-array"),h=a("./on"),i=a("component-bind"),j=a("debug")("socket.io-client:socket"),k=a("has-binary");b.exports=d;var l={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},m=f.prototype.emit;f(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[h(a,"open",i(this,"onopen")),h(a,"packet",i(this,"onpacket")),h(a,"close",i(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},d.prototype.send=function(){var a=g(arguments);return a.unshift("message"),this.emit.apply(this,a),this},d.prototype.emit=function(a){if(l.hasOwnProperty(a))return m.apply(this,arguments),this;var b=g(arguments),c=e.EVENT;k(b)&&(c=e.BINARY_EVENT);var d={type:c,data:b};return"function"==typeof b[b.length-1]&&(j("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++),this.connected?this.packet(d):this.sendBuffer.push(d),this},d.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},d.prototype.onopen=function(){j("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:e.CONNECT})},d.prototype.onclose=function(a){j("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}},d.prototype.onevent=function(a){var b=a.data||[];j("emitting event %j",b),null!=a.id&&(j("attaching ack callback to event"),b.push(this.ack(a.id))),this.connected?m.apply(this,b):this.receiveBuffer.push(b)},d.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=g(arguments);j("sending ack %j",d);var f=k(d)?e.BINARY_ACK:e.ACK;b.packet({type:f,id:a,data:d})}}},d.prototype.onack=function(a){j("calling ack %s with %j",a.id,a.data),this.acks[a.id].apply(this,a.data),delete this.acks[a.id]},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)m.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){
j("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(j("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(a,b,c){(function(c){function d(a,b){var d=a,b=b||c.location;return null==a&&(a=b.protocol+"//"+b.host),"string"==typeof a&&("/"==a.charAt(0)&&(a="/"==a.charAt(1)?b.protocol+a:b.hostname+a),/^(https?|wss?):\/\//.test(a)||(f("protocol-less url %s",a),a=void 0!==b?b.protocol+"//"+a:"https://"+a),f("parse %s",a),d=e(a)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/",d.id=d.protocol+"://"+d.host+":"+d.port,d.href=d.protocol+"://"+d.host+(b&&b.port==d.port?"":":"+d.port),d}var e=a("parseuri"),f=a("debug")("socket.io-client:url");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:10,parseuri:44}],7:[function(a,b,c){function d(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}b.exports=d,d.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)},d.prototype.reset=function(){this.attempts=0},d.prototype.setMin=function(a){this.ms=a},d.prototype.setMax=function(a){this.max=a},d.prototype.setJitter=function(a){this.jitter=a}},{}],8:[function(a,b,c){var d=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw new Error("bind() requires a function");var c=d.call(arguments,2);return function(){return b.apply(a,c.concat(d.call(arguments)))}}},{}],9:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if((d=c[e])===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],10:[function(a,b,c){function d(a){return d.enabled(a)?function(b){b=e(b);var c=new Date,f=c-(d[a]||c);d[a]=c,b=a+" "+b+" +"+d.humanize(f),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function e(a){return a instanceof Error?a.stack||a.message:a}b.exports=d,d.names=[],d.skips=[],d.enable=function(a){try{localStorage.debug=a}catch(a){}for(var b=(a||"").split(/[\s,]+/),c=b.length,e=0;e<c;e++)a=b[e].replace("*",".*?"),"-"===a[0]?d.skips.push(new RegExp("^"+a.substr(1)+"$")):d.names.push(new RegExp("^"+a+"$"))},d.disable=function(){d.enable("")},d.humanize=function(a){return a>=36e5?(a/36e5).toFixed(1)+"h":a>=6e4?(a/6e4).toFixed(1)+"m":a>=1e3?(a/1e3|0)+"s":a+"ms"},d.enabled=function(a){for(var b=0,c=d.skips.length;b<c;b++)if(d.skips[b].test(a))return!1;for(var b=0,c=d.names.length;b<c;b++)if(d.names[b].test(a))return!0;return!1};try{window.localStorage&&d.enable(localStorage.debug)}catch(a){}},{}],11:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":12}],12:[function(a,b,c){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(a,b,c){(function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);if(b=b||{},a&&"object"==typeof a&&(b=a,a=null),a&&(a=k(a),b.host=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)),this.secure=null!=b.secure?b.secure:c.location&&"https:"==location.protocol,b.host){var e=b.host.split(":");b.hostname=e.shift(),e.length?b.port=e.pop():b.port||(b.port=this.secure?"443":"80")}this.agent=b.agent||!1,this.hostname=b.hostname||(c.location?location.hostname:"localhost"),this.port=b.port||(c.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.jsonp=!1!==b.jsonp,this.forceBase64=!!b.forceBase64,this.enablesXDR=!!b.enablesXDR,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades,this.pfx=b.pfx||null,this.key=b.key||null,this.passphrase=b.passphrase||null,this.cert=b.cert||null,this.ca=b.ca||null,this.ciphers=b.ciphers||null,this.rejectUnauthorized=b.rejectUnauthorized||null,this.open()}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=d,d.priorWebsocketSuccess=!1,g(d.prototype),d.protocol=j.protocol,d.Socket=d,d.Transport=a("./transport"),d.transports=a("./transports"),d.parser=a("engine.io-parser"),d.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=e(this.query);return b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id),new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})},d.prototype.open=function(){var a;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))a="websocket";else{if(0==this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";var a;try{a=this.createTransport(a)}catch(a){return this.transports.shift(),void this.open()}a.open(),this.setTransport(a)},d.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},d.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data){if(h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),!k)return;d.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())})}else{h('probe transport "%s" failed',a);var c=new Error("probe error");c.transport=k.name,m.emit("upgradeError",c)}}))}function c(){l||(l=!0,j(),k.close(),k=null)}function e(b){var d=new Error("probe error: "+b);d.transport=k.name,c(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",d)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),c())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),l=!1,m=this;d.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},d.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}},d.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing();break;case"error":var b=new Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},d.prototype.ping=function(){this.sendPacket("ping")},d.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},d.prototype.sendPacket=function(a,b,c){if("closing"!=this.readyState&&"closed"!=this.readyState){var d={type:a,data:b};this.emit("packetCreate",d),this.writeBuffer.push(d),this.callbackBuffer.push(c),this.flush()}},d.prototype.close=function(){function a(){d.onClose("forced close"),h("socket closing - telling transport to close"),d.transport.close()}function b(){d.removeListener("upgrade",b),d.removeListener("upgradeError",b),a()}function c(){d.once("upgrade",b),d.once("upgradeError",b)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this},d.prototype.onError=function(a){h("socket error %j",a),d.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},d.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(a,b,c){function d(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized}var e=a("engine.io-parser"),f=a("component-emitter");b.exports=d,f(d.prototype),d.timestamps=0,d.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},d.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},d.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},d.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},d.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},d.prototype.onData=function(a){var b=e.decodePacket(a,this.socket.binaryType);this.onPacket(b)},d.prototype.onPacket=function(a){this.emit("packet",a)},d.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(a,b,c){(function(b){function d(a){var c=!1,d=!1,h=!1!==a.jsonp;if(b.location){var i="https:"==location.protocol,j=location.port;j||(j=i?443:80),c=a.hostname!=location.hostname||j!=a.port,d=a.secure!=i}if(a.xdomain=c,a.xscheme=d,"open"in new e(a)&&!a.forceJSONP)return new f(a);if(!h)throw new Error("JSONP disabled");return new g(a)}var e=a("xmlhttprequest"),f=a("./polling-xhr"),g=a("./polling-jsonp"),h=a("./websocket");c.polling=d,c.websocket=h}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(a,b,c){(function(c){function d(){}function e(a){f.call(this,a),this.query=this.query||{},h||(c.___eio||(c.___eio=[]),h=c.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=d)},!1)}var f=a("./polling"),g=a("component-inherit");b.exports=e;var h;g(e,f),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),f.prototype.doClose.call(this)},e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},e.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var a='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(a)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=i,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(/\\n/g,"\\\n"),this.area.value=a.replace(/\n/g,"\\n");try{this.form.submit()}catch(a){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-inherit":21}],17:[function(a,b,c){(function(c){function d(){}function e(a){if(i.call(this,a),c.location){var b="https:"==location.protocol,d=location.port;d||(d=b?443:80),this.xd=a.hostname!=c.location.hostname||d!=a.port,this.xs=a.secure!=b}}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.xs=!!a.xs,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.isBinary=a.isBinary,this.supportsBinary=a.supportsBinary,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.create()}function g(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=a("xmlhttprequest"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=e,b.exports.Request=f,k(e,i),e.prototype.supportsBinary=!0,e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,new f(a)},e.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},e.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(f.prototype),f.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new h(a),d=this;try{if(l("xhr open %s: %s",this.method,this.uri),b.open(this.method,this.uri,this.async),this.supportsBinary&&(b.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}"withCredentials"in b&&(b.withCredentials=!0),this.hasXDR()?(b.onload=function(){d.onLoad()},b.onerror=function(){d.onError(b.responseText)}):b.onreadystatechange=function(){4==b.readyState&&(200==b.status||1223==b.status?d.onLoad():setTimeout(function(){d.onError(b.status)},0))},l("xhr data %s",this.data),b.send(this.data)}catch(a){return void setTimeout(function(){d.onError(a)},0)}c.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup(!0)},f.prototype.cleanup=function(a){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,a)try{this.xhr.abort()}catch(a){}c.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var a;try{var b;try{b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(a){}a="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(a){this.onError(a)}null!=a&&this.onData(a)},f.prototype.hasXDR=function(){return void 0!==c.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},c.document&&(f.requestsCount=0,f.requests={},c.attachEvent?c.attachEvent("onunload",g):c.addEventListener&&c.addEventListener("beforeunload",g,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(a,b,c){function d(a){var b=a&&a.forceBase64;j&&!b||(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("parseqs"),g=a("engine.io-parser"),h=a("component-inherit"),i=a("debug")("engine.io-client:polling");b.exports=d;var j=function(){return null!=new(a("xmlhttprequest"))({xdomain:!1}).responseType}();h(d,e),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(a){function b(){i("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(i("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){i("pre-pause polling complete"),--d||b()})),this.writable||(i("we are currently writing - waiting to pause"),d++,this.once("drain",function(){i("pre-pause writing complete"),--d||b()}))}else b()},d.prototype.poll=function(){i("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(a){var b=this;i("polling got data %s",a);var c=function(a,c,d){if("opening"==b.readyState&&b.onOpen(),"close"==a.type)return b.onClose(),!1;b.onPacket(a)};g.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():i('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){function a(){i("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(i("transport open - closing"),a()):(i("transport not open - deferring close"),this.once("open",a))},d.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;g.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";return!1!==this.timestampRequests&&(a[this.timestampParam]=+new Date+"-"+e.timestamps++),this.supportsBinary||a.sid||(a.b64=1),a=f.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(a,b,c){function d(a){a&&a.forceBase64&&(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("engine.io-parser"),g=a("parseqs"),h=a("component-inherit"),i=a("debug")("engine.io-client:websocket"),j=a("ws");b.exports=d,h(d,e),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b={agent:this.agent};b.pfx=this.pfx,b.key=this.key,b.passphrase=this.passphrase,b.cert=this.cert,b.ca=this.ca,b.ciphers=this.ciphers,b.rejectUnauthorized=this.rejectUnauthorized,this.ws=new j(a,void 0,b),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var b=this;setTimeout(function(){e.prototype.onData.call(b,a)},0)}),d.prototype.write=function(a){function b(){c.writable=!0,c.emit("drain")}var c=this;this.writable=!1;for(var d=0,e=a.length;d<e;d++)f.encodePacket(a[d],this.supportsBinary,function(a){try{c.ws.send(a)}catch(a){i("websocket closed before onclose event")}});setTimeout(b,0)},d.prototype.onClose=function(){e.prototype.onClose.call(this)},d.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=g.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},d.prototype.check=function(){return!(!j||"__initialize"in j&&this.name===d.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(a,b,c){var d=a("has-cors");b.exports=function(a){var b=a.xdomain,c=a.xscheme,e=a.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||d))return new XMLHttpRequest}catch(a){}try{if("undefined"!=typeof XDomainRequest&&!c&&e)return new XDomainRequest}catch(a){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}},{"has-cors":40}],21:[function(a,b,c){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],22:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?localStorage.removeItem("debug"):localStorage.debug=a}catch(a){}}function h(){var a;try{a=localStorage.debug}catch(a){}return a}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":23}],23:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g)),(e.log||c.log||console.log.bind(console)).apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:24}],24:[function(a,b,c){function d(a){var b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case"years":case"year":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"h":return c*j;case"minutes":case"minute":case"m":return c*i;case"seconds":case"second":case"s":return c*h;case"ms":return c}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b.long?f(a):e(a)}},{}],25:[function(a,b,c){(function(b){function d(a,b){return b("b"+c.packets[a.type]+a.data.data)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=r[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,!0,d)},e.readAsArrayBuffer(a.data)}function g(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(q)return f(a,b,d);var e=new Uint8Array(1);return e[0]=r[a.type],d(new u([e.buffer,a.data]))}function h(a,b,c){for(var d=new Array(a.length),e=m(a.length,c),f=0;f<a.length;f++)!function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})}(f,a[f],e)}var i=a("./keys"),j=a("has-binary"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),o=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),q=o||p;c.protocol=3;var r=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=i(r),t={type:"error",data:"parser error"},u=a("blob");c.encodePacket=function(a,c,f,h){"function"==typeof c&&(h=c,c=!1),"function"==typeof f&&(h=f,f=null);var i=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&i instanceof ArrayBuffer)return e(a,c,h);if(u&&i instanceof b.Blob)return g(a,c,h);if(i&&i.base64)return d(a,h);var j=r[a.type];return void 0!==a.data&&(j+=f?n.encode(String(a.data)):String(a.data)),h(""+j)},c.encodeBase64Packet=function(a,d){var e="b"+c.packets[a.type];if(u&&a.data instanceof u){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(a.data)}var g;try{g=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(b){for(var h=new Uint8Array(a.data),i=new Array(h.length),j=0;j<h.length;j++)i[j]=h[j];g=String.fromCharCode.apply(null,i)}return e+=b.btoa(g),d(e)},c.decodePacket=function(a,b,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);if(d)try{a=n.decode(a)}catch(a){return t}var e=a.charAt(0);return Number(e)==e&&s[e]?a.length>1?{type:s[e],data:a.substring(1)}:{
type:s[e]}:t}var f=new Uint8Array(a),e=f[0],g=k(a,1);return u&&"blob"===b&&(g=new u([g])),{type:s[e],data:g}},c.decodeBase64Packet=function(a,c){var d=s[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=l.decode(a.substr(1));return"blob"===c&&u&&(e=new u([e])),{type:d,data:e}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,!!g&&b,!0,function(a){d(null,e(a))})}"function"==typeof b&&(d=b,b=null);var g=j(a);return b&&g?u&&!q?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void h(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(t,0,1);for(var f,g,h="",i=0,j=a.length;i<j;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(t,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(t,0,1);if(g.length){if(e=c.decodePacket(g,b,!0),t.type==e.type&&t.data==e.data)return d(t,0,1);if(!1===d(e,i+f,j))return}i+=f,h=""}}return""!=h?d(t,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){return b(null,a)})}if(!a.length)return b(new ArrayBuffer(0));h(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}e[f++]=b?0:1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)})},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,u){var i=new u([c.buffer,h.buffer,a]);b(null,i)}})}h(a,d,function(a,c){return b(new u(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[],g=!1;e.byteLength>0;){for(var h=new Uint8Array(e),i=0===h[0],j="",l=1;255!=h[l];l++){if(j.length>310){g=!0;break}j+=h[l]}if(g)return d(t,0,1);e=k(e,2+j.length),j=parseInt(j);var m=k(e,0,j);if(i)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(a){var n=new Uint8Array(m);m="";for(var l=0;l<n.length;l++)m+=String.fromCharCode(n[l])}f.push(m),e=k(e,j)}var o=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b,!0),e,o)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(a,b,c){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],27:[function(a,b,c){function d(a,b,c){function d(a,e){if(d.count<=0)throw new Error("after called too many times");--d.count,a?(f=!0,b(a),b=c):0!==d.count||f||b(null,e)}var f=!1;return c=c||e,d.count=a,0===a?b():d}function e(){}b.exports=d},{}],28:[function(a,b,c){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(b<0&&(b+=d),c<0&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;g<c;g++,h++)f[h]=e[g];return f.buffer}},{}],29:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;c<e;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3==2?f=f.substring(0,f.length-1)+"=":e%3==1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;c<i;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(a,b,c){(function(a){function c(a,b){b=b||{};for(var c=new d,e=0;e<a.length;e++)c.append(a[e]);return b.type?c.getBlob(b.type):c.getBlob()}var d=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,e=function(){try{return 2==new Blob(["hi"]).size}catch(a){return!1}}(),f=d&&d.prototype.append&&d.prototype.getBlob;b.exports=function(){return e?a.Blob:f?c:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(a.hasOwnProperty(f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:32}],32:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],33:[function(b,c,d){(function(b){!function(e){function f(a){for(var b,c,d=[],e=0,f=a.length;e<f;)b=a.charCodeAt(e++),b>=55296&&b<=56319&&e<f?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=t(b>>>10&1023|55296),b=56320|1023&b),e+=t(b);return e}function h(a,b){return t(a>>b&63|128)}function i(a){if(0==(4294967168&a))return t(a);var b="";return 0==(4294965248&a)?b=t(a>>6&31|192):0==(4294901760&a)?(b=t(a>>12&15|224),b+=h(a,6)):0==(4292870144&a)&&(b=t(a>>18&7|240),b+=h(a,12),b+=h(a,6)),b+=t(63&a|128)}function j(a){for(var b,c=f(a),d=c.length,e=-1,g="";++e<d;)b=c[e],g+=i(b);return g}function k(){if(s>=r)throw Error("Invalid byte index");var a=255&q[s];if(s++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function l(){var a,b,c,d,e;if(s>r)throw Error("Invalid byte index");if(s==r)return!1;if(a=255&q[s],s++,0==(128&a))return a;if(192==(224&a)){var b=k();if((e=(31&a)<<6|b)>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=k(),c=k(),(e=(15&a)<<12|b<<6|c)>=2048)return e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=k(),c=k(),d=k(),(e=(15&a)<<18|b<<12|c<<6|d)>=65536&&e<=1114111))return e;throw Error("Invalid UTF-8 detected")}function m(a){q=f(a),r=q.length,s=0;for(var b,c=[];!1!==(b=l());)c.push(b);return g(c)}var n="object"==typeof d&&d,o="object"==typeof c&&c&&c.exports==n&&c,p="object"==typeof b&&b;p.global!==p&&p.window!==p||(e=p);var q,r,s,t=String.fromCharCode,u={version:"2.0.0",encode:j,decode:m};if("function"==typeof a&&"object"==typeof a.amd&&a.amd)a(function(){return u});else if(n&&!n.nodeType)if(o)o.exports=u;else{var v={},w=v.hasOwnProperty;for(var x in u)w.call(u,x)&&(n[x]=u[x])}else e.utf8=u}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(a,b,c){(function(a){var c=/^[\],:{}\s]*$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(/^\s+/,"").replace(/\s+$/,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?new Function("return "+b)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],36:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){var b=a,c=a.indexOf("["),f=a.indexOf("]");-1!=c&&-1!=f&&(a=a.substring(0,c)+a.substring(c,f).replace(/:/g,";")+a.substring(f,a.length));for(var g=d.exec(a||""),h={},i=14;i--;)h[e[i]]=g[i]||"";return-1!=c&&-1!=f&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h}},{}],37:[function(a,b,c){function d(a,b,c){return b?new f(a,b):new f(a)}var e=function(){return this}(),f=e.WebSocket||e.MozWebSocket;b.exports=f?d:null,f&&(d.prototype=f.prototype)},{}],38:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:39}],39:[function(a,b,c){b.exports=a(32)},{}],40:[function(a,b,c){var d=a("global");try{b.exports="XMLHttpRequest"in d&&"withCredentials"in new d.XMLHttpRequest}catch(a){b.exports=!1}},{global:41}],41:[function(a,b,c){b.exports=function(){return this}()},{}],42:[function(a,b,c){var d=[].indexOf;b.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},{}],43:[function(a,b,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},c.values=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(a[c]);return b},c.merge=function(a,b){for(var c in b)d.call(b,c)&&(a[c]=b[c]);return a},c.length=function(a){return c.keys(a).length},c.isEmpty=function(a){return 0==c.length(a)}},{}],44:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c}},{}],45:[function(a,b,c){(function(b){var d=a("isarray"),e=a("./is-buffer");c.deconstructPacket=function(a){function b(a){if(!a)return a;if(e(a)){var f={_placeholder:!0,num:c.length};return c.push(a),f}if(d(a)){for(var g=new Array(a.length),h=0;h<a.length;h++)g[h]=b(a[h]);return g}if("object"==typeof a&&!(a instanceof Date)){var g={};for(var i in a)g[i]=b(a[i]);return g}return a}var c=[],f=a.data,g=a;return g.data=b(f),g.attachments=c.length,{packet:g,buffers:c}},c.reconstructPacket=function(a,b){function c(a){if(a&&a._placeholder){return b[a.num]}if(d(a)){for(var e=0;e<a.length;e++)a[e]=c(a[e]);return a}if(a&&"object"==typeof a){for(var f in a)a[f]=c(a[f]);return a}return a}return a.data=c(a.data),a.attachments=void 0,a},c.removeBlobs=function(a,c){function f(a,i,j){if(!a)return a;if(b.Blob&&a instanceof Blob||b.File&&a instanceof File){g++;var k=new FileReader;k.onload=function(){j?j[i]=this.result:h=this.result,--g||c(h)},k.readAsArrayBuffer(a)}else if(d(a))for(var l=0;l<a.length;l++)f(a[l],l,a);else if(a&&"object"==typeof a&&!e(a))for(var m in a)f(a[m],m,a)}var g=0,h=a;f(h),g||c(h)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":47,isarray:48}],46:[function(a,b,c){function d(){}function e(a){var b="",d=!1;return b+=a.type,c.BINARY_EVENT!=a.type&&c.BINARY_ACK!=a.type||(b+=a.attachments,b+="-"),a.nsp&&"/"!=a.nsp&&(d=!0,b+=a.nsp),null!=a.id&&(d&&(b+=",",d=!1),b+=a.id),null!=a.data&&(d&&(b+=","),b+=l.stringify(a.data)),k("encoded %j as %s",a,b),b}function f(a,b){function c(a){var c=n.deconstructPacket(a),d=e(c.packet),f=c.buffers;f.unshift(d),b(f)}n.removeBlobs(a,c)}function g(){this.reconstructor=null}function h(a){var b={},d=0;if(b.type=Number(a.charAt(0)),null==c.types[b.type])return j();if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type){for(var e="";"-"!=a.charAt(++d)&&(e+=a.charAt(d),d!=a.length););if(e!=Number(e)||"-"!=a.charAt(d))throw new Error("Illegal attachments");b.attachments=Number(e)}if("/"==a.charAt(d+1))for(b.nsp="";++d;){var f=a.charAt(d);if(","==f)break;if(b.nsp+=f,d==a.length)break}else b.nsp="/";var g=a.charAt(d+1);if(""!==g&&Number(g)==g){for(b.id="";++d;){var f=a.charAt(d);if(null==f||Number(f)!=f){--d;break}if(b.id+=a.charAt(d),d==a.length)break}b.id=Number(b.id)}if(a.charAt(++d))try{b.data=l.parse(a.substr(d))}catch(a){return j()}return k("decoded %s as %j",a,b),b}function i(a){this.reconPack=a,this.buffers=[]}function j(a){return{type:c.ERROR,data:"parser error"}}var k=a("debug")("socket.io-parser"),l=a("json3"),m=(a("isarray"),a("component-emitter")),n=a("./binary"),o=a("./is-buffer");c.protocol=4,c.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=d,c.Decoder=g,d.prototype.encode=function(a,b){if(k("encoding packet %j",a),c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)f(a,b);else{b([e(a)])}},m(g.prototype),g.prototype.add=function(a){var b;if("string"==typeof a)b=h(a),c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=new i(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b);else{if(!o(a)&&!a.base64)throw new Error("Unknown type: "+a);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(b=this.reconstructor.takeBinaryData(a))&&(this.reconstructor=null,this.emit("decoded",b))}},g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},i.prototype.takeBinaryData=function(a){if(this.buffers.push(a),this.buffers.length==this.reconPack.attachments){var b=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null},i.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(a,b,c){(function(a){function c(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(a,b,c){b.exports=a(32)},{}],49:[function(b,c,d){!function(b){function c(a){if(c[a]!==g)return c[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=c("json-stringify")&&c("json-parse");else{var d,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var f=k.stringify,i="function"==typeof f&&l;if(i){(d=function(){return 1}).toJSON=d;try{i="0"===f(0)&&"0"===f(new Number)&&'""'==f(new String)&&f(h)===g&&f(g)===g&&f()===g&&"1"===f(d)&&"[1]"==f([d])&&"[null]"==f([g])&&"null"==f(null)&&"[null,null,null]"==f([g,h,null])&&f({a:[d,!0,!1,null,"\0\b\n\f\r "]})==e&&"1"===f(null,d)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(a){i=!1}}b=i}if("json-parse"==a){var j=k.parse;if("function"==typeof j)try{if(0===j("0")&&!j(!1)){d=j(e);var m=5==d.a.length&&1===d.a[0];if(m){try{m=!j('"  "')}catch(a){}if(m)try{m=1!==j("01")}catch(a){}if(m)try{m=1!==j("1.")}catch(a){}}}}catch(a){m=!1}b=m}}return c[a]=!!b}var e,f,g,h={}.toString,i="function"==typeof a&&a.amd,j="object"==typeof JSON&&JSON,k="object"==typeof d&&d&&!d.nodeType&&d;k&&j?(k.stringify=j.stringify,k.parse=j.parse):k=b.JSON=j||{};var l=new Date(-0xc782b5b800cec);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(a){}if(!c("json")){var m=c("bug-string-char-index");if(!l)var n=Math.floor,o=[0,31,59,90,120,151,181,212,243,273,304,334],p=function(a,b){return o[b]+365*(a-1970)+n((a-1969+(b=+(b>1)))/4)-n((a-1901+b)/100)+n((a-1601+b)/400)};(e={}.hasOwnProperty)||(e=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=h?e=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,e=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,e.call(this,a)});var q={boolean:1,number:1,string:1,undefined:1},r=function(a,b){var c=typeof a[b];return"object"==c?!!a[b]:!q[c]};if(f=function(a,b){var c,d,g,i=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(g in d)e.call(d,g)&&i++;return c=d=null,i?f=2==i?function(a,b){var c,d={},f="[object Function]"==h.call(a);for(c in a)f&&"prototype"==c||e.call(d,c)||!(d[c]=1)||!e.call(a,c)||b(c)}:function(a,b){var c,d,f="[object Function]"==h.call(a);for(c in a)f&&"prototype"==c||!e.call(a,c)||(d="constructor"===c)||b(c);(d||e.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(a,b){var c,f,g="[object Function]"==h.call(a),i=!g&&"function"!=typeof a.constructor&&r(a,"hasOwnProperty")?a.hasOwnProperty:e;for(c in a)g&&"prototype"==c||!i.call(a,c)||b(c);for(f=d.length;c=d[--f];i.call(a,c)&&b(c));}),f(a,b)},!c("json-stringify")){var s={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},t=function(a,b){return("000000"+(b||0)).slice(-a)},u=function(a){var b,c='"',d=0,e=a.length,f=e>10&&m;for(f&&(b=a.split(""));d<e;d++){var g=a.charCodeAt(d);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=s[g];break;default:if(g<32){c+="\\u00"+t(2,g.toString(16));break}c+=f?b[d]:m?a.charAt(d):a[d]}}return c+'"'},v=function(a,b,c,d,i,j,k){var l,m,o,q,r,s,w,x,y,z,A,B,C,D,E,F;try{l=b[a]}catch(a){}if("object"==typeof l&&l)if("[object Date]"!=(m=h.call(l))||e.call(l,"toJSON"))"function"==typeof l.toJSON&&("[object Number]"!=m&&"[object String]"!=m&&"[object Array]"!=m||e.call(l,"toJSON"))&&(l=l.toJSON(a));else if(l>-1/0&&l<1/0){if(p){for(r=n(l/864e5),o=n(r/365.2425)+1970-1;p(o+1,0)<=r;o++);for(q=n((r-p(o,0))/30.42);p(o,q+1)<=r;q++);r=1+r-p(o,q),s=(l%864e5+864e5)%864e5,w=n(s/36e5)%24,x=n(s/6e4)%60,y=n(s/1e3)%60,z=s%1e3}else o=l.getUTCFullYear(),q=l.getUTCMonth(),r=l.getUTCDate(),w=l.getUTCHours(),x=l.getUTCMinutes(),y=l.getUTCSeconds(),z=l.getUTCMilliseconds();l=(o<=0||o>=1e4?(o<0?"-":"+")+t(6,o<0?-o:o):t(4,o))+"-"+t(2,q+1)+"-"+t(2,r)+"T"+t(2,w)+":"+t(2,x)+":"+t(2,y)+"."+t(3,z)+"Z"}else l=null;if(c&&(l=c.call(b,a,l)),null===l)return"null";if("[object Boolean]"==(m=h.call(l)))return""+l;if("[object Number]"==m)return l>-1/0&&l<1/0?""+l:"null";if("[object String]"==m)return u(""+l);if("object"==typeof l){for(D=k.length;D--;)if(k[D]===l)throw TypeError();if(k.push(l),A=[],E=j,j+=i,"[object Array]"==m){for(C=0,D=l.length;C<D;C++)B=v(C,l,c,d,i,j,k),A.push(B===g?"null":B);F=A.length?i?"[\n"+j+A.join(",\n"+j)+"\n"+E+"]":"["+A.join(",")+"]":"[]"}else f(d||l,function(a){var b=v(a,l,c,d,i,j,k);b!==g&&A.push(u(a)+":"+(i?" ":"")+b)}),F=A.length?i?"{\n"+j+A.join(",\n"+j)+"\n"+E+"}":"{"+A.join(",")+"}":"{}";return k.pop(),F}};k.stringify=function(a,b,c){var d,e,f,g;if("function"==typeof b||"object"==typeof b&&b)if("[object Function]"==(g=h.call(b)))e=b;else if("[object Array]"==g){f={};for(var i,j=0,k=b.length;j<k;i=b[j++],("[object String]"==(g=h.call(i))||"[object Number]"==g)&&(f[i]=1));}if(c)if("[object Number]"==(g=h.call(c))){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else"[object String]"==g&&(d=c.length<=10?c:c.slice(0,10));return v("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var w,x,y=String.fromCharCode,z={92:"\\",34:'"',47:"/",98:"\b",116:"  ",110:"\n",102:"\f",114:"\r"},A=function(){throw w=x=null,SyntaxError()},B=function(){for(var a,b,c,d,e,f=x,g=f.length;w<g;)switch(e=f.charCodeAt(w)){case 9:case 10:case 13:case 32:w++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=m?f.charAt(w):f[w],w++,a;case 34:for(a="@",w++;w<g;)if((e=f.charCodeAt(w))<32)A();else if(92==e)switch(e=f.charCodeAt(++w)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=z[e],w++;break;case 117:for(b=++w,c=w+4;w<c;w++)(e=f.charCodeAt(w))>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70||A();a+=y("0x"+f.slice(b,w));break;default:A()}else{if(34==e)break;for(e=f.charCodeAt(w),b=w;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++w);a+=f.slice(b,w)}if(34==f.charCodeAt(w))return w++,a;A();default:if(b=w,45==e&&(d=!0,e=f.charCodeAt(++w)),e>=48&&e<=57){for(48==e&&(e=f.charCodeAt(w+1))>=48&&e<=57&&A(),d=!1;w<g&&(e=f.charCodeAt(w))>=48&&e<=57;w++);if(46==f.charCodeAt(w)){for(c=++w;c<g&&(e=f.charCodeAt(c))>=48&&e<=57;c++);c==w&&A(),w=c}if(101==(e=f.charCodeAt(w))||69==e){for(e=f.charCodeAt(++w),43!=e&&45!=e||w++,c=w;c<g&&(e=f.charCodeAt(c))>=48&&e<=57;c++);c==w&&A(),w=c}return+f.slice(b,w)}if(d&&A(),"true"==f.slice(w,w+4))return w+=4,!0;if("false"==f.slice(w,w+5))return w+=5,!1;if("null"==f.slice(w,w+4))return w+=4,null;A()}return"$"},C=function(a){var b,c;if("$"==a&&A(),"string"==typeof a){if("@"==(m?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];"]"!=(a=B());c||(c=!0))c&&(","==a?"]"==(a=B())&&A():A()),","==a&&A(),b.push(C(a));return b}if("{"==a){for(b={};"}"!=(a=B());c||(c=!0))c&&(","==a?"}"==(a=B())&&A():A()),","!=a&&"string"==typeof a&&"@"==(m?a.charAt(0):a[0])&&":"==B()||A(),b[a.slice(1)]=C(B());return b}A()}return a},D=function(a,b,c){var d=E(a,b,c);d===g?delete a[b]:a[b]=d},E=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if("[object Array]"==h.call(e))for(d=e.length;d--;)D(e,d,c);else f(e,function(a){D(e,a,c)});return c.call(a,b,e)};k.parse=function(a,b){var c,d;return w=0,x=""+a,c=C(B()),"$"!=B()&&A(),w=x=null,b&&"[object Function]"==h.call(b)?E((d={},d[""]=c,d),"",b):c}}}i&&a(function(){return k})}(this)},{}],50:[function(a,b,c){function d(a,b){var c=[];b=b||0;for(var d=b||0;d<a.length;d++)c[d-b]=a[d];return c}b.exports=d},{}]},{},[1])(1)});var socketIoConnector={setup:function(a,b){this.connected=!1,this.inProcess=!1,this.endpoint=a,this.opts=b||{}},connect:function(a){return this.connected?a():this.inProcess?this.io.on("initFinish",a):(this.inProcess=!0,this.io=io.connect(this.endpoint,this.opts),this.io.on("connect",function(){this.io.emit("init",{sid:CBHCore.user.session_id,code:CBHCore.hunter_code})}.bind(this)),void this.io.on("initFinish",function(){this.connected=!0,this.inProcess=!1,a()}.bind(this)))}},socketIo=Object.create(socketIoConnector);socketIo.setup(CBHCore.opt.socketIOEndpoint);var v7_socketIo=Object.create(socketIoConnector);v7_socketIo.setup(CBHCore.opt.endpoint_protocol+"//"+CBHCore.opt.endpoint_v7,{path:"/clients/widget5/socket.io"});var callStatus={progressTimeout:null,statusTimeout:null,autoRefreshStatus:!0,connect:function(){CBHCore.helpers.freeMode()||callStatus.io||socketIo.connect(callStatus.main)},main:function(){callStatus.io=socketIo.io,callStatus.io.on("connect",callStatus.subscribe),callStatus.subscribe(),callStatus.io.on("callStatus",function(a){callStatus.changeStatus(a.event)})},subscribe:function(){callStatus.io.emit("callStatus")},changeStatus:function(a){if(clearTimeout(callStatus.statusTimeout),callStatus.autoRefreshStatus){var b="";switch(a){case"callingToManager":b=CBHCore.user.name?__("callStatus.callingToManager-name",{name:CBHCore.user.name}):__("callStatus.callingToManager");break;case"managerInvalid":b=b=__("callStatus.managerInvalid");break;case"callingToClient":b=CBHCore.user.name?__("callStatus.callingToClient-name",{name:CBHCore.user.name}):__("callStatus.callingToClient"),callStatus.statusTimeout=setTimeout(function(){callStatus.changeStatus("callingToClient2")},3500);break;case"callingToClient2":b=CBHCore.user.name?__("callStatus.callingToClient2-name",{name:CBHCore.user.name}):__("callStatus.callingToClient2"),callStatus.statusTimeout=setTimeout(function(){callStatus.changeStatus("callingToClient3")},3e3);break;case"callingToClient3":b=__("callStatus.callingToClient3");break;case"callingToClient4":b=CBHCore.user.name?__("callStatus.callingToClient4-name",{name:CBHCore.user.name}):__("callStatus.callingToClient4");break;case"client":b=__("callStatus.client");break;case"clientInvalid":b=CBHCore.user.name?__("callStatus.clientInvalid-name",{name:CBHCore.user.name}):__("callStatus.clientInvalid")}if(""!=b&&(b='<span class="cbh-typing">'+b+"</span>",callStatus.render(b),"undefined"!=typeof typingEffect)){var c=typingEffect.getSpeed();typingEffect.setSpeed(30,30),typingEffect.effect({doNotReset:!0,noCursor:!0},function(){clearTimeout(callStatus.progressTimeout),callStatus.progressTimeout=setTimeout(callStatus.progressDots,1e3),typingEffect.setSpeed(c[0],c[1])})}}},render:function(a){$(".cbh-status").html(a)},progressDots:function(){$(".cbh-status").forEach(function(a){var b=a.getElementsByTagName("span")[0];a&&b&&(/\.\.\.$/.test(b.innerHTML)?b.innerHTML=b.innerHTML.replace(/\.\.\.$/,"."):/\.\.$/.test(b.innerHTML)?b.innerHTML=b.innerHTML.replace(/\.\.$/,"..."):/\.$/.test(b.innerHTML)&&(b.innerHTML=b.innerHTML.replace(/\.$/,"..")))}),callStatus.progressTimeout=setTimeout(callStatus.progressDots,1e3)}};Countdown.prototype.addContainer=function(a){var b;"string"==typeof a?(b=a,a=doc.getElementById(b)):void 0!==a.elements?(b=a.getAttr("id"),a=a.elements[0]):b=a.id||"cbh_cntdwn_"+Math.floor(1e3*Math.random()),a&&b&&(this.elems[b]=a,this.reset())},Countdown.prototype.divide=function(a){var b={};b.hours=Math.floor(a/36e5),b.minutes=Math.floor((a-36e5*b.hours)/6e4),b.seconds=Math.floor((a-(36e5*b.hours+6e4*b.minutes))/1e3),b.ms=a-(36e5*b.hours+6e4*b.minutes+1e3*b.seconds),b.ms=b.ms.toString().substr(0,this.msNumbers);var c=Math.floor(a/1e3);return CBHCore.is_mobile?b.text=c<=86400?__("countdown.tomorrow"):c<=172800?__("countdown.afterTomorrow"):__("countdown.after")+" "+this.secondsToString(c,0):b.text=b.hours>23?this.secondsToString(c,0,1):this.secondsToString(c,1,2),b},Countdown.prototype.set=function(a){a=this.divide(a);for(var b in this.elems)if(this.elems.hasOwnProperty(b))for(var c in a)a.hasOwnProperty(c)&&("text"!=c&&(a[c]=String("0"+a[c]).slice(-2)),null==this.elems[b].placeholders[c]&&(this.elems[b].placeholders[c]=doc.getElementById(b+"_"+c)||this.elems[b].querySelector("#"+b+"_"+c)),this.elems[b].placeholders[c]&&(this.elems[b].placeholders[c].innerHTML=a[c]))},Countdown.prototype.reset=function(){this.running=!1;for(var a in this.elems)this.elems.hasOwnProperty(a)&&(this.elems[a].innerHTML=this.template.replace(/%(.+?)%/g,'<span id="'+a+'_$1"></span>'),this.elems[a].placeholders={});this.set(this.time-10)},Countdown.prototype.start=function(a){if(!this.running){this.running=!0;var b=+new Date;this.countdownInterval=setInterval(function(){var c=+new Date,d=this.time-(c-b);d>0?this.set(d):(this.set(0),clearInterval(this.countdownInterval),this.running=!1,CBHCore.helpers.isFunction(a)&&a())}.bind(this),this.delta)}},Countdown.prototype.stop=function(){clearInterval(this.countdownInterval)},Countdown.prototype.secondsToString=function(a,b,c,d){a=parseInt(a),"string"!=typeof d&&(d=" "),-1===[0,1,2,3].indexOf(b)&&(b=1),-1===[0,1,2,3].indexOf(c)&&(c=1);var e=["days","hours","minutes","seconds"];if(3===c)return __(e[3],{num:a});for(var f=[Math.floor(a/86400),Math.floor(a%86400/3600),Math.floor(a%86400%3600/60),a%86400%3600%60],g=1;g<3;g++)g>c&&(f[g+1]+=f[1]*(0===g?24:60),f[g]=0);0==b&&0===f[0]&&f[1]>0&&(f[0]=1,f[1]=0);var h=[];for(g in f)if(h.push(__(e[g],{num:f[g]})),g>b)break;return h.join(d)};var socialLikes={getTwitterCount:function(a,b){return},getFacebookCount:function(a,b){var c="https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22"+encodeURIComponent(a)+"%22&callback={cb}";helpers.requestJSONP(c,function(a){try{b(a.data[0].total_count)}catch(a){}})},getVKCount:function(a,b){var c="https://vk.com/share.php?act=count&index={index}&url="+encodeURIComponent(a);win.VK=win.VK||{},win.VK.Share=win.VK.Share||{},win.VK.Share.__count=win.VK.Share.__count||win.VK.Share.count||function(){},win.ClbhObject.__SLCallbacks=win.ClbhObject.__SLCallbacks||{},win.VK.Share.count=function(a,b){win.ClbhObject.__SLCallbacks[a]?win.ClbhObject.__SLCallbacks[a](b):win.VK.Share.__count(a,b)};var d=500+Math.floor(1e3*Math.random());win.ClbhObject.__SLCallbacks[d]=function(a){b(a),delete win.ClbhObject.__SLCallbacks[d]};var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript",f.src=c.replace("{index}",d),f.async=!0,e.appendChild(f)},popupTwitterShare:function(a,b,c){void 0===c&&(c=b),helpers.popupWindow("https://twitter.com/intent/tweet?url="+encodeURIComponent(a)+(c?"&text="+encodeURIComponent(c):""),600,450)},popupFacebookShare:function(a,b){helpers.popupWindow("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a)+(void 0!==b?"&s="+encodeURIComponent(b):""),600,500)},popupVKShare:function(a,b,c){helpers.popupWindow("http://vk.com/share.php?url="+encodeURIComponent(a)+(b?"&title="+encodeURIComponent(b):"")+(void 0!==c?"&description="+encodeURIComponent(c):""),550,330)}},externalChat={chosenService:!1,services:{livetex:function(){"function"==typeof LiveTex.openChatWindow?LiveTex.openChatWindow():"function"==typeof LiveTex.openWelcomeWindow&&LiveTex.openWelcomeWindow()},jivosite:function(){jivo_api.open()},redhelper:function(){RedHelper.fireEvent("openChat")},webconsult:function(){ConsultSystems.windowShow()},zopim:function(){$zopim(function(){$zopim.livechat.window.show()})},cloudim:function(){Cloudim.Api.openChat()}},exists:{livetex:function(a){a("undefined"!=typeof LiveTex)},jivosite:function(a){a("undefined"!=typeof jivo_api&&"function"==typeof jivo_api.open)},redhelper:function(a){a($("body").hasClass("redhlp_offline")||$("body").hasClass("redhlp_online"))},webconsult:function(a){a("undefined"!=typeof ConsultSystems&&"function"==typeof ConsultSystems.windowShow)},zopim:function(a){a("undefined"!=typeof $zopim)},cloudim:function(a){if("undefined"==typeof Cloudim||void 0===Cloudim.Api)return a(!1);Cloudim.Api.bind("onReady",function(){Cloudim.Api.getCurrentOperator(function(b){a(!!b)})})}},init:function(a,b){a&&void 0!==this.services[a]?this.exists[a](function(c){c?(this.chosenService=a,b(!0)):b(!1)}.bind(this)):b(!1)},open:function(){this.chosenService&&this.services[this.chosenService]()}},VoiceRecorder=Object.create(CBHCore.lib.EventEmitter);VoiceRecorder.isSupported=function(){return Recorder.isRecordingSupported()&&"https:"===document.location.protocol},VoiceRecorder.init=function(){this.recorder=new Recorder({encoderPath:"https://"+CBHCore.opt.static_domain+"/js/recorder/oggopusEncoder.js"}),this.recorder.addEventListener("streamError",function(a){this.emit("error",a)}.bind(this)),this.recorder.addEventListener("streamReady",function(a){this.emit("ready")}.bind(this)),this.recorder.addEventListener("dataAvailable",function(a){this.canceled||this.emit("data",a.detail)}.bind(this)),this.recorder.initStream()},VoiceRecorder.record=function(){this.recorder.start()},VoiceRecorder.stop=function(){this.canceled=!1,this.recorder.stop()},VoiceRecorder.cancel=function(){
this.canceled=!0,this.recorder.stop()};var tgChat=Object.create(CBHCore.lib.EventEmitter);tgChat.filesDir="https://"+CBHCore.opt.static_domain+"/uploads/tg_files/",tgChat.settings={logLimit:10,autoPilotStart:CBHCore.db_params.tg_chat_autopilot_start||60},tgChat.chats={},tgChat.connect=function(a){if(a=a||function(){},this.io)return this.main(a);socketIo.connect(this.main.bind(this,a))},tgChat.loadState=function(){this.state=CBHCore.storage.get("tgchat_state","local");var a=CBHCore.storage.get("tgchat_log","local");!this.state&&a&&(this.state={},this.state[0]={},this.state[0].meta={id:0},this.state[0].sendData={},this.state[0].messages=[],this.state[0].log=a.map(function(a){var b=a;return b.time=new StrongDate(b.time),b.office_id=0,b}.bind(this)),this.state[0].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))),this.state&&(Object.keys(this.state).forEach(function(a){this.state[a].log=this.state[a].log.map(function(a){var b=a;return b.time=new StrongDate(b.time),b}.bind(this)),this.state[a].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))}.bind(this)),this.connect())},tgChat.saveState=function(){this.state={},Object.keys(this.chats).forEach(function(a){this.state[a]=this.chats[a].state}.bind(this)),CBHCore.storage.save("tgchat_state",this.state,"local")},tgChat.main=function(a){this.io=socketIo.io,this.io.emit("tgInit",{canRecordVoice:tgChatRecorder.isSupported(),canPlayAudio:tgChatPlayer.isSupported()}),this.inited||(this.inited=!0,this.io.on("tgMessage",this.handleIncomingMessage.bind(this)),this.io.on("tgSecondInstanceError",function(){this.emit("secondInstanceError")}.bind(this)),this.io.once("tgOffices",function(a){var b=a;0===b.length&&(b=[{id:0}]),b.forEach(function(a){this.chats[a.id]=Object.create(tgChatSub),this.chats[a.id].super=this,this.chats[a.id].init(a)}.bind(this)),this.emit("chats",this.chats)}.bind(this)))},tgChat.handleIncomingMessage=function(a){this.chats[a.office_id||0].handleIncomingMessage(a)};var tgChatSub=Object.create(CBHCore.lib.EventEmitter);tgChatSub.init=function(a){this.io=this.super.io;var b=this.super.state&&this.super.state[a.id];this.state=b||{meta:a,log:[],sendData:{},messages:[]},this.session={},this.resetupAutoPilot()},tgChatSub.handleIncomingMessage=function(a){if(a.message_id&&this.io.emit("tgConfirm",a.message_id),"manager"===a.from&&this.resetAutoPilot(),"setAutoPilot"===a.event)return void setTimeout(this.setAutoResponse.bind(this),1e3);var b={};b.event=a.event,a.avatar&&(b.avatar=tgChat.filesDir+a.avatar),b.direction="client"===a.from?"out":"in",a.message&&(b.message=a.message),"voiceMessage"===a.event&&a.filename&&(b.filename=a.filename),this.addMessage(b)},tgChatSub.sendMessage=function(a){0!==a.length&&(0===this.state.log.length&&(sendGaEvent("send","event","Callbackhunter_CHAT_CLIENT","clicked"),sendYaMetrikaEvent("Callbackhunter_CHAT_CLIENT")),this.addMessage({message:a,direction:"out",office_id:this.state.meta.id}),this.autoPilot||CBHCore.params.mainSchedule.isWorkTime()?this.autoPilot?setTimeout(function(){this.autoPilot(a)}.bind(this),500):(this.state.messages.push(a),this.io.emit("tgMessage",a,this.state.meta.id)):(this.state.messages.push(a),setTimeout(function(){this.nightAutoPilot()}.bind(this),500)),this.super.saveState())},tgChatSub.setAutoResponse=function(){setTimeout(this.autoResponse.bind(this),500),this.setupAutoPilot(),this.super.saveState()},tgChatSub.addMessage=function(a){a.time||(a.time=new StrongDate),this.saveMessage(a),this.emit("message",a)},tgChatSub.saveMessage=function(a){this.state.log.push(a),this.state.log.length>tgChat.settings.logLimit&&this.state.log.shift(),this.super.saveState()},tgChatSub.msgAutoPilot=function(a){var b=Math.floor(1e5*Math.random());return this.addMessage({message:a,direction:"in",origin:"tech",id:b}),b},tgChatSub.autoResponse=function(){var a=this.msgAutoPilot(__("tgChat.autoPilot.response",{sec:'<span class="cbh-chat-timer">'+tgChat.settings.autoPilotStart+"</span>"})),b=$("#cbh_widget_chat_message_"+a).findChild(".cbh-chat-timer"),c=tgChat.settings.autoPilotStart;this.autoResponseTimer=setInterval(function(){c-=1,b.html(c),0===c&&clearInterval(this.autoResponseTimer)}.bind(this),1e3)},tgChatSub.setupAutoPilot=function(){this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),1e3*tgChat.settings.autoPilotStart);var a=+new StrongDate+1e3*tgChat.settings.autoPilotStart;this.state.autoPilotTime=a,this.super.saveState()},tgChatSub.resetAutoPilot=function(){this.state.autoPilotTime=null,this.super.saveState(),clearInterval(this.autoResponseTimer),clearTimeout(this.session.autoPilotTimeout),this.autoPilot=!1,this.emit("resetAutoPilot")},tgChatSub.resetupAutoPilot=function(){var a=this.state.autoPilotTime;if(a){a=new StrongDate(a);var b=a-+new StrongDate;b>1e3?this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),b):b>-6e4?this.startAutoPilot():this.resetAutoPilot()}},tgChatSub.nightAutoPilot=function(){var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name-night",{name:CBHCore.user.name,sec:tgChat.settings.autoPilotStart}):__("tgChat.autoPilot.start-night",{sec:tgChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts-night"))}.bind(this),1e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},tgChatSub.startAutoPilot=function(){this.resetAutoPilot(),this.io.emit("tgAutoPilot",this.state.meta.id),this.emit("autoPilot");var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name",{name:CBHCore.user.name,sec:tgChat.settings.autoPilotStart}):__("tgChat.autoPilot.start",{sec:tgChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts"))}.bind(this),1e3),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeHere"))}.bind(this),2e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},tgChatSub.checkContactsAutoPilot=function(a){this.state.sendData.contacts=a,this.super.saveState(),this.sendQuestion(),CBHCore.user.name?(this.msgAutoPilot(__("tgChat.autoPilot.thanks")),this.autoPilot=function(){}):(this.msgAutoPilot(__("tgChat.autoPilot.writeName")),this.autoPilot=this.checkNameAutoPilot)},tgChatSub.checkNameAutoPilot=function(a){this.state.sendData.name=a,this.super.saveState(),this.sendQuestion(),this.msgAutoPilot(__("tgChat.autoPilot.thanksName")),this.autoPilot=this.addToQuestion},tgChatSub.addToQuestion=function(a){this.state.messages.push(a),this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.sendQuestion()},tgChatSub.sendQuestion=function(){this.io.emit("tgQuestion",this.state.sendData,this.state.meta.id)},tgChat.formatDuration=function(a){var b=Math.ceil(a),c=Math.floor(b/60);return b-=60*c,c<10&&(c="0"+c),b<10&&(b="0"+b),c+":"+b};var tgChatRecorderSuper=Object.create(CBHCore.lib.EventEmitter),tgChatRecorder={};tgChatRecorder.init=function(a){this.officeId=a.officeId||0,this.state={},this.permButton.on("click",this.requestPermission.bind(this)),this.startButton.on("mousedown",this.start.bind(this)),this.startButton.on("mouseup",this.stop.bind(this)),this.enable(),tgChatRecorderSuper.on("granted",this.handleGranted.bind(this)),tgChatRecorderSuper.on("prompt",this.handlePrompt.bind(this)),tgChatRecorderSuper.on("denied",this.handleDenied.bind(this))},tgChatRecorder.enable=function(){if(this.state){var a=this.getPermission();"granted"===a?this.startButton.show():"denied"===a?this.muteButton.show():this.permButton.show()}},tgChatRecorder.disable=function(){this.state&&(this.startButton.hide(),this.muteButton.hide(),this.permButton.hide())},tgChatRecorder.isSupported=function(){return VoiceRecorder.isSupported()},tgChatRecorder.getPermission=function(){return localStorage.getItem("voice_access")},tgChatRecorder.handleGranted=function(){localStorage.setItem("voice_access","granted"),this.permButton.hide(),this.startButton.show()},tgChatRecorder.handlePrompt=function(){localStorage.setItem("voice_access","prompt")},tgChatRecorder.handleDenied=function(){localStorage.setItem("voice_access","denied"),this.permButton.hide(),this.muteButton.show()},tgChatRecorder.requestPermission=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia({audio:!0},function(){tgChatRecorderSuper.emit("granted")},function(a){return"PermissionDismissedError"==a.name?void tgChatRecorderSuper.emit("prompt"):"PermissionDeniedError"==a.name?void tgChatRecorderSuper.emit("denied"):void 0}.bind(this))},tgChatRecorder.start=function(){this.state.currentRecorder=Object.create(VoiceRecorder),this.state.currentRecorder.on("error",console.error.bind(console)),this.state.currentRecorder.on("ready",function(){this.state.currentRecorder.record()}.bind(this)),this.state.currentRecorder.on("data",this.upload.bind(this)),this.state.currentRecorder.init(),this.state.startRecordTime=new Date,this.state.durationChecker=setInterval(function(){this.setDuration(Math.floor((+new Date-+this.state.startRecordTime)/1e3))}.bind(this),1e3),this.setDuration(0),this.recordStatuses.hide(),this.chatInput.hide(),this.recordStatus.show(),this.recordStatusGoing.show()},tgChatRecorder.setDuration=function(a){this.recordStatusDur.html(tgChat.formatDuration(a))},tgChatRecorder.stop=function(){clearInterval(this.state.durationChecker),+new Date-+this.state.startRecordTime<1e3?(this.state.currentRecorder.cancel(),this.recordStatuses.hide(),this.chatInput.hide(),this.recordStatus.show(),this.recordStatusCanceled.show(),setTimeout(function(){this.chatInput.show(),this.recordStatus.hide()}.bind(this),3e3)):this.state.currentRecorder.stop()},tgChatRecorder.upload=function(a){this.recordStatuses.hide(),this.chatInput.hide(),this.recordStatus.show(),this.recordStatusUploading.show();var b=new FileReader;b.onload=function(a){var b=new FormData,c=encodeURIComponent("audio_"+(new Date).getTime()+".ogg");b.append("fname",c),b.append("data",a.target.result);var d=new XMLHttpRequest;d.open("POST","https://"+CBHCore.opt.endpoint+"/socketupload/voice?"+CBHCore.helpers.makeQueryString({sid:CBHCore.user.session_id,code:CBHCore.hunter_code,office_id:this.officeId})),d.addEventListener("load",function(){this.recordStatuses.hide(),this.chatInput.show(),this.recordStatus.hide()}.bind(this)),d.send(b)}.bind(this),b.readAsDataURL(a)};var tgChatPlayer={};tgChatPlayer.init=function(a){this.player=new Audio,this.player.volume=.1,this.player.preload="auto",this.player.canPlayType("audio/mp3")?this.player.src=tgChat.filesDir+a+".mp3":this.player.canPlayType("audio/ogg")&&(this.player.src=tgChat.filesDir+a+".ogg"),this.playButton.on("click",this.play.bind(this)),this.pauseButton.on("click",this.pause.bind(this)),this.currentTime.html(tgChat.formatDuration(0)),this.duration.html(tgChat.formatDuration(0)),this.player.addEventListener("timeupdate",function(){this.currentTime.html(tgChat.formatDuration(this.player.currentTime))}.bind(this)),this.player.addEventListener("durationchange",function(){this.duration.html(tgChat.formatDuration(this.player.duration))}.bind(this)),this.player.addEventListener("ended",function(){this.pause(),this.currentTime.html(tgChat.formatDuration(0))}.bind(this)),this.pause()},tgChatPlayer.isSupported=function(){var a=new Audio;return a.canPlayType("audio/mp3")||a.canPlayType("audio/ogg")},tgChatPlayer.play=function(){this.player.play(),this.playButton.hide(),this.pauseButton.show()},tgChatPlayer.pause=function(){this.player.pause(),this.playButton.show(),this.pauseButton.hide()};var vkChat=Object.create(CBHCore.lib.EventEmitter);vkChat.filesDir="https://"+CBHCore.opt.static_domain+"/uploads/tg_files/",vkChat.settings={logLimit:10,autoPilotStart:CBHCore.db_params.tg_chat_autopilot_start||60},vkChat.chats={},vkChat.connect=function(a){if(a=a||function(){},this.io)return this.main(a);socketIo.connect(this.main.bind(this,a))},vkChat.loadState=function(){this.state=CBHCore.storage.get("vkchat_state","local");var a=CBHCore.storage.get("vkchat_log","local");!this.state&&a&&(this.state={},this.state[0]={},this.state[0].meta={id:0},this.state[0].sendData={},this.state[0].messages=[],this.state[0].log=a.map(function(a){var b=a;return b.time=new StrongDate(b.time),b.office_id=0,b}.bind(this)),this.state[0].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))),this.state&&(Object.keys(this.state).forEach(function(a){this.state[a].log=this.state[a].log.map(function(a){var b=a;return b.time=new StrongDate(b.time),b}.bind(this)),this.state[a].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))}.bind(this)),this.connect())},vkChat.saveState=function(){this.state={},Object.keys(this.chats).forEach(function(a){this.state[a]=this.chats[a].state}.bind(this)),CBHCore.storage.save("vkchat_state",this.state,"local")},vkChat.main=function(a){this.io=socketIo.io,this.io.emit("vkInit",{}),this.inited||(this.inited=!0,this.io.on("vkMessage",this.handleIncomingMessage.bind(this)),this.io.on("vkSecondInstanceError",function(){this.emit("secondInstanceError")}.bind(this)),this.io.once("vkOffices",function(a){var b=a;0===b.length&&(b=[{id:0}]),b.forEach(function(a){this.chats[a.id]=Object.create(vkChatSub),this.chats[a.id].super=this,this.chats[a.id].init(a)}.bind(this)),this.emit("chats",this.chats)}.bind(this)))},vkChat.handleIncomingMessage=function(a){this.chats[a.office_id||0].handleIncomingMessage(a)};var vkChatSub=Object.create(CBHCore.lib.EventEmitter);vkChatSub.init=function(a){this.io=this.super.io;var b=this.super.state&&this.super.state[a.id];this.state=b||{meta:a,log:[],sendData:{},messages:[]},this.session={},this.resetupAutoPilot()},vkChatSub.handleIncomingMessage=function(a){if(a.message_id&&this.io.emit("vkConfirm",a.message_id),"manager"===a.from&&this.resetAutoPilot(),"setAutoPilot"===a.event)return void setTimeout(this.setAutoResponse.bind(this),1e3);var b={};b.event=a.event,a.avatar&&(b.avatar=vkChat.filesDir+a.avatar),b.direction="client"===a.from?"out":"in",a.message&&(b.message=a.message),this.addMessage(b)},vkChatSub.sendMessage=function(a){0!==a.length&&(0===this.state.log.length&&(sendGaEvent("send","event","Callbackhunter_CHAT_CLIENT","clicked"),sendYaMetrikaEvent("Callbackhunter_CHAT_CLIENT")),this.addMessage({message:a,direction:"out",office_id:this.state.meta.id}),this.autoPilot||CBHCore.params.mainSchedule.isWorkTime()?this.autoPilot?setTimeout(function(){this.autoPilot(a)}.bind(this),500):(this.state.messages.push(a),this.io.emit("vkMessage",a,this.state.meta.id)):(this.state.messages.push(a),setTimeout(function(){this.nightAutoPilot()}.bind(this),500)),this.super.saveState())},vkChatSub.setAutoResponse=function(){setTimeout(this.autoResponse.bind(this),500),this.setupAutoPilot(),this.super.saveState()},vkChatSub.addMessage=function(a){a.time||(a.time=new StrongDate),this.saveMessage(a),this.emit("message",a)},vkChatSub.saveMessage=function(a){this.state.log.push(a),this.state.log.length>vkChat.settings.logLimit&&this.state.log.shift(),this.super.saveState()},vkChatSub.msgAutoPilot=function(a){var b=Math.floor(1e5*Math.random());return this.addMessage({message:a,direction:"in",origin:"tech",id:b}),b},vkChatSub.autoResponse=function(){var a=this.msgAutoPilot(__("tgChat.autoPilot.response",{sec:'<span class="cbh-chat-timer">'+vkChat.settings.autoPilotStart+"</span>"})),b=$("#cbh_widget_chat_message_"+a).findChild(".cbh-chat-timer"),c=vkChat.settings.autoPilotStart;this.autoResponseTimer=setInterval(function(){c-=1,b.html(c),0===c&&clearInterval(this.autoResponseTimer)}.bind(this),1e3)},vkChatSub.setupAutoPilot=function(){this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),1e3*vkChat.settings.autoPilotStart);var a=+new StrongDate+1e3*vkChat.settings.autoPilotStart;this.state.autoPilotTime=a,this.super.saveState()},vkChatSub.resetAutoPilot=function(){this.state.autoPilotTime=null,this.super.saveState(),clearInterval(this.autoResponseTimer),clearTimeout(this.session.autoPilotTimeout),this.autoPilot=!1,this.emit("resetAutoPilot")},vkChatSub.resetupAutoPilot=function(){var a=this.state.autoPilotTime;if(a){a=new StrongDate(a);var b=a-+new StrongDate;b>1e3?this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),b):b>-6e4?this.startAutoPilot():this.resetAutoPilot()}},vkChatSub.nightAutoPilot=function(){var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name-night",{name:CBHCore.user.name,sec:vkChat.settings.autoPilotStart}):__("tgChat.autoPilot.start-night",{sec:vkChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts-night"))}.bind(this),1e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},vkChatSub.startAutoPilot=function(){this.resetAutoPilot(),this.io.emit("vkAutoPilot",this.state.meta.id),this.emit("autoPilot");var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name",{name:CBHCore.user.name,sec:vkChat.settings.autoPilotStart}):__("tgChat.autoPilot.start",{sec:vkChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts"))}.bind(this),1e3),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeHere"))}.bind(this),2e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},vkChatSub.checkContactsAutoPilot=function(a){this.state.sendData.contacts=a,this.super.saveState(),this.sendQuestion(),CBHCore.user.name?(this.msgAutoPilot(__("tgChat.autoPilot.thanks")),this.autoPilot=function(){}):(this.msgAutoPilot(__("tgChat.autoPilot.writeName")),this.autoPilot=this.checkNameAutoPilot)},vkChatSub.checkNameAutoPilot=function(a){this.state.sendData.name=a,this.super.saveState(),this.sendQuestion(),this.msgAutoPilot(__("tgChat.autoPilot.thanksName")),this.autoPilot=this.addToQuestion},vkChatSub.addToQuestion=function(a){this.state.messages.push(a),this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.sendQuestion()},vkChatSub.sendQuestion=function(){this.io.emit("vkQuestion",this.state.sendData,this.state.meta.id)};var fbChat=Object.create(CBHCore.lib.EventEmitter);fbChat.filesDir="https://"+CBHCore.opt.static_domain+"/uploads/tg_files/",fbChat.settings={logLimit:10,autoPilotStart:CBHCore.db_params.tg_chat_autopilot_start||60},fbChat.chats={},fbChat.connect=function(a){if(a=a||function(){},this.io)return this.main(a);socketIo.connect(this.main.bind(this,a))},fbChat.loadState=function(){this.state=CBHCore.storage.get("fbchat_state","local");var a=CBHCore.storage.get("fbchat_log","local");!this.state&&a&&(this.state={},this.state[0]={},this.state[0].meta={id:0},this.state[0].sendData={},this.state[0].messages=[],this.state[0].log=a.map(function(a){var b=a;return b.time=new StrongDate(b.time),b.office_id=0,b}.bind(this)),this.state[0].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))),this.state&&(Object.keys(this.state).forEach(function(a){this.state[a].log=this.state[a].log.map(function(a){var b=a;return b.time=new StrongDate(b.time),b}.bind(this)),this.state[a].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))}.bind(this)),this.connect())},fbChat.saveState=function(){this.state={},Object.keys(this.chats).forEach(function(a){this.state[a]=this.chats[a].state}.bind(this)),CBHCore.storage.save("fbchat_state",this.state,"local")},fbChat.main=function(a){this.io=socketIo.io,this.io.emit("fbInit",{}),this.inited||(this.inited=!0,this.io.on("fbMessage",this.handleIncomingMessage.bind(this)),this.io.on("fbSecondInstanceError",function(){this.emit("secondInstanceError")}.bind(this)),this.io.once("fbOffices",function(a){var b=a;0===b.length&&(b=[{id:0}]),b.forEach(function(a){this.chats[a.id]=Object.create(fbChatSub),this.chats[a.id].super=this,this.chats[a.id].init(a)}.bind(this)),this.emit("chats",this.chats)}.bind(this)))},fbChat.handleIncomingMessage=function(a){this.chats[a.office_id||0].handleIncomingMessage(a)};var fbChatSub=Object.create(CBHCore.lib.EventEmitter);fbChatSub.init=function(a){this.io=this.super.io;var b=this.super.state&&this.super.state[a.id];this.state=b||{meta:a,log:[],sendData:{},messages:[]},this.session={},this.resetupAutoPilot()},fbChatSub.handleIncomingMessage=function(a){if(a.message_id&&this.io.emit("fbConfirm",a.message_id),"manager"===a.from&&this.resetAutoPilot(),"setAutoPilot"===a.event)return void setTimeout(this.setAutoResponse.bind(this),1e3);var b={};b.event=a.event,a.avatar&&(b.avatar=fbChat.filesDir+a.avatar),b.direction="client"===a.from?"out":"in",a.message&&(b.message=a.message),this.addMessage(b)},fbChatSub.sendMessage=function(a){0!==a.length&&(0===this.state.log.length&&(sendGaEvent("send","event","Callbackhunter_CHAT_CLIENT","clicked"),sendYaMetrikaEvent("Callbackhunter_CHAT_CLIENT")),this.addMessage({message:a,direction:"out",office_id:this.state.meta.id}),this.autoPilot||CBHCore.params.mainSchedule.isWorkTime()?this.autoPilot?setTimeout(function(){this.autoPilot(a)}.bind(this),500):(this.state.messages.push(a),this.io.emit("fbMessage",a,this.state.meta.id)):(this.state.messages.push(a),setTimeout(function(){this.nightAutoPilot()}.bind(this),500)),this.super.saveState())},fbChatSub.setAutoResponse=function(){setTimeout(this.autoResponse.bind(this),500),this.setupAutoPilot(),this.super.saveState()},fbChatSub.addMessage=function(a){a.time||(a.time=new StrongDate),this.saveMessage(a),this.emit("message",a)},fbChatSub.saveMessage=function(a){this.state.log.push(a),this.state.log.length>fbChat.settings.logLimit&&this.state.log.shift(),this.super.saveState()},fbChatSub.msgAutoPilot=function(a){var b=Math.floor(1e5*Math.random());return this.addMessage({message:a,direction:"in",origin:"tech",id:b}),b},fbChatSub.autoResponse=function(){var a=this.msgAutoPilot(__("tgChat.autoPilot.response",{sec:'<span class="cbh-chat-timer">'+fbChat.settings.autoPilotStart+"</span>"})),b=$("#cbh_widget_chat_message_"+a).findChild(".cbh-chat-timer"),c=fbChat.settings.autoPilotStart;this.autoResponseTimer=setInterval(function(){c-=1,b.html(c),0===c&&clearInterval(this.autoResponseTimer)}.bind(this),1e3)},fbChatSub.setupAutoPilot=function(){this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),1e3*fbChat.settings.autoPilotStart);var a=+new StrongDate+1e3*fbChat.settings.autoPilotStart;this.state.autoPilotTime=a,this.super.saveState()},fbChatSub.resetAutoPilot=function(){this.state.autoPilotTime=null,this.super.saveState(),clearInterval(this.autoResponseTimer),clearTimeout(this.session.autoPilotTimeout),this.autoPilot=!1,this.emit("resetAutoPilot")},fbChatSub.resetupAutoPilot=function(){var a=this.state.autoPilotTime;if(a){a=new StrongDate(a);var b=a-+new StrongDate;b>1e3?this.session.autoPilotTimeout=setTimeout(this.startAutoPilot.bind(this),b):b>-6e4?this.startAutoPilot():this.resetAutoPilot()}},fbChatSub.nightAutoPilot=function(){var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name-night",{name:CBHCore.user.name,sec:fbChat.settings.autoPilotStart}):__("tgChat.autoPilot.start-night",{sec:fbChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts-night"))}.bind(this),1e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},fbChatSub.startAutoPilot=function(){this.resetAutoPilot(),this.io.emit("fbAutoPilot",this.state.meta.id),this.emit("autoPilot");var a;a=CBHCore.user.name?__("tgChat.autoPilot.start-name",{name:CBHCore.user.name,sec:fbChat.settings.autoPilotStart}):__("tgChat.autoPilot.start",{sec:fbChat.settings.autoPilotStart}),this.msgAutoPilot(a),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeContacts"))}.bind(this),1e3),setTimeout(function(){this.msgAutoPilot(__("tgChat.autoPilot.writeHere"))}.bind(this),2e3),this.state.sendData.name=CBHCore.user.name||"",this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.autoPilot=this.checkContactsAutoPilot},fbChatSub.checkContactsAutoPilot=function(a){this.state.sendData.contacts=a,this.super.saveState(),this.sendQuestion(),CBHCore.user.name?(this.msgAutoPilot(__("tgChat.autoPilot.thanks")),this.autoPilot=function(){}):(this.msgAutoPilot(__("tgChat.autoPilot.writeName")),this.autoPilot=this.checkNameAutoPilot)},fbChatSub.checkNameAutoPilot=function(a){this.state.sendData.name=a,this.super.saveState(),this.sendQuestion(),this.msgAutoPilot(__("tgChat.autoPilot.thanksName")),this.autoPilot=this.addToQuestion},fbChatSub.addToQuestion=function(a){this.state.messages.push(a),this.state.sendData.question=this.state.messages.join(". "),this.super.saveState(),this.sendQuestion()},fbChatSub.sendQuestion=function(){this.io.emit("fbQuestion",this.state.sendData,this.state.meta.id)};var slChat=Object.create(CBHCore.lib.EventEmitter);slChat.filesDir="https://"+CBHCore.opt.static_domain+"/uploads/tg_files/",slChat.settings={logLimit:10},slChat.chats={},slChat.connect=function(a){if(a=a||function(){},this.io)return this.main(a);v7_socketIo.connect(this.main.bind(this,a))},slChat.loadState=function(){this.state=CBHCore.storage.get("slchat_state","local"),this.state&&(Object.keys(this.state).forEach(function(a){this.state[a].log=this.state[a].log.map(function(a){var b=a;return b.time=new StrongDate(b.time),b}.bind(this)),this.state[a].log.forEach(function(a){this.lastMessage?+this.lastMessage.time<+a.time&&(this.lastMessage=a):this.lastMessage=a}.bind(this))}.bind(this)),this.connect())},slChat.saveState=function(){this.state={},Object.keys(this.chats).forEach(function(a){this.state[a]=this.chats[a].state}.bind(this)),CBHCore.storage.save("slchat_state",this.state,"local")},slChat.main=function(a){if(this.io=v7_socketIo.io,this.io.emit("slInit",{}),!this.inited){this.inited=!0,this.io.on("slMessage",this.handleIncomingMessage.bind(this)),this.io.on("slSecondInstanceError",function(){this.emit("secondInstanceError")}.bind(this));[{id:0}].forEach(function(a){this.chats[a.id]=Object.create(slChatSub),this.chats[a.id].super=this,this.chats[a.id].init(a)}.bind(this)),this.emit("chats",this.chats)}},slChat.handleIncomingMessage=function(a){this.chats[a.office_id||0].handleIncomingMessage(a)};var slChatSub=Object.create(CBHCore.lib.EventEmitter);slChatSub.init=function(a){this.io=this.super.io;var b=this.super.state&&this.super.state[a.id];this.state=b||{meta:a,log:[],sendData:{},messages:[]},this.session={}},slChatSub.handleIncomingMessage=function(a){a.message_id&&this.io.emit("slConfirm",a.message_id);var b={};b.event=a.event,a.avatar&&(b.avatar=slChat.filesDir+a.avatar),b.direction="client"===a.from?"out":"in",a.message&&(b.message=a.message),this.addMessage(b)},slChatSub.sendMessage=function(a){0!==a.length&&(0===this.state.log.length&&(sendGaEvent("send","event","Callbackhunter_CHAT_CLIENT","clicked"),sendYaMetrikaEvent("Callbackhunter_CHAT_CLIENT")),this.addMessage({message:a,direction:"out",office_id:this.state.meta.id}),this.state.messages.push(a),this.io.emit("slMessage",a,this.state.meta.id),this.super.saveState())},slChatSub.addMessage=function(a){a.time||(a.time=new StrongDate),this.saveMessage(a),this.emit("message",a)},slChatSub.saveMessage=function(a){this.state.log.push(a),this.state.log.length>slChat.settings.logLimit&&this.state.log.shift(),this.super.saveState()},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),function(){if(!Array.prototype.find){var a=function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("Array.prototype.find: predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b};Object.defineProperty(Array.prototype,"find",{value:a,configurable:!0})}}(),Array.prototype.reduce||(Array.prototype.reduce=function(a){if(null==this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var b,c=Object(this),d=c.length>>>0,e=0;if(2==arguments.length)b=arguments[1];else{for(;e<d&&!(e in c);)e++;if(e>=d)throw new TypeError("Reduce of empty array with no initial value");b=c[e++]}for(;e<d;e++)e in c&&(b=a(b,c[e],e,c));return b});var chat={inited:!1,num:0,started:!1,init:function(){this.inited||(this.inited=!0,tgChat.on("secondInstanceError",function(){$("#cbh_widget_chat_error").html(__("tgChat.errors.secondInstance")).show(),this.started=!0}.bind(this)),tgChat.on("chats",this.createChats.bind(this)),tgChat.loadState(),(!tgChat.state||+new StrongDate-+tgChat.lastMessage.time>864e5)&&1==CBHCore.db_params.tg_chat_greeting&&setTimeout(this.greeting.bind(this),1e3*CBHCore.db_params.tg_chat_greeting_delay))},createChats:function(a){Object.keys(a).forEach(function(c){var d=a[c],e=$("<div></div>").addClass("cbh-widget-chat__chat-sub").addClass("cbh-hide").attr("id","cbh_widget_chat__chat_sub_"+c);e.html(tpl.slider_chat()),0!=c&&($("#cbh_widget_chat_offices").show(),$("#cbh_widget_chat_offices_select").append($("<option>").attr("value",c).html(d.state.meta.name))),d.on("message",this.renderChatMessage.bind(this,e)),d.on("message",function(){this.started=!0}.bind(this)),d.on("message",function(a){"out"!==a.direction&&"button"===units.chat.visible&&(units.chat.badge(units.chat.badgeNum+1),0!=c&&($("#cbh_widget_chat_offices_select").val(c),b()))});var f=function(){var a=e.findChild(".cbh_widget_chat_input").val().trim();return e.findChild(".cbh_widget_chat_input").val(""),a};if(e.findChild(".cbh_widget_chat_send").on("click",function(){d.sendMessage(f()),CBHEvents.widgetTgMessageSent()}.bind(this)),e.findChild(".cbh_widget_chat_input").on("keyup",function(a){return 13!=a.which&&13!=a.keyCode||(d.sendMessage(f()),CBHEvents.widgetTgMessageSent(),!1)}.bind(this)),$(".cbh-widget-chat__chats").append(e),CBHCore.params.mainSchedule.isWorkTime()&&tgChatRecorder.isSupported()){var g=Object.create(tgChatRecorder);g.permButton=e.findChild(".cbh_widget_chat_record_perm"),g.startButton=e.findChild(".cbh_widget_chat_record_start"),g.muteButton=e.findChild(".cbh_widget_chat_record_mute"),g.chatInput=e.findChild(".cbh_widget_chat_input"),g.recordStatus=e.findChild(".cbh_widget_chat_record_status"),g.recordStatuses=e.findChild(".cbh-widget-chat__record_status_msg"),g.recordStatusGoing=e.findChild(".cbh_widget_chat_record_status_going"),g.recordStatusCanceled=e.findChild(".cbh_widget_chat_record_status_canceled"),g.recordStatusUploading=e.findChild(".cbh_widget_chat_record_status_uploading"),g.recordStatusDur=e.findChild(".cbh_widget_chat_record_status_duration"),g.init({officeId:c}),d.on("autoPilot",function(){g.disable()}),d.on("resetAutoPilot",function(){g.enable()})}d.state.log.forEach(this.renderChatMessage.bind(this,e))}.bind(this));var b=function(){var a=$("#cbh_widget_chat_offices_select").val()
;this.chat=a,$(".cbh-widget-chat__chat-sub").hide(),$("#cbh_widget_chat__chat_sub_"+a).show()}.bind(this);$("#cbh_widget_chat_offices_select").on("change",b),this.chat=Object.keys(a)[0],$("#cbh_widget_chat__chat_sub_"+this.chat).show(),$(".cbh_widget_chat_messages_wr").on("mousedown",function(a){a.stopPropagation()})},greeting:function(){if(!userCaught&&"main"!==units.chat.visible&&!this.started){userCaught=!0,this.started=!0;var a=function(){this.renderChatMessage($("#cbh_widget_chat__chat_sub_"+this.chat),{direction:"in",origin:"tech",message:CBHCore.db_params.tg_chat_greeting_text,time:new StrongDate})}.bind(this);tgChat.state?a():tgChat.on("chats",a),units.chat._show()}},renderChatMessage:function(a,b){this.num++;var c=b.id||this.num,d=["cbh-widget-chat__message"];"in"===b.direction?d.push("cbh-widget-chat__message_in"):d.push("cbh-widget-chat__message_out"),"tech"===b.origin&&d.push("cbh-widget-chat__message_tech");var e;b.message&&(e=b.message),e&&"tech"!==b.origin&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e?linkify(e):"","voiceMessage"===b.event&&(e="");var f="",g=function(a){return(a<10?"0":"")+a};(new StrongDate).toDateString()!==b.time.toDateString()&&(f=b.time.getFullYear()+"."+g(b.time.getMonth()+1)+"."+g(b.time.getDate())+" "),f+=b.time.getHours()+":"+g(b.time.getMinutes());var h="";if(!b.avatar||1!==CBHCore.db_params.tg_chat_avatars&&void 0!==CBHCore.db_params.tg_chat_avatars||(h='<span class="cbh-widget-chat__message-avatar"><img src="'+b.avatar+'"></span>',d.push("cbh-widget-chat__message_in_avatar")),a.findChild(".cbh-widget-chat__messages").append($("<li>").addClass(d).html('<div><span class="cbh-widget-chat__message-inner" id="cbh_widget_chat_message_'+c+'">'+e+'</span><span class="cbh-widget-chat__message-time" title="'+b.time.toString()+'">'+f+"</span></div>"+h)),"voiceMessage"===b.event){var i=Object.create(tgChatPlayer);i.playButton=$("<button>").addClass("cbh-widget-chat-audio-player__button").html('<i class="cbh-widget-icon-play"></i>'),i.pauseButton=$("<button>").addClass("cbh-widget-chat-audio-player__button").html('<i class="cbh-widget-icon-pause"></i>'),i.currentTime=$("<span>"),i.duration=$("<span>"),i.init(b.filename);var j=$("<div>").addClass("cbh-widget-chat-audio-player").append(i.playButton).append(i.pauseButton).append($("<div>").addClass("cbh-widget-chat-audio-player__status").append(i.currentTime).append($("<span>").html("/")).append(i.duration));$("#cbh_widget_chat_message_"+c).append(j)}this.scrollToBottom(a)},scrollToBottom:function(a){var b=a.hasClass("cbh-hide");a.show();var c=a.findChild(".cbh_widget_chat_messages_wr");c.prop("scrollTop",c.prop("scrollHeight")),b&&a.hide()}},Cobrowsing=Object.create(CBHCore.lib.EventEmitter);Cobrowsing.connect=function(a){if(0!==CBHCore.db_params.cobrowsing){if(a=a||function(){},this.io)return this.main(a);socketIo.connect(this.main.bind(this,a))}},Cobrowsing.main=function(a){if(this.io)return a();this.io=socketIo.io,this.io.on("cbStart",this.handleStart.bind(this)),this.io.on("cbHold",this.handleHold.bind(this)),this.io.on("cbInvalidCode",this.destroySession.bind(this)),this.io.on("cbSecondInstanceError",function(){console.log("Can't connect to cobrowsing session")}),this.io.on("cbNavigate",this.navigateHandler.bind(this)),$(window).on(["resize","scroll"],this.getScrollPos.bind(this)),setInterval(this.checkScrollPos.bind(this),150),this.io.on("cbScroll",this.scrollPosHandler.bind(this)),$(window).on("mousemove",this.getMousePos.bind(this)),setInterval(this.checkMousePos.bind(this),300),this.io.on("cbMouse",this.mousePosHandler.bind(this)),$(window).on("click",this.sendClick.bind(this)),this.io.on("cbClick",this.mouseClickHandler.bind(this)),$("input").on("focus",this.sendFocus.bind(this)),$("textarea").on("focus",this.sendFocus.bind(this)),$("select").on("focus",this.sendFocus.bind(this)),this.io.on("cbFocus",this.focusHandler.bind(this)),$("input").on(["type","keypress","keyup","change","compositionstart","compositionend","cut","paste","blur"],this.sendInputData.bind(this)),$("textarea").on(["type","keypress","keyup","change","compositionstart","compositionend","cut","paste","blur"],this.sendInputData.bind(this)),this.io.on("cbInputData",this.inputDataHandler.bind(this)),a()},Cobrowsing.handleStart=function(){this.active=!0,this.emit("start")},Cobrowsing.handleHold=function(){this.emit("hold")},Cobrowsing.pause=function(){this.active=!1},Cobrowsing.resume=function(){this.active=!0},Cobrowsing.stop=function(){this.active=!1,this.io.emit("cbLeave"),this.destroySession(),this.emit("stop")},Cobrowsing.startSession=function(a){this.connect(function(){var b={code:a,url:window.location.href};this.io.emit("cbJoin",b),this.saveSession(b),this.io.emit("cbGetInitial")}.bind(this))},Cobrowsing.destroySession=function(){this.session={},CBHCore.storage.delete("cobrowsing","session")},Cobrowsing.saveSession=function(a){this.session=this.session||{},Object.keys(a).forEach(function(b){this.session[b]=a[b]}.bind(this)),CBHCore.storage.save("cobrowsing",this.session,"session")},Cobrowsing.resumeSession=function(){this.session=CBHCore.storage.get("cobrowsing","session"),this.session&&this.connect(function(){this.io.emit("cbJoin",this.session),this.session.url!==window.location.href&&(this.io.emit("cbNavigate",window.location.href),this.saveSession({url:window.location.href}))}.bind(this))},Cobrowsing.getCode=function(a){this.connect(function(){this.io.once("cbCode",function(b){this.startSession(b),a(b)}.bind(this)),this.io.emit("cbCreate")}.bind(this))},Cobrowsing.navigateHandler=function(a){this.active&&window.location.href!==a&&(this.saveSession({url:a}),window.location.href=a)},Cobrowsing.getScrollPos=function(){if(this.active)return this.ignoreNextScroll?(this.ignoreNextScroll=!1,!1):void(this.scrollPosToSend=this.getScrollPosition())},Cobrowsing.checkScrollPos=function(){this.active&&this.scrollPosToSend&&(this.io.emit("cbScroll",this.scrollPosToSend),this.scrollPosToSend=null)},Cobrowsing.scrollPosHandler=function(a){if(this.active){this.ignoreNextScroll=!0;var b=this.getScrollPosition(),c=a.top/a.scrollHeight,d=a.left/a.scrollWidth;window.scrollTo(d*b.scrollWidth,c*b.scrollHeight)}},Cobrowsing.getMousePos=function(a){this.active&&(this.mousePosToSend={clientX:a.clientX,clientY:a.clientY})},Cobrowsing.checkMousePos=function(){this.active&&this.mousePosToSend&&(this.mousePosToSend.viewportHeight=window.innerHeight,this.mousePosToSend.viewportWidth=window.innerWidth,this.io.emit("cbMouse",this.mousePosToSend),this.mousePosToSend=null)},Cobrowsing.currentMouses={},Cobrowsing.mousePosHandler=function(a){if(this.active){if(!this.currentMouses[a.user]){var b=$("<div>").addClass("cbh-widget-cobrowsing__pointer").html(this.assets.pointerImage.replace("%color%",a.userColor)),c=$("<div>").addClass("cbh-widget-cobrowsing__pointer_circle").html(this.assets.pointerCircleImage.replace("%color%",a.userColor));$(document.body).append(b),$(document.body).append(c),this.currentMouses[a.user]={pointer:b,circle:c}}this.mousePointerShow(a)}},Cobrowsing.sendClick=function(a){this.active&&(this.clicked||(this.clicked=!0,setTimeout(function(){this.clicked=!1}.bind(this),1e3),this.io.emit("cbClick",{clientX:a.clientX,clientY:a.clientY,viewportHeight:window.innerHeight,viewportWidth:window.innerWidth})))},Cobrowsing.mouseClickHandler=function(a){this.active&&this.currentMouses[a.user]&&(this.mousePointerShow(a),setTimeout(function(){this.currentMouses[a.user].circle.addClass("cbh-pointer-show"),setTimeout(function(){this.currentMouses[a.user].circle.removeClass("cbh-pointer-show")}.bind(this),500)}.bind(this),300))},Cobrowsing.mousePointerShow=function(a){var b=window.innerHeight,c=window.innerWidth,d=a.clientX/a.viewportWidth*c,e=a.clientY/a.viewportHeight*b;this.currentMouses[a.user].pointer.css("display","block"),this.currentMouses[a.user].circle.css("display","block"),this.currentMouses[a.user].pointer.moveTo(d,e),this.currentMouses[a.user].circle.moveTo(d+3,e-11),clearTimeout(this.currentMouses[a.user].timer),this.currentMouses[a.user].timer=setTimeout(function(){this.currentMouses[a.user].pointer.css("display","none"),this.currentMouses[a.user].circle.css("display","none")}.bind(this),15e3)},Cobrowsing.sendFocus=function(a){if(this.active){if(this.ignoreFocus)return void(this.ignoreFocus=!1);var b=pathFinder.getPath(a.target);this.io.emit("cbFocus",b)}},Cobrowsing.focusHandler=function(a){if(this.active){var b=pathFinder.getElement(a);b&&(this.ignoreFocus=!0,b.scrollIntoView(),b.focus())}},Cobrowsing.sendInputData=function(a){if(this.active&&"password"!==a.target.type){var b=$(a.target).val();this.lastInput!==b&&(this.lastInput=b,this.io.emit("cbInputData",{input:b,path:pathFinder.getPath(a.target)}))}},Cobrowsing.inputDataHandler=function(a){if(this.active){var b=pathFinder.getElement(a.path);b&&$(b).val(a.input)}},Cobrowsing.getScrollPosition=function(){var a={};return a.top=window.pageYOffset||document.documentElement.scrollTop,a.left=window.pageXOffset||document.documentElement.scrollLeft,a.scrollHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),a.scrollWidth=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth),a.viewportHeight=window.innerHeight,a.viewportWidth=window.innerWidth,a};var pathFinder={getPath:function(a){for(var b=[];null!=a.parentNode;){for(var c=0,d=0,e=0;e<a.parentNode.childNodes.length;e++){var f=a.parentNode.childNodes[e];f.nodeName===a.nodeName&&(f===a&&(d=c),c++)}c>1?b.unshift([a.nodeName,d]):b.unshift([a.nodeName]),a=a.parentNode}return b},getElement:function(a){for(var b,c=document,d=0;(b=a[d])&&c;){for(var e=0,f=b[1]||0,g=0;g<c.childNodes.length;g++){var h=c.childNodes[g];h.nodeName===b[0]&&(e===f&&(c=h),e++)}d++}return c}};Cobrowsing.assets={},Cobrowsing.assets.pointerImage='<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="1064.7701 445.5539 419.8101 717.0565" enable-background="new 1064.7701 445.5539 419.8101 717.0565" xml:space="preserve" width="20px" height="20px"><polygon fill="%color%" stroke="#231F20" stroke-width="30" stroke-linecap="round" stroke-linejoin="round" points="1283.1857,1127.3097 1406.1421,1077.6322 1314.2406,850.1678 1463.913,852.7823 1093.4828,480.8547 1085.4374,1005.6964 1191.2842,899.8454 "/></svg>',Cobrowsing.assets.pointerCircleImage='<?xml version="1.0" encoding="utf-8"?><svg viewBox="0 0 120 120" version="1.1" xmlns="http://www.w3.org/2000/svg"><circle cx="60" cy="60" r="50" fill="none" stroke="%color%" stroke-width="10px" /></svg>';var showNamedPlankDialog=function(a){plankDialogs[a]()},PlankDialogs=function(){var a,b=doc.getElementById("cbh_plank"),c=$(b),d=$("body"),e=$("#clbh_div"),f=this;$(win).on("mouseout",function(a){a.clientY<0&&f.show()}),c.on("mouseout",function(a){for(var b=a.toElement||a.relatedTarget;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this)return b.preventDefault&&b.preventDefault(),!1;b=b.parentNode}f.hide()});var g=function(a,d,e){if(b){var f=CBHCore.helpers.extend({},d);if(b.innerHTML=tpl["plank_"+a](f),h(),cbh_glob.widget_show_reason=5,"dialog"===a&&void 0!==e){var g=i(e);c.findChild(".cbh-plank-form-line").append(g)}}},h=function(){void 0!==a&&a||(a=doc.createElement("div"),a.className="cbh-powered-by",a.innerHTML=CBHCore.helpers.compilePoweredBy("powered_by")),b.appendChild(a)},i=function(a){a=a||[];var b=$("<div>").addClass("cbh-form");return a.forEach(function(a){if(a){var c;switch(a.type){case"button":c=$("<button>").addClass("cbh-btn").html(a.text),CBHCore.helpers.isFunction(a.action)&&c.on("click",function(){a.action.apply(this)});break;case"url":a.url||(a.url="#"),c=$("<a>").html(a.text).attr("href",a.url).attr("target","_blank"),CBHCore.helpers.isFunction(a.action)&&c.on("click",function(b){return b.preventDefault(),a.action.apply(this),!1});break;case"text":c=$("<input>").attr({id:a.id,type:"text",name:a.name}),a.value?c.val(a.value):c.val("");break;case"countdown":c=$("<span>").addClass("cbh-countdown").addClass("cbh-hide");break;case"select":c=$("<select>");var d=document.createDocumentFragment();a.options.forEach(function(a){var b=$("<option>").html(a.text).val(a.value);a.selected&&b.attr("selected",a.selected),d.appendChild(b.elements[0])}),c.append(d),CBHCore.helpers.isFunction(a.onchange)&&c.on("change",function(){a.onchange.apply(this)})}a.className&&c.addClass(a.className),a.id&&c.attr({id:a.id}),b.append(c)}}),b};this.show=function(){"plank"===CBHCore.db_params.catch_method&&"worktime"===cbh_glob.widget_mode&&(e.removeClass("cbh-show-popup"),d.addClass("cbh-plank"))},this.hide=function(){d.removeClass("cbh-plank")},this.rate=function(){g("rate"),$("#cbh_plank_rate").on("click",function(){f.call()})},this.call=function(a){g("call",{header:__("plank.call_now")});var b=CBHCore.helpers.extend({countdownContainer:"cbh_plank_countdown_container",errorCallback:function(){},successCallback:afterCallAction,afterCall:function(){f.callResult()}},a),c=$("#cbh_plank_call_btn"),d=function(){c.elements[0].style.display="none",b.phone=$("#cbh_plank_phone_input").val(),sliderCallback(b)};if(CBHCore.db_params.enable_masks){var e=CBHCore.helpers.empty,h=cbh_glob.h_params,i=!(e(h.country_call_binding,h.fixed_country)||!h.fixed_country)&&h.country_call_binding;new Masked({selector:"#cbh_plank_phone_input",country:CBHCore.db_params.iso_code,phone:CBHCore.user.client_phone||CBHCore.getDefaultPhoneCode()||"",one_country:!e(h.fixed_country)&&h.fixed_country,country_binding:i,show_validation_errors:!0,onSend:d})}c.on("click",function(a){if(a.stopPropagation(),CBHCore.db_params.enable_masks){var b=Masked.getById("cbh_plank_phone_input");Masked.validationErrors(b.opt.element,function(){d()})}else d()})},this.callResult=function(){if(CBHCore.helpers.freeMode()||void 0!==cbh_glob.h_params.disable_call_result&&1==cbh_glob.h_params.disable_call_result)return void plankDialogs.askUserInfo(f.callSuccess);g("dialog",{header:__("call.question")},[{type:"button",className:"cbh-yes",text:__("buttons.yes"),action:function(){f.askUserInfo(f.callSuccess)}},{type:"button",className:"cbh-no",text:__("buttons.no"),action:function(){f.callFail()}}])},this.callFail=function(){g("dialog",{header:__("call.fail")},[{type:"button",text:__("buttons.ok"),action:function(){f.hide(),f.rate()}}])},this.callSuccess=function(){var a=[];!CBHCore.helpers.isValidURL(comments_url)||void 0!==cbh_glob.h_params.disable_social_links&&1==cbh_glob.h_params.disable_social_links||a.push({type:"url",className:"cbh-btn",text:__("feedback"),url:comments_url}),a.push({type:"button",text:__("buttons.close"),action:function(){f.hide(),f.rate()}}),g("dialog",{header:__(CBHCore.helpers.freeMode()?"call.share_free":"call.share")},a)},this.askUserInfo=function(a){CBHCore.user.email?CBHCore.user.name?a():f.changeName(a):f.changeEmail(function(){CBHCore.user.name?a():f.changeName(a)})},this.changeName=function(a){CBHCore.helpers.isFunction(a)||(a=f.call),g("dialog",{header:__("changeName.header")},[{type:"text",id:"cbh_plank_name_input",text:__("feedback"),value:CBHCore.user.name||""},{type:"button",className:"cbh-yes cbh-widget-call__btn_symb",text:"",action:function(){var b=$("#cbh_plank_name_input").val();b&&CBHCore.helpers.saveName(b),a()}},{type:"button",className:"cbh-no cbh-widget-call__btn_symb",text:"",action:function(){a()}}])},this.changeEmail=function(a){CBHCore.helpers.isFunction(a)||(a=f.call),g("dialog",{header:__(void 0!==cbh_glob.h_params.deny_email_client_with_record&&1==cbh_glob.h_params.deny_email_client_with_record||CBHCore.helpers.freeMode()?"changeEmail.header-no-record":"changeEmail.header")},[{type:"text",id:"cbh_plank_email_input",text:__("feedback"),value:CBHCore.user.email||""},{type:"button",className:"cbh-yes cbh-widget-call__btn_symb",text:"",action:function(){var b=$("#cbh_plank_email_input").val();b&&CBHCore.helpers.saveEmail(b),a()}},{type:"button",className:"cbh-no cbh-widget-call__btn_symb",text:"",action:function(){a()}}])},f.rate()},showNamedPopupDialog=function(a){popupDialogs[a]()},popupDialogs={renderDialogContents:function(a,b){var c=CBHCore.helpers.extend({force:!1,show_reason:1,title:"",desc:""},a);if(win.location.hash&&"autocallback-ok"===win.location.hash.substring(1)&&(c.force=!0),c.force||"popup"===CBHCore.db_params.catch_method){var d=$("#cbh_widget_body");d.findChild(".cbh-user-content").remove();var e=$(tpl.popup_dialog(c)),f=this.createForm(b);e.findChild(".cbh-form-line").append(f),d.append(e),d.findChild(".cbh-user-content").addClass("cbh-show-slide"),popupDialogs.showDialog(c.show_reason)}},createForm:function(a){a=a||[];var b=$("<div>").addClass("cbh-form");return a.forEach(function(a){if(a){var c;switch(a.type){case"button":c=$("<button>").addClass("cbh-btn").html(a.text),CBHCore.helpers.isFunction(a.action)&&c.on("click",function(b){b.stopPropagation(),a.action.apply(this)});break;case"url":a.url||(a.url="#"),c=$("<a>").html(a.text).attr("href",a.url).attr("target","_blank"),CBHCore.helpers.isFunction(a.action)&&c.on("click",function(b){return b.preventDefault(),a.action.apply(this),!1});break;case"email":case"text":c=$("<input>").attr({type:a.type}),a.id&&c.attr({id:a.id}),a.name&&c.attr({name:a.name}),c.val(a.value||"");break;case"countdown":c=$("<span>").addClass("cbh-countdown").addClass("cbh-hide");break;case"select":c=$("<select>");var d=document.createDocumentFragment();a.options.forEach(function(a){var b=$("<option>").html(a.text).val(a.value);a.selected&&b.attr("selected",a.selected),d.appendChild(b.elements[0])}),c.append(d),CBHCore.helpers.isFunction(a.onchange)&&c.on("change",function(){a.onchange.apply(this)})}a.className&&c.addClass(a.className),a.id&&c.attr({id:a.id}),b.append(c)}}),b},showDialog:function(a){sendShowWidget(),sendGaEvent("send","event","Callbackhunter_OPEN","clicked"),sendYaMetrikaEvent("Callbackhunter_OPEN");var b=$("#clbh_div");b.hasClass("cbh-show-popup")||(movePopupToButton(),clearTimeout(cbh_glob.dialog_timer),cbh_glob.widget_show_reason=a,b.addClass("cbh-show-popup"),helpers.getCursorFollower().stop(),helpers.getCursorFollower().jumpToMouse(),setTimeout(function(){helpers.getCursorFollower().start()},2e3),hidePhoneIcon(),setShowCookie())},showWidgetExit:function(a){if(a||!(unitExpanded||userCaught||cbh_glob.block_auto_popup)){var b=CBHCore.helpers.getTimeFromStart();popupDialogs.renderDialogContents({show_reason:3,title:__("popup.enter.title",{min:b[0],sec:b[1]}),desc:__("popup.enter.text")},[{type:"button",className:"cbh-btn-light",text:__("buttons.yes"),action:function(){popupDialogs.showSimpleDialog()}},{type:"button",className:"cbh-btn-light",text:__("buttons.no"),action:function(){popupDialogs.showSimpleDialog()}}]),userCaught=!0}},showWidgetEnter:function(a){if(a||!(unitExpanded||userCaught||cbh_glob.block_auto_popup)){var b=CBHCore.helpers.getTimeFromStart();popupDialogs.renderDialogContents({show_reason:2,title:__("popup.enter.title",{min:b[0],sec:b[1]}),desc:__("popup.enter.text")},[{type:"button",className:"cbh-btn-light",text:__("buttons.yes"),action:function(){popupDialogs.showSimpleDialog()}},{type:"button",className:"cbh-btn-light",text:__("buttons.no"),action:function(){popupDialogs.showSimpleDialog()}}]),userCaught=!0}},showSimpleDialog:function(a,b){var c=void 0!==a?a.phone||CBHCore.getDefaultPhoneCode():"",d=void 0!==a&&a.deferred;if("worktime"!==cbh_glob.widget_mode&&!d)return void popupDialogs.callLater(c);var e="";e=CBHCore.helpers.freeMode()?__("popup.free.title"):d?__("popup.deferred_input_phone.title"):__("popup.worktime.title",{countdown:cbh_glob.countdown});var f=CBHCore.helpers.extend({fromPopup:!0,errorCallback:wrongNumberErrorPopup,successCallback:afterCallAction,afterCall:function(){popupDialogs.callResult()}},a);if(popupDialogs.renderDialogContents({force:b,title:e,desc:__("popup.worktime.text")},[{type:"text",value:c,id:"cbh_popup_phone_input"},{type:"button",id:"cbh_popup_call_button",text:__("buttons.call_me"),action:function(){f.phone=$("#cbh_popup_phone_input").val();var b=function(){if(show_office_choice)return void popupDialogs.showOfficeChoice(f);if(d)f.errorCallback=wrongNumberErrorPopup,f.successCallback=popupDialogs.callLaterResultProxy,f.night_time=a.night_time,f.day=a.day,f.hour=a.hour;else{if(f.countdownObj.running)return;doc.getElementById("cbh_popup_call_button").style.display="none",$("#cbh_popup_choose_time").hide(),$(Object.keys(f.countdownObj.elems).map(function(a){return f.countdownObj.elems[a]})).show()}return!0};if(CBHCore.db_params.enable_masks){var c=Masked.getById("cbh_popup_phone_input");Masked.validationErrors(c.opt.element,function(){b()&&sliderCallback(f)})}else{if(!CBHCore.helpers.isValidPhone(f.phone)){var e={phone:f.phone,deferred:d};return d&&(e.night_time=a.night_time,e.day=a.day,e.hour=a.hour),void wrongNumberErrorPopup(e)}b()&&sliderCallback(f)}}},{type:"countdown",id:"cbh_popup_countdown_container"},!d&&{type:"url",id:"cbh_popup_choose_time",text:__("popup.worktime.choose_time"),className:"cbh-detail",action:function(){if(!f.countdownObj.running){var a=$("#cbh_popup_phone_input").val();popupDialogs.callLater(a)}}}]),CBHCore.db_params.enable_masks){var g=CBHCore.helpers.empty,h=cbh_glob.h_params,i=!(g(h.country_call_binding,h.fixed_country)||!h.fixed_country)&&h.country_call_binding;new Masked({selector:"#cbh_popup_phone_input",country:CBHCore.db_params.iso_code,phone:c||CBHCore.user.client_phone||"",one_country:!g(h.fixed_country)&&h.fixed_country,country_binding:i,show_validation_errors:!0,onSend:function(){f.phone=$("#cbh_popup_phone_input").val(),sliderCallback(f)}})}f.countdownObj=new Countdown({elemId:"cbh_popup_countdown_container",time:1e3*cbh_glob.countdown,template:"%minutes%:%seconds%:%ms%"}),autoCallback(f)},showOfficeChoice:function(a,b){var c,d=helpers.getOfficeList(b);if($("#cbh_widget_body").findChild(".cbh-title").html(__("select_office")),$("#cbh_popup_office_select").css("border-color","initial!important"),!d.length&&CBHCore.params.hasCustomOffices||!CBHCore.params.hasCustomOffices&&b){var e={fromPopup:!0,deferred:!1,phone:a.phone,office:$("#cbh_popup_office_select").val()};return cbh_glob.strict_office_choice&&"0"==e.office?($("#cbh_popup_office_select").css("border-color","red!important"),void $("#cbh_widget_body").findChild(".cbh-title").html(__("clbh_stat_choose_office"))):(doc.getElementById("cbh_call_btn").style.display="none",$("#cbh_popup_choose_time").hide(),a.deferred?(e.deferred=a.deferred,e.night_time=a.night_time,e.day=a.day,e.hour=a.hour,e.successCallback=popupDialogs.callLaterResultProxy):(c=new Countdown({elemId:"cbh_popup_countdown_container",time:1e3*cbh_glob.countdown,template:"%minutes%:%seconds%:%ms%"}),e.countdownObj=c,e.successCallback=afterCallAction,e.afterCall=function(){popupDialogs.callResult()},$(Object.keys(c.elems).map(function(a){return c.elems[a]})).show()),void sliderCallback(e))}if(d.length){var f=CBHCore.offices.getNextActionName(b);popupDialogs.renderDialogContents({title:f||__("select_office"),desc:""},[{type:"select",options:d.map(function(a){return{text:a.name,value:a.id}}),id:"cbh_popup_office_select",onchange:function(){var b=$("#cbh_popup_office_select"),c=b.val();CBHCore.offices.isParent(c)&&popupDialogs.showOfficeChoice(a,c)}},{type:"button",text:__("buttons.call_me"),id:"cbh_call_btn",action:function(){popupDialogs.showOfficeChoice(a,$("#cbh_popup_office_select").val())}},{type:"countdown",id:"cbh_popup_countdown_container"}])}},callLater:function(a){var b=helpers.generateDaySelects(),c=helpers.generateHourSelects();popupDialogs.renderDialogContents({title:__("worktime"===cbh_glob.widget_mode?"popup.choose_time.title":"popup.choose_time.title_night"),desc:__("worktime"===cbh_glob.widget_mode?"popup.choose_time.text":"popup.choose_time.text_night")},[{type:"select",options:b.data,id:"cbh_popup_day_select",onchange:function(){var a=helpers.generateHourSelects($(this).val()),b=document.createDocumentFragment();a.data.forEach(function(a){var c=$("<option>").html(a.text).val(a.value);a.selected&&c.attr("selected",a.selected),b.appendChild(c.elements[0])}),$("#cbh_popup_hour_select").html("").append(b)}},{type:"select",id:"cbh_popup_hour_select",options:c.data},{type:"button",text:__("buttons.call_me"),action:function(){var b=$("#cbh_popup_day_select").elements[0],c=$("#cbh_popup_hour_select").elements[0];if(!CBHCore.helpers.isValidPhone(a))return void popupDialogs.showSimpleDialog({deferred:!0,night_time:$("#cbh_popup_hour_select").val(),day:b.options[b.selectedIndex].text,hour:c.options[c.selectedIndex].text});sliderCallback({fromPopup:!0,deferred:!0,phone:a,night_time:$("#cbh_popup_hour_select").val(),day:b.options[b.selectedIndex].text,hour:c.options[c.selectedIndex].text,errorCallback:wrongNumberErrorPopup,successCallback:popupDialogs.callLaterResultProxy})}}])},callLaterResultProxy:function(a){if(void 0!==cbh_glob.h_params.ask_user_info_after_deferred_call&&1==cbh_glob.h_params.ask_user_info_after_deferred_call)return void popupDialogs.askUserInfo(popupDialogs.callLaterResult.bind(popupDialogs,a));popupDialogs.callLaterResult(a)},callLaterResult:function(a){var b=[];!CBHCore.helpers.isValidURL(comments_url)||void 0!==cbh_glob.h_params.disable_social_links&&1==cbh_glob.h_params.disable_social_links||b.push({type:"url",className:"cbh-btn",text:__("feedback"),url:comments_url}),b.push({type:"button",className:"cbh-btn-light",text:__("buttons.close"),action:function(){hideDialog()}}),popupDialogs.renderDialogContents({title:__("popup.deferred_call_success.title"),desc:__("popup.deferred_call_success.text",{day:a.day.toLowerCase(),hour:a.hour})},b)},callResult:function(){if(CBHCore.helpers.freeMode()||void 0!==cbh_glob.h_params.disable_call_result&&1==cbh_glob.h_params.disable_call_result)return void popupDialogs.askUserInfo(popupDialogs.callSuccess);popupDialogs.renderDialogContents({title:__("call.question")},[{type:"button",text:__("buttons.yes"),action:function(){popupDialogs.askUserInfo(popupDialogs.callSuccess)}},{type:"button",className:"cbh-btn-light",text:__("buttons.no"),action:function(){popupDialogs.callFail()}}])},callFail:function(){popupDialogs.renderDialogContents({title:__("call.fail")},[{type:"button",className:"cbh-btn-light",text:__("buttons.ok"),action:function(){hideDialog()}}])},callSuccess:function(){var a=[];!CBHCore.helpers.isValidURL(comments_url)||void 0!==cbh_glob.h_params.disable_social_links&&1==cbh_glob.h_params.disable_social_links||a.push({type:"url",className:"cbh-btn",text:__("feedback"),url:comments_url}),a.push({type:"button",className:"cbh-btn-light",text:__("buttons.close"),action:function(){hideDialog()}}),popupDialogs.renderDialogContents({title:__("call.success"),desc:__("call.share")},a)},askUserInfo:function(a){CBHCore.user.email?CBHCore.user.name?a():popupDialogs.changeName(a):popupDialogs.changeEmail(function(){CBHCore.user.name?a():popupDialogs.changeName(a)})},changeName:function(a){CBHCore.helpers.isFunction(a)||(a=popupDialogs.showSimpleDialog),popupDialogs.renderDialogContents({title:__("changeName.header")},[{type:"text",id:"cbh_popup_name_input",className:"cbh-big-input",text:__("feedback"),value:CBHCore.user.name||""},{type:"button",text:__("buttons.ok"),action:function(){var b=$("#cbh_popup_name_input").val();b&&CBHCore.helpers.saveName(b),a()}},{type:"button",text:__("buttons.no_thanks"),action:function(){a()}}])},changeEmail:function(a){CBHCore.helpers.isFunction(a)||(a=popupDialogs.showSimpleDialog),popupDialogs.renderDialogContents({title:__(void 0!==cbh_glob.h_params.deny_email_client_with_record&&1==cbh_glob.h_params.deny_email_client_with_record||CBHCore.helpers.freeMode()?"changeEmail.header-no-record":"changeEmail.header")},[{type:"email",id:"cbh_popup_email_input",className:"cbh-big-input",text:__("feedback"),value:CBHCore.user.email||""},{type:"button",text:__("buttons.ok"),action:function(){var b=$("#cbh_popup_email_input").val();b&&CBHCore.helpers.saveEmail(b),a()}},{type:"button",text:__("buttons.no_thanks"),action:function(){a()}}])}},SlideDialogs=function(a){var b=CBHCore.helpers.extend({text:"",textSize:null,image:null,countdown:10},a);if(!(CBHCore.helpers.empty(b.text)||CBHCore.helpers.empty(b.image)||b.countdown<=0)){var c,d,e,f,g=$(".cbh-widget-slide"),h=b.countdown,i=!1,j=this;this.init=function(){g.html(tpl.slider_slide()),d=$(".cbh-widget-slide-text"),c=g.findChild(".cbh-widget-slide-content"),$(".cbh-widget-slide__open").on("click",function(a){a.preventDefault(),j.show()}),$(".cbh-widget-slide__close").on("click",function(a){a.preventDefault(),j.hide()}),j.setText(b.text),j.setTextSize(b.textSize),j.setImage(b.image),f=setInterval(function(){(new cbh_glob.StrongDate).getTime()-cbh_glob.activity_last_ts<=2e3&&(h-=2),CBHCore.storage.save("slide_countdown",h,"session"),h<=0&&(clearInterval(f),g.addClass("cbh-widget-slide-timer-finished"),i||j.show())},2e3)},this.show=function(){i=!0,g.removeClass("cbh-widget-slide_closed"),setTimeout(function(){c.addClass("cbh-show")},50),setTimeout(function(){c.addClass("cbh-overflow-auto")},500)},this.hide=function(){c.removeClass("cbh-show cbh-overflow-auto"),setTimeout(function(){g.addClass("cbh-widget-slide_closed")},400)},this.setText=function(a){d.html(a)},this.setTextSize=function(a){a&&d.css("font-size",a+"px")},this.setImage=function(a){a&&(e||(e=doc.createElement("img"),$(".cbh-widget-slide-image").append(e)),e.src="//"+CBHCore.opt.static_domain+"/uploads/slide_image/"+a)},this.init()}},sliderDialogs={showDialog:function(a){var b=doc.getElementById("cbh_widget_call_container");b&&(b.innerHTML=a)},main:function(a){var b=a||{},c=helpers.shortUserName()||"",d="";d=CBHCore.helpers.freeMode()?__("header.free",{name:c?'<a href="#" class="cbh-dialog-action-link" id="cbh_dialog_name">'+c+".</a> ":"",you:c?__("header.you"):'<a href="#" class="cbh-dialog-action-link" id="cbh_dialog_name">'+__("header.you")+"</a> "}):"worktime"===cbh_glob.widget_mode?__("header.worktime",{countdown:cbh_glob.countdown,countdownFull:helpers.formatSecToMin(cbh_glob.countdown),name:c?'<a href="#" class="cbh-dialog-action-link" id="cbh_dialog_name">'+c+".</a> ":"",you:c?__("header.you"):'<a href="#" class="cbh-dialog-action-link" id="cbh_dialog_name">'+__("header.you")+"</a> "}):__("header.nighttime",{day:'<a href="#" class="cbh-dialog-action-link" id="cbh_dialog_day">'+renderDay(new cbh_glob.StrongDate(+cbh_glob.schedule.getNextWorkingDay())).toLowerCase()+"</a>"});var e;e=void 0!==b.phone&&b.phone.length>0?b.phone:CBHCore.user.client_phone?CBHCore.user.client_phone:CBHCore.getDefaultPhoneCode(),sliderDialogs.showDialog(tpl.slider_call_main({client_phone:e||"",header:d}));var f=$(".cbh-widget-call__container-select"),g=CBHCore.helpers.empty,h=cbh_glob.h_params,i=!(g(h.country_call_binding,h.fixed_country)||!h.fixed_country)&&h.country_call_binding;CBHCore.db_params.enable_masks&&new Masked({selector:"#cbh_slider_phone_input",country:CBHCore.db_params.iso_code,phone:e||"",one_country:!g(h.fixed_country)&&h.fixed_country,country_binding:i,show_validation_errors:!0,onSend:function(){j()},onToggleList:function(a){"opened"===a?f.addClass("cbh-open"):f.removeClass("cbh-open")}}),$("#cbh_slider_call_btn").on("click",function(a){if(a.preventDefault(),a.stopPropagation(),CBHCore.db_params.enable_masks){var b=Masked.getById("cbh_slider_phone_input");Masked.validationErrors(b.opt.element,function(){j()})}else j()});var j=function(){cbh_glob.widget_show_reason=1,b.phone=$("#cbh_slider_phone_input").val(),b.countdownContainer="cbh_slider_countdown_container",b.afterCall=function(){sliderDialogs.callResult()},b.errorCallback=wrongNumberErrorSlider,b.successCallback=function(a){CBHCore.helpers.freeMode()||$("#cbh_slider_call_btn").css({
display:"none!important"}),afterCallAction(a)},"worktime"===cbh_glob.widget_mode||b.night_time?sliderCallback(b):sliderDialogs.deferred(b.phone)};$("#cbh_dialog_name").on("click",function(a){a.preventDefault(),sliderDialogs.changeName()}),"worktime"!==cbh_glob.widget_mode&&$("#cbh_dialog_day").on("click",function(a){a.preventDefault(),cbh_glob.widget_show_reason=1,sliderDialogs.deferred($("#cbh_slider_phone_input").val())})},deferredSuccessProxy:function(a){if(void 0!==cbh_glob.h_params.ask_user_info_after_deferred_call&&1==cbh_glob.h_params.ask_user_info_after_deferred_call)return void sliderDialogs.askUserInfo(sliderDialogs.deferredSuccess.bind(sliderDialogs,a));sliderDialogs.deferredSuccess(a)},deferredSuccess:function(a){if(!a.day||!a.hour)return void sliderDialogs.main();sliderDialogs.showDialog(tpl.slider_deferred_success({day:a.day.toLowerCase(),hour:a.hour})),$("#cbh_slider_call_btn").on("click",function(){sliderDialogs.main()})},callSuccess:function(){if(void 0!==cbh_glob.h_params.disable_social_links&&1==cbh_glob.h_params.disable_social_links||void 0===comments_url||!CBHCore.helpers.isValidURL(comments_url))return void sliderDialogs.main();sliderDialogs.showDialog(tpl.slider_call_success({header:__(CBHCore.helpers.freeMode()?"call.share_free":"call.share_short"),comments_url:comments_url})),$("#cbh_social_tw").on("click",function(a){a.preventDefault(),socialLikes.popupTwitterShare(sociallike_url)}),$("#cbh_social_vk").on("click",function(a){a.preventDefault(),socialLikes.popupVKShare(sociallike_url)}),$("#cbh_social_fb").on("click",function(a){a.preventDefault(),socialLikes.popupFacebookShare(sociallike_url)}),$("#cbh_slider_call_btn").on("click",function(){sliderDialogs.main()})},callFail:function(){sliderDialogs.showDialog(tpl.slider_call_fail()),$("#cbh_slider_call_btn").on("click",function(){sliderDialogs.main()})},callResult:function(){if(CBHCore.helpers.freeMode()||void 0!==cbh_glob.h_params.disable_call_result&&1==cbh_glob.h_params.disable_call_result)return void sliderDialogs.askUserInfo(sliderDialogs.callSuccess);sliderDialogs.showDialog(tpl.slider_call_result());var a=$(".cbh-widget-call__btn-area");a.findChild(".cbh-yes").on("click",function(){sliderDialogs.askUserInfo(sliderDialogs.callSuccess)}),a.findChild(".cbh-no").on("click",function(){sliderDialogs.callFail()})},deferred:function(a){var b=function(a){var b=$("#cbh_slider_select_hour_dropdown"),d=helpers.generateHourSelectsForSlider(a);return b.findChild(".cbh-select-results").html(d.html),$("#cbh_slider_select_hour").findChild(".cbh-select-selection__rendered").html(d.firstName),b.css("top",Math.max(-200,-35*d.count)+"px"),b.findChild(".cbh-select-results__option").on("click",function(){c("#cbh_slider_select_hour"),$("#cbh_slider_select_hour").findChild(".cbh-select-selection__rendered").html($(this).html()),$("#cbh_time_deferred").val($(this).attr("data-value"))}),d.firstVal},c=function(a,b){var c=b||$(a);c.hasClass("cbh-select-container--open")?$(a+"_dropdown").css("display","none;"):$(a+"_dropdown").css("display",""),c.toggleClass("cbh-select-container--open")},d=helpers.generateDaySelectsForSlider();sliderDialogs.showDialog(tpl.slider_call_selecttime({day:d.firstName,day_select:d.html})),$("#cbh_slider_call_deferred_btn").on("click",function(){var b={phone:a,deferred:!0,night_time:$("#cbh_time_deferred").val(),day:$("#cbh_slider_select_day").findChild(".cbh-select-selection__rendered").html(),hour:$("#cbh_slider_select_hour").findChild(".cbh-select-selection__rendered").html()};CBHCore.helpers.isValidPhone(a)?(b.countdownContainer="cbh_slider_countdown_container",b.afterCall=function(){sliderDialogs.callResult()},b.errorCallback=wrongNumberErrorSlider,b.successCallback=sliderDialogs.deferredSuccessProxy,sliderCallback(b)):sliderDialogs.main(b)}),["#cbh_slider_select_day","#cbh_slider_select_hour"].forEach(function(a){var b=$(a);b.on("click",function(){c(a,b)})}),$("#cbh_slider_select_day_dropdown").findChild(".cbh-select-results__option").on("click",function(){c("#cbh_slider_select_day"),$(this).parent().findChild(".cbh-select-results__option--selected").toggleClass("cbh-select-results__option--selected"),$(this).toggleClass("cbh-select-results__option--selected"),$("#cbh_slider_select_day").findChild(".cbh-select-selection__rendered").html($(this).html()),b($(this).attr("data-value"))}),$("#cbh_time_deferred").val(b())},askUserInfo:function(a){CBHCore.user.email?CBHCore.user.name?a():sliderDialogs.changeName(a):sliderDialogs.changeEmail(function(){CBHCore.user.name?a():sliderDialogs.changeName(a)})},changeName:function(a){CBHCore.helpers.isFunction(a)||(a=sliderDialogs.main),sliderDialogs.showDialog(tpl.slider_change_name({name:CBHCore.user.name||""}));var b=function(){var b=$("#cbh_slider_name_input").val();b&&CBHCore.helpers.saveName(b),a()};$("#cbh_slider_name_input").on("keydown",function(a){13==a.keyCode&&b()});var c=$(".cbh-widget-call__btn-area");c.findChild(".cbh-yes").on("click",b),c.findChild(".cbh-no").on("click",function(){a()})},changeEmail:function(a){CBHCore.helpers.isFunction(a)||(a=sliderDialogs.main),sliderDialogs.showDialog(tpl.slider_change_email({email:CBHCore.user.email||"",header:__(void 0!==cbh_glob.h_params.deny_email_client_with_record&&1==cbh_glob.h_params.deny_email_client_with_record||CBHCore.helpers.freeMode()?"changeEmail.header-no-record":"changeEmail.header")}));var b=$(".cbh-widget-call__btn-area");b.findChild(".cbh-yes").on("click",function(){var b=$("#cbh_slider_email_input").val();b&&CBHCore.helpers.saveEmail(b),a()}),b.findChild(".cbh-no").on("click",function(){a()})},showOfficeChoice:function(a,b){sliderDialogs.showDialog(tpl.slider_call_office_choice({name:CBHCore.user.name||""}));var c=CBHCore.offices.getById(b),d=helpers.getOfficeList(c.id),e=CBHSelect({id:"cbh_office_id",selector:"#cbh_select_placeholder",data:d.map(function(a){return{text:a.name,value:a.id}}),onchange:function(b){CBHCore.offices.isParent(b)&&sliderDialogs.showOfficeChoice(a,b)}}),f=CBHCore.offices.getNextActionName(c.id)?CBHCore.offices.getNextActionName(c.id):__("select_office");$(".cbh-widget-call__select-wr").findChild(".cbh-select-selection__rendered").html(f),$("#cbh_slider_call_btn").on("click",function(){if(a.office=$("#cbh_office_id").val(),cbh_glob.strict_office_choice&&!e.selectionDone())return $("#cbh_widget_call_container").findChild(".cbh-select-selection").css("border-color","red!important"),void $("#cbh_select_office_title").html(__("clbh_stat_choose_office"));"worktime"!==cbh_glob.widget_mode?(a.deferred=!0,a.successCallback=sliderDialogs.deferredSuccessProxy):(a.successCallback=function(a){CBHCore.helpers.freeMode()||$("#cbh_slider_call_btn").css({display:"none!important"}),afterCallAction(a)},a.afterCall=function(){sliderDialogs.callResult()}),sliderDialogs.main(a),a.countdownContainer="cbh_slider_countdown_container",a.phone=$("#cbh_slider_phone_input").val(),a.errorCallback=wrongNumberErrorSlider,sliderCallback(a)})}},showNamedSliderDialog=function(a){sliderDialogs[a]()},CBHEvents=CBHCore.helpers.extend(CBHCore.CBHEvents,{widgetTgMessageSent:function(a){},widgetQuestionAsked:function(a){sendGaEvent("send","event","Callbackhunter_EMAIL","clicked"),sendYaMetrikaEvent("Callbackhunter_EMAIL")}}),sweetyExtensions={show:function(){return this.addClass("cbh-show"),this.removeClass("cbh-hide"),this},hide:function(){return this.addClass("cbh-hide"),this.removeClass("cbh-show"),this},isWindow:function(a){return null!=a&&a===a.window},add:function(a){return this.elements=this.elements.concat($(a).elements),this},getStyle:function(a){var b=window.getComputedStyle(this.elements[0]);return!!b&&b.getPropertyValue(a)},focus:function(){return this.elements[0]&&this.elements[0].focus(),this},find:function(a){var b=a.substr(0,1),c=a.substr(1),d=[];return this.elements.forEach(function(a){switch(b){case".":-1!==a.className.split(" ").indexOf(c)&&d.push(a);break;case"#":a.id==c&&d.push(a);break;case"@":a.name==c&&d.push(a);break;default:a.tagName==c.toUpperCase()&&d.push(a)}}.bind(this)),$(d)},translate3d:function(){var a=["transform","msTransform","webkitTransform","mozTransform","oTransform"],b=function(a){for(var b=0;b<a.length;b++)if(void 0!==document.body.style[a[b]])return a[b];return null}(a);return b?function(a,c,d){var e=a||0,f=c||0,g=d||0;this.elements[0].style[b]="translate3d("+e+"px, "+f+"px, "+g+"px)"}:function(){}}(),moveTo:function(a,b){var c=window.getComputedStyle(this.elements[0]),d={top:parseInt(c.top,10),left:parseInt(c.left,10)};this.translate3d(a-d.left,b-d.top)}};!function(){var a=[];"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(b){a["[object "+b+"]"]=b.toLowerCase()});var b={Height:"height",Width:"width"};for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e={padding:"inner"+c,content:d,"":"outer"+c};for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];!function(a,b,c,d){sweetyExtensions[b]=function(e,f){var g=arguments.length&&(a||"boolean"!=typeof e);return h(this.elements,function(a,d,e){var f;return sweetyExtensions.isWindow(a)?0===b.indexOf("outer")?a["inner"+c]:a.document.documentElement["client"+c]:9===a.nodeType?(f=a.documentElement,Math.max(a.body["scroll"+c],f["scroll"+c],a.body["offset"+c],f["offset"+c],f["client"+c])):void 0===e?parseFloat($(a).getStyle(d)):$(a).addStyle(d,e)},d,g?e:void 0,g)}}(f,g,c,d)}}var h=function(b,c,d,e,f,g,i){var j=0,k=b.length,l=null==d;if("object"===function(b){return null==b?b+"":"object"==typeof b||"function"==typeof b?a[toString.call(b)]||"object":typeof b}(d)){f=!0;for(j in d)d.hasOwnProperty(j)&&h(b,c,j,d[j],!0,g,i)}else if(void 0!==e&&(f=!0,isFunction(e)||(i=!0),l&&(i?(c.call(b,e),c=null):(l=c,c=function(a,b,c){return l.call($(a),c)})),c))for(;j<k;j++)c(b[j],d,i?e:e.call(b[j],j,c(b[j],d)));return f?b:l?c.call(b):k?c(b[0],d):g}}();var fbchat={inited:!1,num:0,started:!1,init:function(){this.inited||(this.inited=!0,fbChat.on("secondInstanceError",function(){$("#cbh_widget_chat_error").html(__("tgChat.errors.secondInstance")).show(),this.started=!0}.bind(this)),fbChat.on("chats",this.createChats.bind(this)),fbChat.loadState(),(!fbChat.state||+new StrongDate-+fbChat.lastMessage.time>864e5)&&1==CBHCore.db_params.tg_chat_greeting&&setTimeout(this.greeting.bind(this),1e3*CBHCore.db_params.tg_chat_greeting_delay))},createChats:function(a){Object.keys(a).forEach(function(c){var d=a[c],e=$("<div></div>").addClass("cbh-widget-chat__chat-sub").addClass("cbh-hide").attr("id","cbh_widget_chat__chat_sub_"+c);e.html(tpl.slider_chat()),0!=c&&($("#cbh_widget_chat_offices").show(),$("#cbh_widget_chat_offices_select").append($("<option>").attr("value",c).html(d.state.meta.name))),d.on("message",this.renderChatMessage.bind(this,e)),d.on("message",function(){this.started=!0}.bind(this)),d.on("message",function(a){"out"!==a.direction&&"button"===units.chat.visible&&(units.chat.badge(units.chat.badgeNum+1),0!=c&&($("#cbh_widget_chat_offices_select").val(c),b()))});var f=function(){var a=e.findChild(".cbh_widget_chat_input").val().trim();return e.findChild(".cbh_widget_chat_input").val(""),a};e.findChild(".cbh_widget_chat_send").on("click",function(){d.sendMessage(f()),CBHEvents.widgetTgMessageSent()}.bind(this)),e.findChild(".cbh_widget_chat_input").on("keyup",function(a){return 13!=a.which&&13!=a.keyCode||(d.sendMessage(f()),CBHEvents.widgetTgMessageSent(),!1)}.bind(this)),$(".cbh-widget-chat__chats").append(e),d.state.log.forEach(this.renderChatMessage.bind(this,e))}.bind(this));var b=function(){var a=$("#cbh_widget_chat_offices_select").val();this.chat=a,$(".cbh-widget-chat__chat-sub").hide(),$("#cbh_widget_chat__chat_sub_"+a).show()}.bind(this);$("#cbh_widget_chat_offices_select").on("change",b),this.chat=Object.keys(a)[0],$("#cbh_widget_chat__chat_sub_"+this.chat).show(),$(".cbh_widget_chat_messages_wr").on("mousedown",function(a){a.stopPropagation()})},greeting:function(){if(!userCaught&&"main"!==units.chat.visible&&!this.started){userCaught=!0,this.started=!0;var a=function(){this.renderChatMessage($("#cbh_widget_chat__chat_sub_"+this.chat),{direction:"in",origin:"tech",message:CBHCore.db_params.tg_chat_greeting_text,time:new StrongDate})}.bind(this);fbChat.state?a():fbChat.on("chats",a),units.chat._show()}},renderChatMessage:function(a,b){this.num++;var c=b.id||this.num,d=["cbh-widget-chat__message"];"in"===b.direction?d.push("cbh-widget-chat__message_in"):d.push("cbh-widget-chat__message_out"),"tech"===b.origin&&d.push("cbh-widget-chat__message_tech");var e;b.message&&(e=b.message),e&&"tech"!==b.origin&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e?linkify(e):"";var f="",g=function(a){return(a<10?"0":"")+a};(new StrongDate).toDateString()!==b.time.toDateString()&&(f=b.time.getFullYear()+"."+g(b.time.getMonth()+1)+"."+g(b.time.getDate())+" "),f+=b.time.getHours()+":"+g(b.time.getMinutes());var h="";!b.avatar||1!==CBHCore.db_params.tg_chat_avatars&&void 0!==CBHCore.db_params.tg_chat_avatars||(h='<span class="cbh-widget-chat__message-avatar"><img src="'+b.avatar+'"></span>',d.push("cbh-widget-chat__message_in_avatar")),a.findChild(".cbh-widget-chat__messages").append($("<li>").addClass(d).html('<div><span class="cbh-widget-chat__message-inner" id="cbh_widget_chat_message_'+c+'">'+e+'<span class="cbh-widget-chat__message-time" title="'+b.time.toString()+'">'+f+"</span></span></div>"+h)),this.scrollToBottom(a)},scrollToBottom:function(a){var b=a.hasClass("cbh-hide");a.show();var c=a.findChild(".cbh_widget_chat_messages_wr");c.prop("scrollTop",c.prop("scrollHeight")),b&&a.hide()}},helpers=helpers||{};helpers.shortUserName=function(a){return a=a||10,CBHCore.user.name?CBHCore.user.name.trim().split(" ")[0].substr(0,a):""},helpers.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},helpers.generateDaySelects=function(){var a=cbh_glob.schedule.getValues(),b=!0,c=[],d="",e=0;return Object.keys(a).forEach(function(a){var f=helpers.capitalizeFirstLetter(renderDay(new cbh_glob.StrongDate(+a)));b&&(d=f,e=+a),c.push({text:f,value:+a,selected:b}),b=!1}),{data:c,firstName:d,firstVal:e}},helpers.generateHourSelects=function(a){a=a||cbh_glob.schedule.getNextWorkingDay();var b=cbh_glob.schedule.getValues(),c=[],d=!0,e="",f=0;return Object.keys(b[a]).forEach(function(g){b[a][g].forEach(function(a){var b=a.toLocaleString(CBHCore.lang.langCode,{hour:"2-digit",minute:"2-digit"});d&&(cbh_glob.text_time_hidden=+a,e=b,f=+a),c.push({text:b,value:+a,selected:d}),d=!1})}),{data:c,firstName:e,firstVal:f}},helpers.generateDaySelectsForSlider=function(){var a=helpers.generateDaySelects();return{html:a.data.reduce(function(a,b){var c=b.selected?" cbh-select-results__option--selected":"";return a+"<li data-value='"+b.value+"' class='cbh-select-results__option"+c+"'>"+b.text+"</li>"},"<ul class='cbh-select-results__options'>")+"</ul>",count:a.data.length,firstName:a.firstName,firstVal:a.firstVal}},helpers.generateHourSelectsForSlider=function(a){var b=helpers.generateHourSelects(a);return{html:b.data.reduce(function(a,b){var c=b.selected?" cbh-select-results__option--selected":"";return a+"<li data-value='"+b.value+"' class='cbh-select-results__option"+c+"'>"+b.text+"</li>"},"<ul class='cbh-select-results__options'>")+"</ul>",count:b.data.length,firstName:b.firstName,firstVal:b.firstVal}},helpers.popupWindow=function(a,b,c){var d=0,e=0;screen.width>b&&(d=Math.floor((screen.width-b)/2)),screen.height>c&&(e=Math.floor((screen.height-c)/2));var f=win.open(a,"cbh_"+Math.floor(100*Math.random()),"left="+d+",top= "+e+",width="+b+",height="+c+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");f&&f.focus()},helpers.getSliderDims=function(){return{call:helpers.getCallDims(),chat:helpers.getChatDims()}},helpers.getChatDims=function(){var a=$(".cbh-widget-chat");return a.hasClass("cbh-widget-chat_closed")&&(a=$(".cbh-widget-msg-wr")),{width:a.outerWidth(),height:a.outerHeight()}},helpers.getCallDims=function(){var a=$(".cbh-widget-call");return a.hasClass("cbh-widget-call_closed")&&(a=$(".cbh-widget-callopen-wr")),{width:a.outerWidth(),height:a.outerHeight()}},helpers.getCursorFollower=function(){return cursorFollower||(cursorFollower=new CursorFollower(doc.getElementById("cbh_moving_arrow"),doc.getElementById("cbh_popup"))),cursorFollower},helpers.getOfficeList=function(a){var b,c=[];if(CBHCore.params.hasCustomOffices){var d=a?CBHCore.offices.getChildren(a):CBHCore.offices.getAll();for(var e in d)b=d[e],(void 0===a&&CBHCore.helpers.isNull(b.parent_id)||void 0!==a&&b.parent_id==a)&&c.push({id:b.id,name:b.name})}else c=cbh_glob.h_params.show_office_list||[];return c},helpers.youtube_parser=function(a){var b=a.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return!(!b||11!=b[7].length)&&b[7]},helpers.getEmbeddedYTForWidget=function(a){return"https://www.youtube-nocookie.com/embed/{{id}}?autoplay=1&controls=0&showinfo=0&autohide=1&loop=1&vq=large&playlist={{id}}".replace(/{{id}}/g,a)},helpers.formatSecToMin=function(a){var b=Math.floor(a/60);b<10&&(b="0"+b);var c=a%60;return c<10&&(c="0"+c),b+":"+c};var $=CBHCore.lib.Sweety(sweetyExtensions),units={},hideAllUnits,unitExpanded=!1,CBHSelect=function(a){function b(){var a=e(),b=g(tpl.slider_select({selected_text:a.text,select:d(),input_name:i.name,input_id:i.id,input_value:a.value})),c=$(b.childNodes).findChild(".cbh-select"),l=$(b.childNodes).findChild(".cbh-select-selection__rendered"),m=$(b).findChild("#"+i.id);$(b.childNodes).findChild(".cbh-select-results__option").on("click",function(){k=!0,f(c);var a=$(this).attr("data-value"),b=$(this).html();$(this).parent().findChild(".cbh-select-results__option--selected").toggleClass("cbh-select-results__option--selected"),$(this).toggleClass("cbh-select-results__option--selected"),l.html(b),m.val(a),CBHCore.helpers.isFunction(i.onchange)&&i.onchange(a,b)}),c.on("click",function(){f(c)}),$(b.childNodes).findChild(".cbh-dropdown-container").css("top",Math.max(-219,-35*j.length)+"px");var n;h?n=h:(n=$(i.selector),h=$(b.childNodes)),n.elements[0].parentNode.replaceChild(Array.prototype.slice.call(b.childNodes)[0],n.elements[0])}function c(){if(CBHCore.helpers.isArray(i.data)&&i.data.length>0)j=i.data;else if(CBHCore.helpers.isString(i.selector)){var a=$(i.selector);if(a.elements.length){var b=a.findChild("option");j=b.elements.map(function(a){return{text:a.innerHTML,value:a.value,selected:!!a.selected}}),i.id=a.attr("id"),i.name=a.attr("name")}}}function d(){var a="",b="",c="<ul class='cbh-select-results__options'>";return j.forEach(function(d){var e="";d.selected&&(e=" cbh-select-results__option--selected",a=d.value,b=d.text),c+="<li data-value='"+d.value+"' class='cbh-select-results__option"+e+"'>"+d.text+"</li>"}),c+="</ul>"}function e(){var a=j.find(function(a){return a.selected});return void 0!==a&&a||!j[0]||(j[0].selected=!0,a=j[0]),a}function f(a){var b=$(a.elements[0].parentNode.childNodes).find(".cbh-dropdown-container");a.hasClass("cbh-select-container--open")?b.css("display","none;"):b.css("display",""),a.toggleClass("cbh-select-container--open")}function g(a){var b=doc.createDocumentFragment(),c=doc.createElement("div");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b}var h,i=CBHCore.helpers.extend({selector:"",name:"",id:"",data:[],onchange:null},a),j=[],k=!1;return function(){c(),b()}(),{setData:function(a){return j=a,this},redraw:function(){return b(),this},selectionDone:function(){return k}}},slchat={inited:!1,num:0,started:!1,init:function(){this.inited||(this.inited=!0,slChat.on("secondInstanceError",function(){$("#cbh_widget_chat_error").html(__("tgChat.errors.secondInstance")).show(),this.started=!0}.bind(this)),slChat.on("chats",this.createChats.bind(this)),slChat.loadState(),(!slChat.state||+new StrongDate-+slChat.lastMessage.time>864e5)&&1==CBHCore.db_params.tg_chat_greeting&&setTimeout(this.greeting.bind(this),1e3*CBHCore.db_params.tg_chat_greeting_delay))},createChats:function(a){Object.keys(a).forEach(function(c){var d=a[c],e=$("<div></div>").addClass("cbh-widget-chat__chat-sub").addClass("cbh-hide").attr("id","cbh_widget_chat__chat_sub_"+c);e.html(tpl.slider_chat()),0!=c&&($("#cbh_widget_chat_offices").show(),$("#cbh_widget_chat_offices_select").append($("<option>").attr("value",c).html(d.state.meta.name))),d.on("message",this.renderChatMessage.bind(this,e)),d.on("message",function(){this.started=!0}.bind(this)),d.on("message",function(a){"out"!==a.direction&&"button"===units.chat.visible&&(units.chat.badge(units.chat.badgeNum+1),0!=c&&($("#cbh_widget_chat_offices_select").val(c),b()))});var f=function(){var a=e.findChild(".cbh_widget_chat_input").val().trim();return e.findChild(".cbh_widget_chat_input").val(""),a};e.findChild(".cbh_widget_chat_send").on("click",function(){d.sendMessage(f()),CBHEvents.widgetTgMessageSent()}.bind(this)),e.findChild(".cbh_widget_chat_input").on("keyup",function(a){return 13!=a.which&&13!=a.keyCode||(d.sendMessage(f()),CBHEvents.widgetTgMessageSent(),!1)}.bind(this)),$(".cbh-widget-chat__chats").append(e),d.state.log.forEach(this.renderChatMessage.bind(this,e))}.bind(this));var b=function(){var a=$("#cbh_widget_chat_offices_select").val();this.chat=a,$(".cbh-widget-chat__chat-sub").hide(),$("#cbh_widget_chat__chat_sub_"+a).show()}.bind(this);$("#cbh_widget_chat_offices_select").on("change",b),this.chat=Object.keys(a)[0],$("#cbh_widget_chat__chat_sub_"+this.chat).show(),$(".cbh_widget_chat_messages_wr").on("mousedown",function(a){a.stopPropagation()})},greeting:function(){if(!userCaught&&"main"!==units.chat.visible&&!this.started){userCaught=!0,this.started=!0;var a=function(){this.renderChatMessage($("#cbh_widget_chat__chat_sub_"+this.chat),{direction:"in",origin:"tech",message:CBHCore.db_params.tg_chat_greeting_text,time:new StrongDate})}.bind(this);slChat.state?a():slChat.on("chats",a),units.chat._show()}},renderChatMessage:function(a,b){this.num++;var c=b.id||this.num,d=["cbh-widget-chat__message"];"in"===b.direction?d.push("cbh-widget-chat__message_in"):d.push("cbh-widget-chat__message_out"),"tech"===b.origin&&d.push("cbh-widget-chat__message_tech");var e;b.message&&(e=b.message),e&&"tech"!==b.origin&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e?linkify(e):"";var f="",g=function(a){return(a<10?"0":"")+a};(new StrongDate).toDateString()!==b.time.toDateString()&&(f=b.time.getFullYear()+"."+g(b.time.getMonth()+1)+"."+g(b.time.getDate())+" "),f+=b.time.getHours()+":"+g(b.time.getMinutes());var h="";!b.avatar||1!==CBHCore.db_params.tg_chat_avatars&&void 0!==CBHCore.db_params.tg_chat_avatars||(h='<span class="cbh-widget-chat__message-avatar"><img src="'+b.avatar+'"></span>',d.push("cbh-widget-chat__message_in_avatar")),a.findChild(".cbh-widget-chat__messages").append($("<li>").addClass(d).html('<div><span class="cbh-widget-chat__message-inner" id="cbh_widget_chat_message_'+c+'">'+e+'<span class="cbh-widget-chat__message-time" title="'+b.time.toString()+'">'+f+"</span></span></div>"+h)),this.scrollToBottom(a)},scrollToBottom:function(a){var b=a.hasClass("cbh-hide");a.show();var c=a.findChild(".cbh_widget_chat_messages_wr");c.prop("scrollTop",c.prop("scrollHeight")),b&&a.hide()}},Tpl=function(){};Tpl.prototype._=function(a){return void 0===a||null===a?"":a},Tpl.prototype.custom_offices=function(a){a=a||{};return'<div id="clbh_banner_choose_office_city_container" class="clbh_banner-textbox"><div id="clbh_banner_city_name"></div><div id="clbh_banner_city-list" class="clbh_banner_city-list"><div id="clbh_banner_choose_office_city"></div></div><div class="clbh_dropdown_button"></div></div><div id="clbh_banner_choose_office_container"></div><div class="clbh_banner-choose-office">'+__("clbh_stat_choose_city_and_office",a)+"</div>"},Tpl.prototype.dialog_phone_form=function(a){a=a||{};var b=this;return'<div class="clbh_banner-arrow"></div>'+b._(a.phone_form)+'<div class="clbh_timer" '+b._(a.style)+'><p id="clbh_timer_result">'+b._(a.timer_result)+"</p></div>"},Tpl.prototype.dialog_phone_mobile_form=function(a){a=a||{};var b=this;return'<div class="clbh_banner-arrow"></div>'+b._(a.phone_form)+'<div class="clbh_mob_timer" id="clbh_mob_timer" '+b._(a.style)+'><p id="clbh_mob_timer_result">'+b._(a.timer_result)+"</p></div>"},Tpl.prototype.main=function(a){a=a||{};var b=this;return'<div class="clbh_banner-line-wrapper" id="clbh_banner_pr_line_wrapper" style="display: '+b._(a.statusbar_display)+'"><div class="clbh_banner-pr-line-left-wrapper"><div class="clbh_banner-pr-line-left" id="clbh_banner_pr_line_left"></div></div><div class="clbh_banner-pr-line-right-wrapper"><div class="clbh_banner-pr-line-right" id="clbh_banner_pr_line_right"></div></div></div><div class="clbh_banner clbh_closed" id="clbh_div_ban"><div class="clbh_banner-exit" id="clbh_exit"></div><div class="clbh_banner-body"><div class="clbh_banner-h1" id="clbh_banner_h1"></div>'+b._(a.custom_offices)+'<div class="clbh_banner-choose-office" id="clbh_banner_choose_office" style="display:none;"></div><div class="clbh_banner-form-row-1"><div class="clbh_banner-form" id="clbh_banner_content"></div></div><div class="clbh_banner-form-row-2"><span id="clbh_stat"></span></div></div><div class="clbh_banner-work-to" id="cbh-powered-by">'+b._(a.powered_by)+'</div></div><div class="clbh_banner_bg" id="clbh_banner_bg"></div>'},Tpl.prototype.micromenu=function(a){a=a||{};return'<div id="cbh_widget_micromenu" class="cbh-hide-micromenu"><div class="cbh-icon-close"></div></div>'},Tpl.prototype.mobile=function(a){a=a||{};return'<div class="clbh_mob_banner clbh_mob_closed" id="clbh_mob_div_ban"><div class="clbh_mob_banner-phone" id="clbh_mob_banner-phone"></div><div class="clbh_mob_banner-body"><div class="clbh_mob_banner-h1" id="clbh_mob_banner_h1"></div><div class="clbh_mob_banner-form-row-1"><div class="clbh_mob_banner-form" id="clbh_mob_banner_content"></div></div><div class="clbh_mob_banner-form-row-2"><span id="clbh_mob_stat"></span></div></div><div class="clbh_mob_banner-work-to" id="clbh_mob_banner_work_to">'+__("clbh_banner_work_to",a)+"</div></div>"},Tpl.prototype.cobrowsing_dialogs=function(a){a=a||{};return'<div id="cbh-widget-cobrowsing"><div id="cbh-widget-cobrowsing__connect-dialog" class="cbh-widget-cobrowsing__connect-dialog cbh-hide"><div id="cbh-widget-cobrowsing__connect-form"><input type="text" id="cbh-widget-cobrowsing__code" class="cbh-widget-cobrowsing__code"><button type="button" id="cbh-widget-cobrowsing__connect" class="cbh-widget-cobrowsing__connect">'+__("cobrowsing.connect",a)+'</button></div></div><div id="cbh-widget-cobrowsing__disconnect-dialog" class="cbh-widget-cobrowsing__disconnect-dialog cbh-hide"><button type="button" id="cbh-widget-cobrowsing__disconnect" class="cbh-widget-cobrowsing__connect">'+__("cobrowsing.disconnect",a)+"</button></div></div>"},Tpl.prototype.main=function(a){a=a||{};var b=this;return'<div class="cbh-wrapper" id="clbh_div"><div id="cbh_plank"></div><div class="cbh-popup-wrapper" id="cbh_popup"><div class="cbh-body-wrapper"><div class="cbh-video-wrapper"><iframe id="cbh_popup_video" frameborder="0" width="100%" height="377" src=""></iframe></div><div class="cbh-moving-arrow" id="cbh_moving_arrow"></div><div class="cbh-window-controls"><div class="cbh-close-button cbh-controls"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 13.9 14.3" enable-background="new 0 0 13.9 14.3"><polygon fill="#01A7E7" points="13.5,1.3 12.8,0.6 7,6.4 1.1,0.6 0.4,1.3 6.3,7.1 0.4,12.9 1.1,13.6 7,7.8 12.8,13.6 13.5,12.9 7.7,7.1 "/></svg></div><div class="cbh-minimize-button cbh-controls"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="240 0 800 800" enable-background="new 240 0 800 800"><rect x="307.1" y="654.5" fill="#01A7E7" width="671.3" height="55.9"/></svg></div></div><div class="cbh-body" id="cbh_widget_body"><div class="cbh-media-content" id="brand"><div class="cbh-brand-main"></div><div class="cbh-form-line cbh-fixed-bottom"></div></div></div><div class="cbh-powered-by">'+b._(a.powered_by)+"</div></div></div>"+b._(a.cobrowsing_dialogs)+"</div>"},Tpl.prototype.plank_call=function(a){a=a||{};var b=this;return'<div class="cbh-plank-call-container"><div class="cbh-plank-call__text cbh-plank-call__hello"><div class="sheff sheff--w1a">'+b._(a.header)+'</div></div><div class="cbh-plank-call__phone"><div class="cbh-plank-call__phone__wr"><input type="tel" class="cbh-input" id="cbh_plank_phone_input" value="'+b._(a.client_phone)+'" placeholder="'+__("input_phone",a)+'"/></div></div><div class="cbh-plank-form-line"><button type="button" class="cbh-btn" id="cbh_plank_call_btn"><div class="sheff sheff--w1b">'+__("buttons.call_me",a)+'</div></button><span id="cbh_plank_countdown_container" class="cbh-countdown"></span></div></div>'},Tpl.prototype.plank_dialog=function(a){return a=a||{},'<div class="cbh-plank-call-container"><div class="cbh-plank-call__text"><div class="sheff sheff--w1a">'+this._(a.header)+'</div></div><div class="cbh-plank-form-line"></div></div>'},Tpl.prototype.plank_rate=function(a){a=a||{};return'<div class="cbh-plank-title">'+__("plank.rate",a)+'</div><ul class="cbh-stars" id="cbh_plank_rate"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>'},Tpl.prototype.popup_dialog=function(a){a=a||{};var b=this;return'<div class="cbh-user-content"><div class="cbh-content"><div class="cbh-title-block"><div class="cbh-title">'+b._(a.title)+'</div><div class="cbh-desc">'+b._(a.desc)+'</div></div><div class="cbh-form-line"></div></div></div>'},Tpl.prototype.slider_call_fail=function(a){a=a||{};return'<div class="cbh-widget-call__msg"><div class="sheff sheff--w1a">'+__("call.fail",a)+'</div></div><div class="cbh-widget-call__btn-area cbh-widget-call__btn-area_ok"><button type="button" id="cbh_slider_call_btn" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-yes"></button></div>'},Tpl.prototype.slider_call_main=function(a){a=a||{};var b=this;return'<div class="cbh-widget-call__hello" id="cbh_slider_header"><div class="sheff sheff--w1a">'+b._(a.header)+'</div></div><div class="cbh-widget-call__wrapper-select"><div class="cbh-widget-call__container-select"><div class="cbh-widget-call__phone"><div class="cbh-widget-call__phone__wr"><input type="tel" class="cbh-input" id="cbh_slider_phone_input" value="'+b._(a.client_phone)+'" placeholder="'+__("input_phone",a)+'"/></div></div><div class="cbh-widget-call__btn-area cbh-widget-call__timer"><button type="button" class="cbh-widget-call__btn" id="cbh_slider_call_btn"><div class="sheff sheff--w1b">'+__("buttons.call_me",a)+'</div></button><span id="cbh_slider_countdown_container"></span></div></div></div>'},Tpl.prototype.slider_call_office_choice=function(a){a=a||{};return'<div class="cbh-widget-call__hello"><div class="sheff sheff--w1a" id="cbh_select_office_title">'+__("select_office",a)+'</div></div><div class="cbh-widget-call__recall-time"><span id="cbh_select_placeholder"></span></div><div class="cbh-widget-call__btn-area cbh-widget-call__btn-area_recall"><input type="hidden" id="cbh_time_deferred"/><button type="button" class="cbh-widget-call__btn cbh-office-choice" id="cbh_slider_call_btn"></button></div>'},Tpl.prototype.slider_call_result=function(a){a=a||{};return'<div class="cbh-widget-call__msg"><div class="sheff sheff--w1a">'+__("call.question",a)+'</div></div><div class="cbh-widget-call__btn-area"><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-yes"></button><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-no"></button></div>'},Tpl.prototype.slider_call_selecttime=function(a){a=a||{};var b=this
;return'<div class="cbh-widget-call__hello"><div class="sheff sheff--w1a">'+__("choose_call_later_time",a)+'</div></div><div class="cbh-widget-call__recall-time"><div class="cbh-widget-call__select-wr"><span id="cbh_slider_select_day" class="cbh-select cbh-select-container cbh-select-container--default cbh-select-container--above cbh-select-container--focus" style="width: 128px;"><span class="cbh-select-selection cbh-select-selection--single"><span class="cbh-select-selection__rendered" title="'+b._(a.day)+'">'+b._(a.day)+"</span><span class=\"cbh-select-selection__arrow\"><b></b></span></span></span><span id=\"cbh_slider_select_day_dropdown\" class='cbh-select-container cbh-select-container--default cbh-select-container--open' style='position: absolute; top: -140px; display: none;'><span class='cbh-select-dropdown cbh-select-dropdown--above' style='width: auto; min-width: 128px;'><span class='cbh-select-results'>"+b._(a.day_select)+'</span></span></span></div><span class="cbh-widget-call__in-symbol">'+__("at",a)+'</span><div class="cbh-widget-call__select-wr"><span id="cbh_slider_select_hour" class="cbh-select cbh-select-container cbh-select-container--default cbh-select-container--above cbh-select-container--focus" style="width: 98px;"><span class="cbh-select-selection cbh-select-selection--single"><span class="cbh-select-selection__rendered" title="'+b._(a.hour)+'">'+b._(a.hour)+"</span><span class=\"cbh-select-selection__arrow\"><b></b></span></span></span><span id=\"cbh_slider_select_hour_dropdown\" class='cbh-select-container cbh-select-container--default cbh-select-container--open' style='position: absolute; top: -129px; display: none;'><span class='cbh-select-dropdown cbh-select-dropdown--above' style='width: auto; min-width: 98px;'><span class='cbh-select-results'>"+b._(a.hour_select)+'</span></span></span></div></div><div class="cbh-widget-call__btn-area cbh-widget-call__btn-area_recall"><input type="hidden" id="cbh_time_deferred"/><button type="button" class="cbh-widget-call__btn sheff sheff--w1b" id="cbh_slider_call_deferred_btn">'+__("buttons.ok",a)+"</button></div>"},Tpl.prototype.slider_call_success=function(a){a=a||{};var b=this;return'<div class="cbh-widget-call__msg"><div class="sheff sheff--w1a">'+b._(a.header)+'</div></div><div class="cbh-widget-call__social"><a href="#" class="cbh-widget-call__social-vk" id="cbh_social_vk"><i class="cbh-widget-icon-vkontakte"></i></a><a href="#" class="cbh-widget-call__social-fb" id="cbh_social_fb"><i class="cbh-widget-icon-facebook"></i></a><a href="#" class="cbh-widget-call__social-tw" id="cbh_social_tw"><i class="cbh-widget-icon-twitter"></i></a></div><div class="cbh-widget-call__btn-area"><a href="'+b._(a.comments_url)+'" class="cbh-success cbh-widget-call__btn sheff sheff--w1b" target="_blank">'+__("feedback",a)+"</a></div>"},Tpl.prototype.slider_change_email=function(a){a=a||{};var b=this;return'<div class="cbh-widget-call__hello cbh-widget-callemail"><div class="sheff sheff--w1a">'+b._(a.header)+'</div></div><div><input class="cbh-input" id="cbh_slider_email_input" value="'+b._(a.email)+'" placeholder="'+__("changeEmail.placeholder",a)+'"/></div><div class="cbh-widget-call__btn-area"><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-yes"></button><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-no"></button></div>'},Tpl.prototype.slider_change_name=function(a){a=a||{};var b=this;return'<div class="cbh-widget-call__hello cbh-widget-callname"><div class="sheff sheff--w1a">'+__("changeName.header",a)+'</div></div><div><input class="cbh-input" id="cbh_slider_name_input" value="'+b._(a.name)+'" placeholder="'+__("changeName.placeholder",a)+'"/></div><div class="cbh-widget-call__btn-area"><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-yes"></button><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min cbh-no"></button></div>'},Tpl.prototype.slider_chat_container=function(a){a=a||{};return'<div class="cbh-widget-chat__offices cbh-hide" id="cbh_widget_chat_offices"><select class="cbh-widget-chat__offices_select" id="cbh_widget_chat_offices_select"></select></div><div class="cbh-widget-chat__chats"></div><div class="cbh-widget-chat__error cbh-hide" id="cbh_widget_chat_error"></div>'},Tpl.prototype.slider_chat=function(a){a=a||{};return'<div class="cbh_widget_chat_messages_wr cbh-widget-chat__messages-wr"><ul class="cbh-widget-chat__messages"></ul></div><div class="cbh-widget-chat__bottom"><div class="cbh-widget-chat__bottom-input"><input type="text" class="cbh_widget_chat_input" placeholder="'+__("tgChat.yourMessage",a)+'"><div class="cbh_widget_chat_record_status cbh-widget-chat__record_status cbh-hide"><span class="cbh_widget_chat_record_status_going cbh-widget-chat__record_status_msg cbh-hide"><span class="cbh-widget-chat__record_status_circle"><i class="cbh-widget-icon-circle"></i></span>'+__("tgChat.voice.recording",a)+'&nbsp;<span class="cbh_widget_chat_record_status_duration"></span></span><span class="cbh_widget_chat_record_status_canceled cbh-widget-chat__record_status_msg cbh-hide">'+__("tgChat.voice.canceled",a)+'</span><span class="cbh_widget_chat_record_status_uploading cbh-widget-chat__record_status_msg cbh-hide">'+__("tgChat.voice.uploading",a)+'</span></div><button type="button" class="cbh_widget_chat_record_perm cbh-widget-chat__mic_btn cbh-hide"><i class="cbh-widget-icon-mic"></i></button><button type="button" class="cbh_widget_chat_record_start cbh-widget-chat__mic_btn cbh-hide"><i class="cbh-widget-icon-mic"></i></button><button type="button" class="cbh_widget_chat_record_mute cbh-widget-chat__mic_btn cbh-hide"><i class="cbh-widget-icon-mute"></i></button></div><div class="cbh-widget-chat__bottom-btns"><button type="button" class="cbh-widget-chat__btn cbh_widget_chat_send"></button></div></div>'},Tpl.prototype.slider_deferred_success=function(a){a=a||{};return'<div class="cbh-widget-call__msg"> '+__("deferred_call.success",a)+'</div><div class="cbh-widget-call__btn-area cbh-widget-call__btn-area_ok"><button type="button" class="cbh-widget-call__btn cbh-widget-call__btn_min" id="cbh_slider_call_btn">'+__("buttons.ok",a)+"</button></div>"},Tpl.prototype.slider_main=function(a){a=a||{};var b=this;return'<div id="cbh_widget_wrapper"><div class="cbh-widget lightSpeedIn" id="clbh_phone_div"><div class="cbh-call-container" id="cbh_call_container"><div class="cbh-widget-call '+b._(a["class_cbh-widget-call"])+'"><div class="cbh-video-wrapper"><iframe class="cbh-slider-video" frameborder="0" width="100%" height="290" src=""></iframe></div><a href="#" class="cbh-widget-call__close cbh-widget__close"><i class="cbh-widget-icon-cancel"></i></a><div class="cbh-widget-slide cbh-widget-slide_closed"></div><div class="cbh-widget-call__container"><div class="cbh-widget-call__container-inner" id="cbh_widget_call_container"></div></div><div class="cbh-widget-call__lbl">'+b._(a.powered_by)+'<span id="cbh-wdiget-cobrowsing-code"></span></div></div><div class="cbh-widget-callopen-wr cbh-widget-wr"><div class="cbh-widget-callopen '+b._(a["class_cbh-widget-callopen"])+'"><div class="cbh-ph-circle"></div><div class="cbh-ph-circle-fill"></div><button type="button" class="cbh-widget-button cbh-widget-button-text-enabled"><div class="cbh-video-wrapper"><iframe class="cbh-slider-video" frameborder="0" width="515" height="290" src=""></iframe></div><i class="cbh-widget-button-phone"></i><i class="cbh-widget-button-call">'+__("buttons.contactButton",a)+'</i><i class="cbh-widget-button-logo"></i><i class="cbh-widget-button-close" id="cbh_widget_micromenu"></i></button></div></div></div><div class="cbh-chat-container" id="cbh_chat_container"><div class="cbh-widget-chat cbh-widget-chat_closed"><a href="#" class="cbh-widget-chat__close cbh-widget__close"><i class="cbh-widget-icon-cancel"></i></a><div class="cbh-widget-chat__container">'+b._(a.chat)+'</div><div class="cbh-widget-chat__lbl">'+b._(a.powered_by_chat)+'</div></div><div class="cbh-widget-msg-wr cbh-widget-wr cbh-hide"><div class="cbh-widget-msg"><span class="cbh-widget-alert cbh-hide"><div class="cbh-button-balloon"><div class="cbh-button-balloon-box">'+__("tgChat.badgeTitle",a)+'</div></div><span class="cbh-button-balloon-num"></span></span><button type="button" class="cbh-widget-button cbh-widget-msg__button cbh-widget-button-text-enabled"><i class="cbh-widget-button-msg"></i><i class="cbh-widget-button-chat">'+__("buttons.chatButton",a)+'</i><i class="cbh-widget-button-logo"></i><i class="cbh-widget-button-close" id="cbh_widget_button_chat_close"></i></button></div></div></div></div></div>'},Tpl.prototype.slider_select=function(a){a=a||{};var b=this;return'<div class="cbh-widget-call__select-wr" style="width: 100%;"><span class="cbh-select cbh-select-container cbh-select-container--default cbh-select-container--above cbh-select-container--focus"><span class="cbh-select-selection cbh-select-selection--single"><span class="cbh-select-selection__rendered" title="'+b._(a.selected_text)+'">'+b._(a.selected_text)+"</span><span class=\"cbh-select-selection__arrow\"><b></b></span></span></span><span class='cbh-select-container cbh-dropdown-container cbh-select-container--default cbh-select-container--open' style='position: absolute; display: none;'><span class='cbh-select-dropdown cbh-select-dropdown--above'><span class='cbh-select-results'>"+b._(a.select)+'</span></span></span><input type="hidden" name="'+b._(a.input_name)+'" id="'+b._(a.input_id)+'" value="'+b._(a.input_value)+'"/></div>'},Tpl.prototype.slider_slide=function(a){a=a||{};return'<a href="#" class="cbh-widget-slide__open">'+__("slide.show",a)+'</a><div class="cbh-widget-slide-content"><a href="#" class="cbh-widget-slide__close"></a><figure class="cbh-widget-slide-image"></figure><div class="cbh-widget-slide-text"></div></div>'};var tpl=new Tpl,vkchat={inited:!1,num:0,started:!1,init:function(){this.inited||(this.inited=!0,vkChat.on("secondInstanceError",function(){$("#cbh_widget_chat_error").html(__("tgChat.errors.secondInstance")).show(),this.started=!0}.bind(this)),vkChat.on("chats",this.createChats.bind(this)),vkChat.loadState(),(!vkChat.state||+new StrongDate-+vkChat.lastMessage.time>864e5)&&1==CBHCore.db_params.tg_chat_greeting&&setTimeout(this.greeting.bind(this),1e3*CBHCore.db_params.tg_chat_greeting_delay))},createChats:function(a){Object.keys(a).forEach(function(c){var d=a[c],e=$("<div></div>").addClass("cbh-widget-chat__chat-sub").addClass("cbh-hide").attr("id","cbh_widget_chat__chat_sub_"+c);e.html(tpl.slider_chat()),0!=c&&($("#cbh_widget_chat_offices").show(),$("#cbh_widget_chat_offices_select").append($("<option>").attr("value",c).html(d.state.meta.name))),d.on("message",this.renderChatMessage.bind(this,e)),d.on("message",function(){this.started=!0}.bind(this)),d.on("message",function(a){"out"!==a.direction&&"button"===units.chat.visible&&(units.chat.badge(units.chat.badgeNum+1),0!=c&&($("#cbh_widget_chat_offices_select").val(c),b()))});var f=function(){var a=e.findChild(".cbh_widget_chat_input").val().trim();return e.findChild(".cbh_widget_chat_input").val(""),a};e.findChild(".cbh_widget_chat_send").on("click",function(){d.sendMessage(f()),CBHEvents.widgetTgMessageSent()}.bind(this)),e.findChild(".cbh_widget_chat_input").on("keyup",function(a){return 13!=a.which&&13!=a.keyCode||(d.sendMessage(f()),CBHEvents.widgetTgMessageSent(),!1)}.bind(this)),$(".cbh-widget-chat__chats").append(e),d.state.log.forEach(this.renderChatMessage.bind(this,e))}.bind(this));var b=function(){var a=$("#cbh_widget_chat_offices_select").val();this.chat=a,$(".cbh-widget-chat__chat-sub").hide(),$("#cbh_widget_chat__chat_sub_"+a).show()}.bind(this);$("#cbh_widget_chat_offices_select").on("change",b),this.chat=Object.keys(a)[0],$("#cbh_widget_chat__chat_sub_"+this.chat).show(),$(".cbh_widget_chat_messages_wr").on("mousedown",function(a){a.stopPropagation()})},greeting:function(){if(!userCaught&&"main"!==units.chat.visible&&!this.started){userCaught=!0,this.started=!0;var a=function(){this.renderChatMessage($("#cbh_widget_chat__chat_sub_"+this.chat),{direction:"in",origin:"tech",message:CBHCore.db_params.tg_chat_greeting_text,time:new StrongDate})}.bind(this);vkChat.state?a():vkChat.on("chats",a),units.chat._show()}},renderChatMessage:function(a,b){this.num++;var c=b.id||this.num,d=["cbh-widget-chat__message"];"in"===b.direction?d.push("cbh-widget-chat__message_in"):d.push("cbh-widget-chat__message_out"),"tech"===b.origin&&d.push("cbh-widget-chat__message_tech");var e;b.message&&(e=b.message),e&&"tech"!==b.origin&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e?linkify(e):"";var f="",g=function(a){return(a<10?"0":"")+a};(new StrongDate).toDateString()!==b.time.toDateString()&&(f=b.time.getFullYear()+"."+g(b.time.getMonth()+1)+"."+g(b.time.getDate())+" "),f+=b.time.getHours()+":"+g(b.time.getMinutes());var h="";!b.avatar||1!==CBHCore.db_params.tg_chat_avatars&&void 0!==CBHCore.db_params.tg_chat_avatars||(h='<span class="cbh-widget-chat__message-avatar"><img src="'+b.avatar+'"></span>',d.push("cbh-widget-chat__message_in_avatar")),a.findChild(".cbh-widget-chat__messages").append($("<li>").addClass(d).html('<div><span class="cbh-widget-chat__message-inner" id="cbh_widget_chat_message_'+c+'">'+e+'<span class="cbh-widget-chat__message-time" title="'+b.time.toString()+'">'+f+"</span></span></div>"+h)),this.scrollToBottom(a)},scrollToBottom:function(a){var b=a.hasClass("cbh-hide");a.show();var c=a.findChild(".cbh_widget_chat_messages_wr");c.prop("scrollTop",c.prop("scrollHeight")),b&&a.hide()}},widgetIconAnimation=function(){var a,b,c,d,e,f,g=[],h=[],i=!1,j=CBHCore.db_params.hasOwnProperty("call_button_text_enabled")&&1==CBHCore.db_params.call_button_text_enabled,k=!CBHCore.db_params.hasOwnProperty("hide_call_logo")||0==CBHCore.db_params.hide_call_logo,l=CBHCore.db_params.hasOwnProperty("chat_button_text_enabled")&&1==CBHCore.db_params.chat_button_text_enabled,m=!CBHCore.db_params.hasOwnProperty("hide_chat_logo")||0==CBHCore.db_params.hide_chat_logo,n=function(){var a=[];a.push({icon:["phone","msg"],duration:CBHCore.is_mobile?15e3:8e3}),a.push({icon:["call","chat"],duration:CBHCore.is_mobile?3e3:2500}),CBHCore.is_mobile||a.push({icon:["logo","logo"],duration:1500}),c=$(".cbh-widget-callopen"),d=$(".cbh-widget-msg"),f=c.findChild("i"),e=d.findChild("i"),j||c.findChild(".cbh-widget-button").removeClass("cbh-widget-button-text-enabled"),m||d.findChild(".cbh-widget-button").removeClass("cbh-widget-button-text-enabled"),a.forEach(function(a){var b=a.icon[0],e=a.icon[1];"call"===b&&!j||"logo"===b&&!k||h.push({name:b,elem:c.findChild(".cbh-widget-button-"+b),duration:a.duration}),"chat"===e&&!l||"logo"===e&&!m||g.push({name:e,elem:d.findChild(".cbh-widget-button-"+e),duration:a.duration})}),o()},o=function(){i=!0;var c=function(d,e,f){f.removeClass("cbh-rotate-icon"),e[d].elem.addClass("cbh-rotate-icon"),function(d){a=setTimeout(function(){i&&(e[d].elem.removeClass("cbh-rotate-icon"),c((d+1)%e.length,e,f))},e[d].duration),setTimeout(function(){i&&e[d].elem.addClass("cbh-rotate-icon")},200),b=setTimeout(function(){i&&e[d].elem.removeClass("cbh-rotate-icon")},e[d].duration)}(d)};c(0,h,f),c(0,g,e)};return{init:n,reset:function(){clearTimeout(a),clearTimeout(b),setTimeout(function(){i||o()},30)},stop:function(){i=!1,clearTimeout(a),clearTimeout(b),$icons.removeClass("cbh-rotate-icon")}}}();return{init:function(){init()},showSimpleDialog:function(a){showSimpleDialog(a)},showWidgetEnter:CBHCore.tryConditionalRepeatedCallback("showWidgetEnter",null,function(a){popupDialogs.showWidgetEnter(a)}),showWidgetExit:CBHCore.tryConditionalRepeatedCallback("showWidgetExit",null,function(a){popupDialogs.showWidgetExit(a)}),showNamedSliderDialog:function(a){showNamedSliderDialog(a)},showNamedPopupDialog:function(a){showNamedPopupDialog(a)},showNamedDialog:function(a){showNamedPlankDialog(a)},showNamedPlankDialog:function(a){showNamedPlankDialog(a)}}}(this,this.document);